import{r as m,A as T,b as $,j as e}from"./index-c6114df9.js";import{H as G}from"./Header-b7612ae6.js";import{N as U}from"./Navigation-1eafb50e.js";import{C as r}from"./Card-6a8cd0d5.js";import{B as W}from"./Button-7028609b.js";import{u as _}from"./useBots-aba65254.js";function O(x){const[N,g]=m.useState([]),[v,u]=m.useState(!0),[p,j]=m.useState(null),o=async()=>{try{u(!0);const l=x?`${T.TRADING_ENGINE}/trades?botId=${x}`:`${T.TRADING_ENGINE}/trades`,h=await $(l);g(h.trades||[]),j(null)}catch(l){j(l instanceof Error?l.message:"Failed to fetch trades")}finally{u(!1)}},i=async(l,h)=>{try{const n=await $(`${T.TRADING_ENGINE}/close-trade`,{method:"POST",body:JSON.stringify({tradeId:l,exitPrice:h})});return await o(),n.trade}catch(n){throw new Error(n instanceof Error?n.message:"Failed to close trade")}};return m.useEffect(()=>{o();const l=setInterval(o,3e4);return()=>clearInterval(l)},[x]),{trades:N,loading:v,error:p,fetchTrades:o,closeTrade:i}}function K(){const[x,N]=m.useState("all"),[g,v]=m.useState("all"),{trades:u,loading:p,fetchTrades:j}=O(),{bots:o}=_(),i=u.filter(t=>!(x!=="all"&&t.status!==x||g!=="all"&&t.botId!==g)),l=t=>{switch(t){case"open":return"text-blue-600 bg-blue-50";case"closed":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},h=t=>t==="long"?"text-green-600":"text-red-600",n=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:4}).format(t),A=t=>{if(!t)return"-";const a=t>=0?"text-green-600":"text-red-600",c=t>=0?"+":"";return e.jsxs("span",{className:a,children:[c,n(t)]})},I=()=>{confirm("Are you sure you want to reset all trade data? This will clear all trade history.")&&(localStorage.removeItem("trades"),j())},L=t=>{const a=o.find(c=>c.id===t);return(a==null?void 0:a.name)||"Unknown Bot"};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(G,{title:"Trades",subtitle:"Monitor your trading activity",rightAction:e.jsxs(W,{variant:"danger",size:"sm",onClick:I,children:[e.jsx("i",{className:"ri-refresh-line mr-1"}),"Reset"]})}),e.jsxs("div",{className:"pt-20 pb-20 px-4 space-y-4",children:[e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsx("div",{className:"flex space-x-2",children:["all","open","closed"].map(t=>e.jsx("button",{onClick:()=>N(t),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${x===t?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bot"}),e.jsxs("select",{value:g,onChange:t=>v(t.target.value),className:"w-full bg-gray-100 border-none rounded-lg px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"All Bots"}),o.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]})}),(()=>{const a=i.filter(s=>s.status==="closed"||s.status==="filled").filter(s=>s.pnl!==null&&s.pnl!==void 0&&s.pnl!==0),c=a.filter(s=>(s.pnl||0)>0),y=a.filter(s=>(s.pnl||0)<0),f=a.reduce((s,d)=>s+(d.pnl||0),0),b=c.reduce((s,d)=>s+(d.pnl||0),0),k=Math.abs(y.reduce((s,d)=>s+(d.pnl||0),0)),w=a.length>0?c.length/a.length*100:0,F=k>0?b/k:b>0?999:0,C=c.length>0?b/c.length:0,B=y.length>0?k/y.length:0,S=i.reduce((s,d)=>{var P,E;const R=parseFloat(((P=d.size)==null?void 0:P.toString())||"0"),z=parseFloat(((E=d.entryPrice)==null?void 0:E.toString())||"0");return s+R*z},0),D=S*.001;return e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4",children:[e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:i.length}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Trades"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:i.filter(s=>s.status==="open").length}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Active Trades"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-2xl font-bold ${w>=50?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[w.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Win Rate"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-2xl font-bold ${F>=1?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[F.toFixed(2),"x"]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Profit Factor"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:["$",C.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Avg Win"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:["$",B.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Avg Loss"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:["$",S.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Volume"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-2xl font-bold ${f>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[f>=0?"+":"","$",f.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total PnL"}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:["Fees: $",D.toFixed(2)]})]})})]})})(),e.jsx("div",{className:"space-y-3",children:p?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading trades..."})]}):i.length===0?e.jsxs(r,{className:"p-8 text-center",children:[e.jsx("i",{className:"ri-file-list-line text-4xl text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Trades Found"}),e.jsx("p",{className:"text-gray-500",children:"No trades match your current filters."})]}):i.map(t=>e.jsxs(r,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${l(t.status)}`,children:t.status.toUpperCase()}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(t.timestamp).toLocaleDateString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.symbol}),e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:t.exchange})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Bot"}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:L(t.botId)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Side"}),e.jsx("div",{className:`text-sm font-medium ${h(t.side)}`,children:t.side.toUpperCase()})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Size"}),e.jsx("div",{className:"font-medium",children:t.size})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Entry Price"}),e.jsx("div",{className:"font-medium",children:n(t.entryPrice)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:t.status==="open"?"Current P&L":"P&L"}),e.jsx("div",{className:"font-medium",children:A(t.pnl)})]})]}),t.exitPrice&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Exit Price:"}),e.jsx("span",{className:"font-medium",children:n(t.exitPrice)})]})})]},t.id))}),e.jsxs(r,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{className:"bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center",children:[e.jsx("i",{className:"ri-download-line mr-2"}),"Export Trades"]}),e.jsxs("button",{className:"bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-4 rounded-lg transition-colors flex items-center justify-center",children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Refresh Data"]})]})]})]}),e.jsx(U,{})]})}export{K as default};
