import{a as Z,u as G,d as K,r as o,s as p,j as e}from"./index-41a0ae00.js";import{H as T}from"./Header-b24d545e.js";import{N as _}from"./Navigation-ce370d60.js";import{C as b}from"./Card-0516a8f2.js";import{B as N}from"./Button-0b498d06.js";import{u as X}from"./useBots-73934354.js";function se(){const f=Z(),{user:c}=G(),{createBot:D,startBot:R}=X(),{executeBot:F}=K(),[x,M]=o.useState([]),[A,S]=o.useState(!0),[C,P]=o.useState(null),[L,j]=o.useState(null),[u,E]=o.useState({}),[d,z]=o.useState({}),[y,O]=o.useState({}),[w,H]=o.useState({}),[B,$]=o.useState({});o.useEffect(()=>{U()},[]),o.useEffect(()=>{if(x.length>0){const t={};x.forEach(r=>{u[r.id]||(t[r.id]={paperTrading:!1,tradeAmount:r.trade_amount||100,customPair:r.symbol==="CUSTOM"?"":void 0})}),Object.keys(t).length>0&&E(r=>({...r,...t}))}},[x]);const U=async()=>{try{S(!0),P(null);const{data:t,error:r}=await p.from("pablo_ready_bots").select("*").eq("enabled",!0).order("order_index",{ascending:!0}).order("created_at",{ascending:!1});if(r)throw r;M(t||[])}catch(t){console.error("Error fetching Pablo Ready bots:",t),P((t==null?void 0:t.message)||"Failed to load bots")}finally{S(!1)}},q=async t=>{var r,s,i;if(!c){f("/auth");return}try{j(t.id);const a=u[t.id]||{paperTrading:!1,tradeAmount:t.trade_amount||100},n=((r=t.strategy)==null?void 0:r.allows_custom_pair)===!0||t.symbol==="CUSTOM",l=n&&((s=a.customPair)==null?void 0:s.trim().toUpperCase())||t.symbol;if(n&&!((i=a.customPair)!=null&&i.trim())){alert("âŒ Please enter a trading pair (e.g., BTCUSDT, ETHUSDT)"),j(null);return}if(n&&a.customPair&&!/^[A-Z0-9]{2,20}USDT$/.test(a.customPair.trim().toUpperCase())){alert("âŒ Invalid pair format. Please use format like BTCUSDT, ETHUSDT, SOLUSDT"),j(null);return}const g={name:`${t.name} - ${l}`,exchange:t.exchange,symbol:l,tradingType:t.trading_type,leverage:t.leverage,riskLevel:t.risk_level,tradeAmount:a.tradeAmount,stopLoss:t.stop_loss,takeProfit:t.take_profit,timeframe:t.timeframe,strategy:t.strategy,strategyConfig:t.strategy_config,paperTrading:a.paperTrading,status:"running",pnl:0,pnlPercentage:0,totalTrades:0,winRate:0},m=await D(g);if(m){m.status!=="running"&&await R(m.id);try{console.log(`ðŸš€ Triggering immediate execution for bot ${m.id}...`),await F(m.id),console.log(`âœ… Bot "${m.name}" executed immediately`)}catch(h){console.warn("âš ï¸ Failed to trigger immediate execution (bot will start on next cron run):",h)}alert(`âœ… Bot "${m.name}" created and started successfully! It will begin trading immediately.`),f("/bots")}}catch(a){console.error("Error starting bot:",a),alert(`âŒ Failed to start bot: ${(a==null?void 0:a.message)||a}`)}finally{j(null)}},k=(t,r,s)=>{E(i=>({...i,[t]:{...i[t],[r]:s}}))};o.useEffect(()=>{if(c&&x.length>0){(async()=>{try{const{data:s}=await p.from("trading_bots").select("id, pnl, pnl_percentage, total_trades, win_rate, symbol, name").eq("user_id",c.id).order("created_at",{ascending:!1});if(s){const i={},a={};x.forEach(n=>{const l=s.find(g=>g.symbol===n.symbol&&(g.name.includes(n.name)||g.name.includes(n.symbol)));if(l){const g=l.win_rate||0,m=l.total_trades||0,h=Math.round(m*(g/100)),V=m-h;i[n.id]={pnl:l.pnl||0,pnlPercentage:l.pnl_percentage||0,totalTrades:m,winRate:g,wins:h,losses:V},v(n.id,l.id)}}),z(n=>({...n,...i}))}}catch(s){console.error("Error fetching bot data:",s)}})();const r=setInterval(async()=>{if(c&&x.length>0)try{const{data:s}=await p.from("trading_bots").select("id, symbol, name").eq("user_id",c.id);s&&x.forEach(i=>{const a=s.find(n=>n.symbol===i.symbol&&(n.name.includes(i.name)||n.name.includes(i.symbol)));a&&v(i.id,a.id)})}catch(s){console.error("Error refreshing logs:",s)}},1e4);return()=>clearInterval(r)}},[c,x]);const v=async(t,r)=>{if(!B[t])try{$(a=>({...a,[t]:!0}));const{data:s,error:i}=await p.from("bot_activity_logs").select("*").eq("bot_id",r).order("timestamp",{ascending:!1}).limit(20);if(i)throw i;O(a=>({...a,[t]:s||[]}))}catch(s){console.error("Error fetching bot logs:",s)}finally{$(s=>({...s,[t]:!1}))}},W=t=>{H(r=>({...r,[t]:!r[t]})),!w[t]&&!y[t]&&p.from("trading_bots").select("id, symbol, name").eq("user_id",c==null?void 0:c.id).then(({data:r})=>{if(r){const s=x.find(i=>i.id===t);if(s){const i=r.find(a=>a.symbol===s.symbol&&(a.name.includes(s.name)||a.name.includes(s.symbol)));i&&v(t,i.id)}}})},J=t=>{const r=new Date(t),i=new Date().getTime()-r.getTime(),a=Math.floor(i/6e4);if(a<1)return"Just now";if(a<60)return`${a}m ago`;const n=Math.floor(a/60);return n<24?`${n}h ago`:r.toLocaleDateString()},Q=t=>{switch(t==null?void 0:t.toLowerCase()){case"error":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-200";case"warning":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200";case"success":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-200";case"info":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}};return A?e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(T,{title:"Pablo Ready"}),e.jsx("div",{className:"pt-24 pb-20 px-4",children:e.jsx(b,{className:"p-6 text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Loading Pablo Ready bots..."})})}),e.jsx(_,{})]}):C?e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(T,{title:"Pablo Ready"}),e.jsx("div",{className:"pt-24 pb-20 px-4",children:e.jsxs(b,{className:"p-6 border border-red-200 bg-red-50 dark:border-red-900/40 dark:bg-red-900/20",children:[e.jsx("p",{className:"text-red-700 dark:text-red-200",children:C}),e.jsx(N,{className:"mt-4",onClick:U,size:"sm",children:"Retry"})]})}),e.jsx(_,{})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 pb-24",children:[e.jsx(T,{title:"Pablo Ready",subtitle:"Pre-configured trading bots ready to deploy. Choose a bot and start trading instantly.",rightAction:e.jsx(N,{variant:"secondary",size:"sm",onClick:()=>f("/bots"),children:"My Bots"})}),e.jsx("main",{className:"px-4 pt-24 pb-16",children:e.jsx("div",{className:"mx-auto max-w-6xl space-y-6",children:x.length===0?e.jsxs(b,{className:"p-10 text-center",children:[e.jsx("div",{className:"text-gray-400 dark:text-gray-500 mb-4",children:e.jsx("i",{className:"ri-robot-line text-5xl"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No Pablo Ready bots available"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Check back soon for new pre-configured bots."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:x.map(t=>{var r,s,i,a,n;return e.jsx(b,{className:"group overflow-hidden border border-gray-200/70 bg-white/90 shadow-sm transition hover:-translate-y-1 hover:border-blue-300 hover:shadow-lg dark:border-gray-700 dark:bg-gray-900/90",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.name}),t.featured&&e.jsxs("span",{className:"inline-flex items-center rounded-full bg-yellow-100 px-2 py-0.5 text-xs font-semibold text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200",children:[e.jsx("i",{className:"ri-star-fill mr-1"}),"Featured"]})]}),t.description&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-300 mt-1",children:t.description})]})}),e.jsxs("div",{className:"space-y-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs mb-1",children:"Exchange"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white capitalize",children:t.exchange})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs mb-1",children:"Symbol"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.symbol==="CUSTOM"?"Custom (User Input)":t.symbol})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs mb-1",children:"Type"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white capitalize",children:t.trading_type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs mb-1",children:"Leverage"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[t.leverage,"x"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs mb-1",children:"Risk Level"}),e.jsx("span",{className:`font-medium capitalize ${t.risk_level==="low"?"text-green-600 dark:text-green-400":t.risk_level==="medium"?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"}`,children:t.risk_level})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs mb-1",children:"Timeframe"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.timeframe})]})]}),t.strategy_config&&e.jsx("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.strategy_config.enable_tp===!0&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200",children:[e.jsx("i",{className:"ri-target-line mr-1"}),"Multi TP"]}),t.strategy_config.enable_trail_sl===!0&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-200",children:[e.jsx("i",{className:"ri-line-chart-line mr-1"}),"Trailing SL"]}),t.strategy_config.volume_multiplier&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-200",children:[e.jsx("i",{className:"ri-bar-chart-line mr-1"}),"Volume Filter"]})]})})]}),c&&e.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Trading Mode"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>k(t.id,"paperTrading",!1),className:`px-3 py-1 rounded text-xs font-medium transition ${(r=u[t.id])!=null&&r.paperTrading?"bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300":"bg-blue-600 text-white"}`,children:"Real"}),e.jsx("button",{onClick:()=>k(t.id,"paperTrading",!0),className:`px-3 py-1 rounded text-xs font-medium transition ${(s=u[t.id])!=null&&s.paperTrading?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300"}`,children:"Paper"})]})]}),(((i=t.strategy)==null?void 0:i.allows_custom_pair)===!0||t.symbol==="CUSTOM")&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Trading Pair ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",placeholder:"e.g., BTCUSDT, ETHUSDT, SOLUSDT",value:((a=u[t.id])==null?void 0:a.customPair)||"",onChange:l=>k(t.id,"customPair",l.target.value.toUpperCase()),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Enter the trading pair you want to follow (must end with USDT)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Trade Amount ($)"}),e.jsx("input",{type:"number",min:"10",step:"10",value:((n=u[t.id])==null?void 0:n.tradeAmount)||t.trade_amount||100,onChange:l=>k(t.id,"tradeAmount",parseFloat(l.target.value)||100),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"})]}),d[t.id]&&e.jsx("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"PnL"}),e.jsxs("p",{className:`font-semibold ${d[t.id].pnl>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:["$",d[t.id].pnl.toFixed(2)," (",d[t.id].pnlPercentage.toFixed(2),"%)"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Win Rate"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:[d[t.id].winRate.toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Total Trades"}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:d[t.id].totalTrades})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Win/Loss"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400",children:d[t.id].wins}),e.jsx("span",{className:"text-gray-400 dark:text-gray-500 mx-1",children:"/"}),e.jsx("span",{className:"text-red-600 dark:text-red-400",children:d[t.id].losses})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Fees"}),e.jsxs("p",{className:"font-semibold text-red-600 dark:text-red-400",children:["$",(d[t.id].totalTrades*(t.trade_amount||100)*.001).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Drawdown"}),e.jsx("p",{className:"font-semibold text-red-600 dark:text-red-400",children:d[t.id].pnl<0?`$${Math.abs(d[t.id].pnl).toFixed(2)}`:"$0.00"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Win/Loss"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:[d[t.id].wins,"/",d[t.id].losses]})]})]})}),e.jsx(N,{onClick:()=>q(t),className:"w-full",size:"sm",disabled:L===t.id,children:L===t.id?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-loader-4-line animate-spin mr-2"}),"Starting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-play-line mr-2"}),"Start Bot"]})}),c&&e.jsxs("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>W(t.id),className:"w-full flex items-center justify-between text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"ri-file-list-line"}),"Activity Logs",y[t.id]&&y[t.id].length>0&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200 rounded text-xs",children:y[t.id].length})]}),e.jsx("i",{className:`ri-arrow-${w[t.id]?"up":"down"}-s-line`})]}),w[t.id]&&e.jsx("div",{className:"mt-3 max-h-64 overflow-y-auto space-y-2",children:B[t.id]?e.jsxs("div",{className:"text-center py-4 text-gray-500 text-sm",children:[e.jsx("i",{className:"ri-loader-4-line animate-spin text-lg mb-1"}),e.jsx("p",{children:"Loading logs..."})]}):y[t.id]&&y[t.id].length>0?y[t.id].map((l,g)=>e.jsxs("div",{className:"p-2 bg-gray-50 dark:bg-gray-800 rounded text-xs",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs font-medium ${Q(l.level)}`,children:l.level||"info"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-xs",children:J(l.timestamp)})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-xs mt-1",children:l.message}),l.category&&e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 text-xs mt-1 block",children:["Category: ",l.category]})]},l.id||g)):e.jsxs("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400 text-sm",children:[e.jsx("i",{className:"ri-file-list-line text-lg mb-1"}),e.jsx("p",{children:"No logs yet. Bot will show activity here once it starts trading."})]})})]})]}),!c&&e.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs(N,{onClick:()=>f("/auth"),className:"w-full",variant:"secondary",size:"sm",children:[e.jsx("i",{className:"ri-login-box-line mr-2"}),"Sign In to Use"]})})]})},t.id)})})})}),e.jsx(_,{})]})}export{se as default};
