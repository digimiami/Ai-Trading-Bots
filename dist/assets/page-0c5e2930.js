import{r as o,j as e}from"./index-7db8efba.js";import{C as g}from"./Card-5e232337.js";import{B as M}from"./Button-9007c314.js";function J(){const[x,I]=o.useState([]),[N,P]=o.useState([]),[v,U]=o.useState([]),[w,_]=o.useState([]),[d,F]=o.useState(null),[$,L]=o.useState([]),[T,p]=o.useState(!0),[S,j]=o.useState(!1),[b,D]=o.useState(null),[G,B]=o.useState(new Map),f=async()=>{var t;try{const s=({}.VITE_PUBLIC_SUPABASE_URL||{}.VITE_SUPABASE_URL||"").replace("/rest/v1",""),r={}.VITE_PUBLIC_SUPABASE_ANON_KEY||{}.VITE_SUPABASE_ANON_KEY||"";if(console.log("ðŸ“Š Fetching market data...",{hasUrl:!!s,hasKey:!!r,urlLength:s.length,keyLength:r.length}),!s||!r){console.error("âŒ Missing Supabase configuration",{supabaseUrl:!!s,supabaseKey:!!r}),p(!1);return}const n=`${s}/functions/v1/market-data?action=all`;console.log("ðŸŒ Calling market data API:",n);const l=await fetch(n,{headers:{apikey:r,Authorization:`Bearer ${r}`}});if(console.log("ðŸ“¡ API Response:",{status:l.status,statusText:l.statusText,ok:l.ok}),!l.ok){const y=await l.text();console.error("âŒ Market data API error:",l.status,y.substring(0,200)),p(!1);return}const i=l.headers.get("content-type");if(!i||!i.includes("application/json")){const y=await l.text();console.error("âŒ Market data API returned non-JSON response:",i,y.substring(0,200)),p(!1);return}const a=await l.json();console.log("âœ… Market data received:",{hasMarketData:!!a.marketData,marketDataCount:((t=a.marketData)==null?void 0:t.length)||0,hasTopGainers:!!a.topGainers,hasRapidChanges:!!a.rapidChanges}),a.marketData?(I(a.marketData),P(a.topGainers||[]),U(a.rapidChanges||[]),a.fearGreedIndex&&F(a.fearGreedIndex),a.news&&L(a.news),console.log("âœ… Market data state updated:",a.marketData.length,"items")):console.warn("âš ï¸ No marketData in response:",a)}catch(s){console.error("âŒ Error fetching market data:",s),s instanceof SyntaxError&&s.message.includes("JSON")&&console.warn("âš ï¸ Market data Edge Function may not be deployed. Deploy it with: supabase functions deploy market-data")}finally{p(!1)}},A=async()=>{try{const t=({}.VITE_PUBLIC_SUPABASE_URL||{}.VITE_SUPABASE_URL||"").replace("/rest/v1",""),s={}.VITE_PUBLIC_SUPABASE_ANON_KEY||{}.VITE_SUPABASE_ANON_KEY||"";if(!t||!s){console.error("Missing Supabase configuration");return}const r=await fetch(`${t}/functions/v1/market-data?action=alerts`,{headers:{apikey:s,Authorization:`Bearer ${s}`}});if(!r.ok){const i=await r.text();console.error("Alerts API error:",r.status,i.substring(0,200));return}const n=r.headers.get("content-type");if(!n||!n.includes("application/json")){const i=await r.text();console.error("Alerts API returned non-JSON response:",i.substring(0,200));return}const l=await r.json();l.alerts&&_(l.alerts)}catch(t){console.error("Error fetching alerts:",t),t instanceof SyntaxError&&t.message.includes("JSON")&&console.warn("âš ï¸ Market data Edge Function may not be deployed. Deploy it with: supabase functions deploy market-data")}};o.useEffect(()=>{if(!x.map(n=>n.symbol).join(","))return;const s="wss://stream.bybit.com/v5/public/spot",r=new WebSocket(s);return r.onopen=()=>{console.log("WebSocket connected"),j(!0);const n={op:"subscribe",args:x.map(l=>`ticker.${l.symbol}`)};r.send(JSON.stringify(n))},r.onmessage=n=>{var l,i;try{const a=JSON.parse(n.data);if((l=a.topic)!=null&&l.startsWith("ticker.")){const y=a.topic.replace("ticker.",""),E=parseFloat(((i=a.data)==null?void 0:i.lastPrice)||"0");E>0&&B(O=>{const C=new Map(O);return C.set(y,E),C})}}catch(a){console.error("Error parsing WebSocket message:",a)}},r.onerror=n=>{console.error("WebSocket error:",n),j(!1)},r.onclose=()=>{console.log("WebSocket disconnected"),j(!1),setTimeout(()=>{x.length>0},5e3)},()=>{r.close()}},[x.length]),o.useEffect(()=>{f(),A();const t=setInterval(()=>{f(),A()},3e4);return()=>clearInterval(t)},[]);const m=(t,s=2)=>t>=1e9?(t/1e9).toFixed(s)+"B":t>=1e6?(t/1e6).toFixed(s)+"M":t>=1e3?(t/1e3).toFixed(s)+"K":t.toFixed(s),h=t=>t>=1e3?t.toFixed(2):t>=1?t.toFixed(4):t.toFixed(8),k=(t,s)=>G.get(t)||s,u=t=>t<=25?"text-red-500":t<=45?"text-orange-500":t<=55?"text-yellow-500":t<=75?"text-green-500":"text-emerald-500",R=t=>180-t/100*180,W=t=>t*Math.PI/180,c=(t,s=80)=>{const r=R(t),n=W(r),l=100,i=100;return{x:l+s*Math.cos(n),y:i-s*Math.sin(n)}};return T?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-loader-4-line animate-spin text-4xl text-blue-500"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-4",children:"Loading market data..."})]})})}):!x||x.length===0?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-line-chart-line text-4xl text-gray-400 mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-2",children:"No Market Data Available"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"The market data API may be temporarily unavailable or the Edge Function needs to be deployed."}),e.jsxs(M,{onClick:f,variant:"primary",children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Retry"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-4",children:"Check the browser console for detailed error messages."})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Market Dashboard"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:["Real-time crypto market analysis",S&&e.jsxs("span",{className:"ml-2 inline-flex items-center gap-1 text-green-500",children:[e.jsx("i",{className:"ri-circle-fill text-xs"}),"Live"]})]})]}),e.jsxs(M,{onClick:f,variant:"secondary",size:"sm",children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Refresh"]})]}),d&&e.jsxs(g,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Crypto Fear & Greed Index"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"relative w-full max-w-md",children:[e.jsxs("svg",{viewBox:"0 0 200 120",className:"w-full h-auto",style:{minHeight:"220px"},preserveAspectRatio:"xMidYMid meet",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"fearGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#ef4444"}),e.jsx("stop",{offset:"100%",stopColor:"#dc2626"})]}),e.jsxs("linearGradient",{id:"greedGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#22c55e"}),e.jsx("stop",{offset:"100%",stopColor:"#10b981"})]})]}),e.jsx("path",{d:"M 20 100 A 80 80 0 0 1 180 100",fill:"none",stroke:"#e5e7eb",strokeWidth:"16",className:"dark:stroke-gray-700"}),(()=>{const t=c(0,80),s=c(25,80);return e.jsx("path",{d:`M ${t.x} ${t.y} A 80 80 0 0 1 ${s.x} ${s.y}`,fill:"none",stroke:"url(#fearGradient)",strokeWidth:"16",strokeLinecap:"round"})})(),(()=>{const t=c(26,80),s=c(45,80);return e.jsx("path",{d:`M ${t.x} ${t.y} A 80 80 0 0 1 ${s.x} ${s.y}`,fill:"none",stroke:"#f97316",strokeWidth:"16",strokeLinecap:"round"})})(),(()=>{const t=c(46,80),s=c(55,80);return e.jsx("path",{d:`M ${t.x} ${t.y} A 80 80 0 0 1 ${s.x} ${s.y}`,fill:"none",stroke:"#eab308",strokeWidth:"16",strokeLinecap:"round"})})(),(()=>{const t=c(56,80),s=c(75,80);return e.jsx("path",{d:`M ${t.x} ${t.y} A 80 80 0 0 1 ${s.x} ${s.y}`,fill:"none",stroke:"#22c55e",strokeWidth:"16",strokeLinecap:"round"})})(),(()=>{const t=c(76,80),s=c(100,80);return e.jsx("path",{d:`M ${t.x} ${t.y} A 80 80 0 0 1 ${s.x} ${s.y}`,fill:"none",stroke:"url(#greedGradient)",strokeWidth:"16",strokeLinecap:"round"})})(),(()=>{const t=c(d.value,80);return e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:"100",y1:"100",x2:t.x,y2:t.y,stroke:"#1f2937",strokeWidth:"5",strokeLinecap:"round",className:"dark:stroke-gray-200"}),e.jsx("circle",{cx:t.x,cy:t.y,r:"10",fill:"#1f2937",stroke:"#ffffff",strokeWidth:"3",className:"dark:fill-gray-200 dark:stroke-gray-800"})]})})(),e.jsx("circle",{cx:"100",cy:"100",r:"4",fill:"#6b7280",className:"dark:fill-gray-500"})]}),e.jsxs("div",{className:"text-center mt-4",children:[e.jsx("div",{className:`text-5xl font-bold ${u(d.value)}`,children:d.value}),e.jsx("div",{className:`text-lg font-semibold mt-2 ${u(d.value)}`,children:d.classification})]})]})}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Historical Data"}),e.jsx("div",{className:"space-y-2",children:d.yesterday&&e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Yesterday"}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`font-semibold ${u(d.yesterday.value)}`,children:d.yesterday.value}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:d.yesterday.classification})]})]})})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"What's Crypto Fear & Greed Index?"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 leading-relaxed",children:"The index ranges from 0 (Extreme Fear) to 100 (Extreme Greed), reflecting crypto market sentiment. A low value signals over-selling, while a high value warns of a potential market correction."})]})]})]})]}),w.length>0&&e.jsx("div",{className:"space-y-2",children:w.map((t,s)=>e.jsx(g,{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("i",{className:"ri-alarm-line text-yellow-600 dark:text-yellow-400 text-xl"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-yellow-900 dark:text-yellow-100",children:t.type==="24h_high"?`24h High: ${t.symbol} at $${h(t.price||0)}`:`Large Volume: ${t.symbol} - $${m(t.volume24h||0)}`}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:new Date(t.timestamp).toLocaleTimeString()})]})]})},s))}),N.length>0&&e.jsxs(g,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Top Gainers (24h)"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:N.map(t=>e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:t.symbol.replace("USDT","")}),e.jsxs("span",{className:`text-sm font-medium ${t.change24h>=0?"text-green-600":"text-red-600"}`,children:[t.change24h>=0?"+":"",t.change24h.toFixed(2),"%"]})]}),e.jsxs("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:["$",h(k(t.symbol,t.price))]})]},t.symbol))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Market Overview"}),x&&x.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x.map(t=>{const s=k(t.symbol,t.price),r=s-t.price,n=r>=0;return e.jsxs(g,{className:`p-6 cursor-pointer transition-all hover:shadow-lg ${b===t.symbol?"ring-2 ring-blue-500":""}`,onClick:()=>D(b===t.symbol?null:t.symbol),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:t.symbol.replace("USDT","")}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Market Cap: $",m(t.marketCap)]})]}),e.jsxs("div",{className:`text-right ${n?"text-green-600":"text-red-600"}`,children:[e.jsxs("p",{className:"text-sm font-medium",children:[n?"+":"",(r/t.price*100).toFixed(2),"%"]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["24h: ",t.change24h>=0?"+":"",t.change24h.toFixed(2),"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["$",h(s)]}),S&&e.jsxs("span",{className:"text-xs text-green-500",children:[e.jsx("i",{className:"ri-circle-fill text-xs"})," Live"]})]}),b===t.symbol&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"VWAP"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:["$",h(t.vwap)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"ATR"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:["$",h(t.atr)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"RSI"}),e.jsx("p",{className:`font-semibold ${t.rsi>70?"text-red-600":t.rsi<30?"text-green-600":"text-gray-900 dark:text-white"}`,children:t.rsi.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Volume 24h"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:["$",m(t.volume24h)]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Inflow"}),e.jsxs("p",{className:"font-semibold text-green-600",children:["$",m(t.inflow)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Outflow"}),e.jsxs("p",{className:"font-semibold text-red-600",children:["$",m(t.outflow)]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 pt-2",children:[e.jsxs("p",{children:["24h High: $",h(t.high24h)]}),e.jsxs("p",{children:["24h Low: $",h(t.low24h)]})]})]})]})]},t.symbol)})}):e.jsx(g,{className:"p-6",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-center",children:"No market data available"})})]}),$.length>0&&e.jsxs(g,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Recent Crypto News"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:$.slice(0,6).map(t=>e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"block p-4 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex gap-3",children:[t.imageUrl&&e.jsx("img",{src:t.imageUrl,alt:t.title,className:"w-20 h-20 object-cover rounded-lg flex-shrink-0",onError:s=>{s.target.style.display="none"}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-sm mb-2 line-clamp-2",children:t.title}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 line-clamp-2 mb-2",children:t.body}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-500",children:[e.jsx("span",{children:t.source}),e.jsx("span",{children:new Date(t.publishedOn).toLocaleDateString()})]})]})]})},t.id))})]}),v.length>0&&e.jsxs(g,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Rapid Changes (>5% in 24h)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-300",children:"Symbol"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-gray-700 dark:text-gray-300",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-gray-700 dark:text-gray-300",children:"Change 24h"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-gray-700 dark:text-gray-300",children:"Volume"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-gray-700 dark:text-gray-300",children:"RSI"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:v.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900 dark:text-white",children:t.symbol}),e.jsxs("td",{className:"px-4 py-3 text-right text-gray-700 dark:text-gray-300",children:["$",h(k(t.symbol,t.price))]}),e.jsxs("td",{className:`px-4 py-3 text-right font-medium ${t.change24h>=0?"text-green-600":"text-red-600"}`,children:[t.change24h>=0?"+":"",t.change24h.toFixed(2),"%"]}),e.jsxs("td",{className:"px-4 py-3 text-right text-gray-700 dark:text-gray-300",children:["$",m(t.volume24h)]}),e.jsx("td",{className:`px-4 py-3 text-right font-medium ${t.rsi>70?"text-red-600":t.rsi<30?"text-green-600":"text-gray-700 dark:text-gray-300"}`,children:t.rsi.toFixed(2)})]},t.symbol))})]})})]})]})})}export{J as default};
