import{c as O,a as R,r as m,j as e}from"./index-f5b9f1ad.js";import{C as g}from"./Card-687af293.js";import{B as x}from"./Button-0ce23021.js";import{N as U}from"./Navigation-4a1add68.js";import{H as V}from"./Header-6fe79115.js";import{u as G,g as C}from"./useAcademy-2bc6f9f4.js";const P=i=>{if(!i)return null;try{const l=JSON.parse(i);return Array.isArray(l.questions)?l:null}catch{return null}};function $(i){return!i||!Array.isArray(i.questions)?[]:i.questions.map((l,k)=>{const c=["a","b","c","d","e","f"];return{id:`q${k+1}`,prompt:l.question,options:l.options.map((N,b)=>({label:N,value:c[b]||String(b)})),correct:c[l.correctIndex]||String(l.correctIndex)}})}const I={video:"ri-play-circle-fill",guide:"ri-file-text-line",quiz:"ri-question-answer-fill"},j=(i,l)=>`${i}:${l}`;function se(){const{moduleSlug:i}=O(),l=R(),{modules:k,lessonProgress:c,loading:N,error:b,recordProgress:h,refresh:Q}=G(),t=m.useMemo(()=>k.find(r=>r.slug===i)??null,[k,i]),[y,z]=m.useState(()=>{var r,a;return((a=(r=t==null?void 0:t.lessons)==null?void 0:r[0])==null?void 0:a.id)??null}),[A,B]=m.useState({}),[q,E]=m.useState({});m.useEffect(()=>{var r;t&&(!y||!t.lessons.some(a=>a.id===y))&&z(((r=t.lessons[0])==null?void 0:r.id)??null)},[t,y]);const s=m.useMemo(()=>(t==null?void 0:t.lessons.find(r=>r.id===y))??null,[t,y]);m.useEffect(()=>{if(!t||!s)return;C(c,t.id,s.id)==="not_started"&&h(t.slug,s.slug,"in_progress")},[t,s,c,h]);const S=m.useMemo(()=>t?t.lessons.filter(r=>c.some(a=>a.module_id===t.id&&a.lesson_id===r.id&&a.status==="completed")).length:0,[t,c]),v=(t==null?void 0:t.lessons.length)??0,_=v>0?Math.round(S/v*100):0,T=s&&t?C(c,t.id,s.id):"not_started",n=s?q[s.id]:void 0,L=async r=>{!t||!s||await h(t.slug,s.slug,r)},M=async()=>{if(t)try{await h(t.slug,null,"completed"),await Q()}catch(r){console.error("Failed to mark module as complete:",r)}},H=(r,a)=>{!s||n!=null&&n.submitted||B(o=>({...o,[j(s.id,r)]:a}))},D=async()=>{if(!t||!s||n!=null&&n.submitted)return;const r=P(s.content_md),a=$(r);if(a.length===0)return;const o=a.reduce((d,f)=>A[j(s.id,f.id)]===f.correct?d+1:d,0),p=Math.round(o/a.length*100);E(d=>({...d,[s.id]:{score:p,submitted:!0}})),await h(t.slug,s.slug,"completed",p)};if(N)return e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-50 text-gray-600 dark:bg-gray-900 dark:text-gray-300",children:e.jsx("span",{className:"text-sm",children:"Loading module..."})});if(b)return e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-50 dark:bg-gray-900",children:e.jsxs(g,{className:"max-w-md border border-red-200 bg-red-50 p-6 text-center text-red-700 dark:border-red-900/40 dark:bg-red-900/20 dark:text-red-200",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Academy module unavailable"}),e.jsx("p",{className:"mt-2 text-sm",children:b}),e.jsx(x,{className:"mt-4",onClick:()=>l("/academy"),children:"Back to Academy"})]})});if(!t)return e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-50 dark:bg-gray-900",children:e.jsxs(g,{className:"max-w-md border border-gray-200 bg-white p-6 text-center text-gray-700 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Module not found"}),e.jsx("p",{className:"mt-2 text-sm",children:"The module you're looking for is unavailable."}),e.jsx(x,{className:"mt-4",onClick:()=>l("/academy"),children:"Back to Academy"})]})});const F=()=>{if(!s)return null;if(s.type==="quiz"){const r=(n==null?void 0:n.submitted)??!1,a=(n==null?void 0:n.score)??null,o=P(s.content_md),p=$(o);return p.length===0?e.jsx("div",{className:"space-y-4",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Quiz content is not available. Please check back later."})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Quick knowledge check. Select the best answer for each prompt to lock in your score."}),p.map(d=>{const f=A[j(s.id,d.id)]??"";return e.jsxs("div",{className:"space-y-2 rounded-2xl border border-gray-200 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-900/40",children:[e.jsx("p",{className:"font-medium text-gray-800 dark:text-gray-100",children:d.prompt}),e.jsx("div",{className:"space-y-2 text-sm",children:d.options.map(u=>{const w=f===u.value,J=r&&u.value===d.correct,K=r&&w&&u.value!==d.correct;return e.jsxs("label",{className:`flex cursor-pointer items-center gap-2 rounded-xl border px-3 py-2 transition ${J?"border-emerald-500/60 bg-emerald-500/10 text-emerald-700 dark:text-emerald-200":K?"border-red-500/60 bg-red-500/10 text-red-700 dark:text-red-200":w?"border-blue-500/60 bg-blue-500/10 text-blue-700 dark:text-blue-200":"border-gray-200 bg-white text-gray-600 hover:border-blue-300 hover:bg-blue-50/70 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:hover:border-blue-400 dark:hover:bg-blue-900/20"}`,children:[e.jsx("input",{type:"radio",name:j(s.id,d.id),value:u.value,checked:w,disabled:r,onChange:()=>H(d.id,u.value),className:"h-4 w-4"}),e.jsx("span",{children:u.label})]},u.value)})})]},d.id)}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(x,{size:"sm",onClick:D,disabled:r,children:r?"Quiz Submitted":"Submit Quiz"}),r&&a!==null&&e.jsxs("span",{className:"text-sm font-semibold text-emerald-500",children:["Score saved: ",a,"%"]})]})]})}if(s.type==="guide"&&s.content_md){const r=s.content_md.split(/\n{2,}/);return e.jsx("div",{className:"space-y-3 text-sm leading-relaxed text-gray-700 dark:text-gray-200",children:r.map((a,o)=>e.jsx("p",{className:"whitespace-pre-wrap",children:a.trim()},o))})}return s.type==="video"&&s.media_url?e.jsx("div",{className:"overflow-hidden rounded-2xl border border-gray-200 dark:border-gray-700",children:e.jsx("video",{src:s.media_url,controls:!0,className:"w-full bg-black"})}):e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Lesson content coming soon. Check back shortly or mark the lesson once you've reviewed external material."})};return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24 text-gray-900 dark:bg-gray-900 dark:text-gray-100",children:[e.jsx(V,{title:t.title,subtitle:"Deepen your mastery with immersive lessons, walkthroughs, and quick knowledge checks.",rightAction:e.jsx(x,{variant:"secondary",size:"sm",onClick:()=>l("/academy"),children:"Back to Academy"})}),e.jsx("main",{className:"px-4 pt-24 pb-16",children:e.jsxs("div",{className:"mx-auto flex max-w-6xl flex-col gap-6 lg:flex-row",children:[e.jsxs("aside",{className:"w-full max-w-sm space-y-4 lg:w-72",children:[e.jsxs(g,{className:"space-y-3 border border-blue-100 bg-gradient-to-br from-white to-blue-50 p-6 dark:border-blue-900/40 dark:from-gray-900 dark:to-blue-950/40",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.3em] text-blue-400",children:"Module Progress"}),e.jsxs("div",{className:"text-3xl font-semibold text-blue-600 dark:text-blue-300",children:[_,"%"]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[S," of ",v," lessons completed."]}),e.jsx("div",{className:"mt-2 h-2 w-full overflow-hidden rounded-full bg-blue-100 dark:bg-blue-950/40",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-sky-400 via-indigo-500 to-purple-500 transition-all",style:{width:`${_}%`}})}),e.jsx(x,{variant:"secondary",size:"sm",onClick:M,children:"Mark Module Complete"})]}),e.jsx(g,{className:"space-y-3 border border-gray-200 bg-white p-5 text-sm text-gray-600 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300",children:e.jsx("p",{children:"Lessons automatically mark as in progress when opened. Use the controls below each lesson to record completion or retake the quiz at any time."})}),e.jsx("div",{className:"space-y-3",children:t.lessons.map(r=>{const a=C(c,t.id,r.id),o=r.id===(s==null?void 0:s.id);return e.jsxs("button",{onClick:()=>z(r.id),className:`w-full rounded-2xl border px-4 py-4 text-left transition ${o?"border-blue-500 bg-blue-50 text-blue-700 dark:border-blue-500 dark:bg-blue-900/30 dark:text-blue-100":"border-gray-200 bg-white text-gray-700 hover:border-blue-300 hover:bg-blue-50/60 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:hover:border-blue-400 dark:hover:bg-blue-900/20"}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-xs font-semibold uppercase tracking-[0.3em]",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("i",{className:`${I[r.type]} text-lg`}),r.title]}),e.jsxs("span",{className:`flex items-center gap-1 ${a==="completed"?"text-emerald-500":a==="in_progress"?"text-blue-400":"text-gray-400"}`,children:[a==="completed"&&e.jsx("i",{className:"ri-checkbox-circle-fill"}),a==="in_progress"&&e.jsx("i",{className:"ri-time-line"}),a==="not_started"&&e.jsx("i",{className:"ri-circle-line"})]})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 capitalize",children:r.type})]},r.id)})})]}),e.jsx("section",{className:"flex-1 space-y-6",children:s?e.jsxs(g,{className:"space-y-6 border border-gray-200 bg-white p-6 shadow-sm dark:border-gray-700 dark:bg-gray-900",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3 text-xs font-semibold uppercase tracking-[0.3em] text-blue-400",children:[e.jsx("i",{className:`${I[s.type]} text-lg`}),s.type]}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:s.title})]}),F(),s.type!=="quiz"&&e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(x,{size:"sm",variant:"secondary",onClick:()=>L("in_progress"),children:"Mark In Progress"}),e.jsx(x,{size:"sm",onClick:()=>L("completed"),children:"Mark Completed"})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Status: ",T.replace("_"," ")]}),e.jsx(x,{variant:"ghost",size:"sm",onClick:M,children:"Complete Module"})]})]}):e.jsx(g,{className:"border border-gray-200 bg-white p-10 text-center text-gray-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300",children:e.jsx("p",{children:"Select a lesson to get started."})})})]})}),e.jsx(U,{})]})}export{se as default};
