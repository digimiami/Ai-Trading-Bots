import{r as m,A as F,b as I,j as e}from"./index-083772a1.js";import{H as _}from"./Header-784e78b4.js";import{N as M}from"./Navigation-eb5926f6.js";import{C as r}from"./Card-13f990a5.js";import{B as O}from"./Button-26f47c54.js";import{u as H}from"./useBots-6324f817.js";function V(x){const[f,g]=m.useState([]),[y,N]=m.useState(!0),[b,p]=m.useState(null),o=async()=>{try{N(!0);const n=x?`${F.TRADING_ENGINE}/trades?botId=${x}`:`${F.TRADING_ENGINE}/trades`,h=await I(n);g(h.trades||[]),p(null)}catch(n){p(n instanceof Error?n.message:"Failed to fetch trades")}finally{N(!1)}},i=async(n,h)=>{try{const c=await I(`${F.TRADING_ENGINE}/close-trade`,{method:"POST",body:JSON.stringify({tradeId:n,exitPrice:h})});return await o(),c.trade}catch(c){throw new Error(c instanceof Error?c.message:"Failed to close trade")}};return m.useEffect(()=>{o();const n=setInterval(o,3e4);return()=>clearInterval(n)},[x]),{trades:f,loading:y,error:b,fetchTrades:o,closeTrade:i}}function ee(){const[x,f]=m.useState("all"),[g,y]=m.useState("all"),{trades:N,loading:b,fetchTrades:p}=V(),{bots:o}=H(),i=N.filter(t=>!(x!=="all"&&t.status!==x||g!=="all"&&t.botId!==g)),n=t=>{switch(t){case"open":return"text-blue-600 bg-blue-50";case"closed":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},h=t=>t==="long"?"text-green-600":"text-red-600",c=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:4}).format(t),C=t=>{if(!t)return"-";const a=t>=0?"text-green-600":"text-red-600",d=t>=0?"+":"";return e.jsxs("span",{className:a,children:[d,c(t)]})},B=()=>{confirm("Are you sure you want to reset all trade data? This will clear all trade history.")&&(localStorage.removeItem("trades"),p())},R=t=>{const a=o.find(d=>d.id===t);return(a==null?void 0:a.name)||"Unknown Bot"};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(_,{title:"Trades",subtitle:"Monitor your trading activity",rightAction:e.jsxs(O,{variant:"danger",size:"sm",onClick:B,children:[e.jsx("i",{className:"ri-refresh-line mr-1"}),"Reset"]})}),e.jsxs("div",{className:"pt-20 pb-20 px-4 space-y-4",children:[e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsx("div",{className:"flex space-x-2",children:["all","open","closed"].map(t=>e.jsx("button",{onClick:()=>f(t),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${x===t?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bot"}),e.jsxs("select",{value:g,onChange:t=>y(t.target.value),className:"w-full bg-gray-100 border-none rounded-lg px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"All Bots"}),o.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]})}),(()=>{const a=i.filter(s=>s.status==="closed"||s.status==="filled").filter(s=>s.pnl!==null&&s.pnl!==void 0&&s.pnl!==0),d=a.filter(s=>(s.pnl||0)>0),w=a.filter(s=>(s.pnl||0)<0),k=a.reduce((s,l)=>s+(l.pnl||0),0),T=d.reduce((s,l)=>s+(l.pnl||0),0),P=Math.abs(w.reduce((s,l)=>s+(l.pnl||0),0)),E=a.length>0?d.length/a.length*100:0,L=P>0?T/P:T>0?999:0,z=d.length>0?T/d.length:0,G=w.length>0?P/w.length:0,U=i.reduce((s,l)=>{var $,A;const j=parseFloat((($=l.size)==null?void 0:$.toString())||"0"),W=parseFloat(((A=l.entryPrice)==null?void 0:A.toString())||"0");return s+j*W},0);let S=0,D=0,u=0,v=0;return[...a].sort((s,l)=>new Date(s.timestamp).getTime()-new Date(l.timestamp).getTime()).forEach(s=>{const l=s.pnl||0;v+=l,v>u&&(u=v);const j=u-v;j>S&&(S=j,D=u>0?j/u*100:0)}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-9 gap-4",children:[e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:i.length}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Trades"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:i.filter(s=>s.status==="open").length}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Active Trades"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-2xl font-bold ${E>=50?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[E.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Win Rate"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-2xl font-bold ${L>=1?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[L.toFixed(2),"x"]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Profit Factor"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:["$",z.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Avg Win"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:["$",G.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Avg Loss"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:["$",U.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Volume"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-2xl font-bold ${k>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[k>=0?"+":"","$",k.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total PnL"})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:["$",S.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Max Drawdown"}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:[D.toFixed(1),"%"]})]})})]})})(),e.jsx("div",{className:"space-y-3",children:b?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading trades..."})]}):i.length===0?e.jsxs(r,{className:"p-8 text-center",children:[e.jsx("i",{className:"ri-file-list-line text-4xl text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Trades Found"}),e.jsx("p",{className:"text-gray-500",children:"No trades match your current filters."})]}):i.map(t=>e.jsxs(r,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${n(t.status)}`,children:t.status.toUpperCase()}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(t.timestamp).toLocaleDateString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.symbol}),e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:t.exchange})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Bot"}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:R(t.botId)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Side"}),e.jsx("div",{className:`text-sm font-medium ${h(t.side)}`,children:t.side.toUpperCase()})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Size"}),e.jsx("div",{className:"font-medium",children:t.size})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Entry Price"}),e.jsx("div",{className:"font-medium",children:c(t.entryPrice)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:t.status==="open"?"Current P&L":"P&L"}),e.jsx("div",{className:"font-medium",children:C(t.pnl)})]})]}),t.exitPrice&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Exit Price:"}),e.jsx("span",{className:"font-medium",children:c(t.exitPrice)})]})})]},t.id))}),e.jsxs(r,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{className:"bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center",children:[e.jsx("i",{className:"ri-download-line mr-2"}),"Export Trades"]}),e.jsxs("button",{className:"bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-4 rounded-lg transition-colors flex items-center justify-center",children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Refresh Data"]})]})]})]}),e.jsx(M,{})]})}export{ee as default};
