import{a as V,u as Z,r as o,s as p,j as e}from"./index-7db8efba.js";import{H as T}from"./Header-51f5643b.js";import{N as _}from"./Navigation-03d82daa.js";import{C as k}from"./Card-5e232337.js";import{B as b}from"./Button-9007c314.js";import{u as G}from"./useBots-7cb4b4d9.js";function te(){const u=V(),{user:c}=Z(),{createBot:D,startBot:R}=G(),[x,M]=o.useState([]),[A,S]=o.useState(!0),[C,P]=o.useState(null),[L,f]=o.useState(null),[h,E]=o.useState({}),[d,F]=o.useState({}),[y,z]=o.useState({}),[N,O]=o.useState({}),[U,$]=o.useState({});o.useEffect(()=>{B()},[]),o.useEffect(()=>{if(x.length>0){const a={};x.forEach(r=>{h[r.id]||(a[r.id]={paperTrading:!1,tradeAmount:r.trade_amount||100,customPair:r.symbol==="CUSTOM"?"":void 0})}),Object.keys(a).length>0&&E(r=>({...r,...a}))}},[x]);const B=async()=>{try{S(!0),P(null);const{data:a,error:r}=await p.from("pablo_ready_bots").select("*").eq("enabled",!0).order("order_index",{ascending:!0}).order("created_at",{ascending:!1});if(r)throw r;M(a||[])}catch(a){console.error("Error fetching Pablo Ready bots:",a),P((a==null?void 0:a.message)||"Failed to load bots")}finally{S(!1)}},H=async a=>{var r,s,i;if(!c){u("/auth");return}try{f(a.id);const t=h[a.id]||{paperTrading:!1,tradeAmount:a.trade_amount||100},n=((r=a.strategy)==null?void 0:r.allows_custom_pair)===!0||a.symbol==="CUSTOM",l=n&&((s=t.customPair)==null?void 0:s.trim().toUpperCase())||a.symbol;if(n&&!((i=t.customPair)!=null&&i.trim())){alert("❌ Please enter a trading pair (e.g., BTCUSDT, ETHUSDT)"),f(null);return}if(n&&t.customPair&&!/^[A-Z0-9]{2,20}USDT$/.test(t.customPair.trim().toUpperCase())){alert("❌ Invalid pair format. Please use format like BTCUSDT, ETHUSDT, SOLUSDT"),f(null);return}const m={name:`${a.name} - ${l}`,exchange:a.exchange,symbol:l,tradingType:a.trading_type,leverage:a.leverage,riskLevel:a.risk_level,tradeAmount:t.tradeAmount,stopLoss:a.stop_loss,takeProfit:a.take_profit,timeframe:a.timeframe,strategy:a.strategy,strategyConfig:a.strategy_config,paperTrading:t.paperTrading,status:"running",pnl:0,pnlPercentage:0,totalTrades:0,winRate:0},g=await D(m);g&&(g.status!=="running"&&await R(g.id),alert(`✅ Bot "${g.name}" created and started successfully!`),u("/bots"))}catch(t){console.error("Error starting bot:",t),alert(`❌ Failed to start bot: ${(t==null?void 0:t.message)||t}`)}finally{f(null)}},j=(a,r,s)=>{E(i=>({...i,[a]:{...i[a],[r]:s}}))};o.useEffect(()=>{if(c&&x.length>0){(async()=>{try{const{data:s}=await p.from("trading_bots").select("id, pnl, pnl_percentage, total_trades, win_rate, symbol, name").eq("user_id",c.id).order("created_at",{ascending:!1});if(s){const i={},t={};x.forEach(n=>{const l=s.find(m=>m.symbol===n.symbol&&(m.name.includes(n.name)||m.name.includes(n.symbol)));if(l){const m=l.win_rate||0,g=l.total_trades||0,v=Math.round(g*(m/100)),Q=g-v;i[n.id]={pnl:l.pnl||0,pnlPercentage:l.pnl_percentage||0,totalTrades:g,winRate:m,wins:v,losses:Q},w(n.id,l.id)}}),F(n=>({...n,...i}))}}catch(s){console.error("Error fetching bot data:",s)}})();const r=setInterval(async()=>{if(c&&x.length>0)try{const{data:s}=await p.from("trading_bots").select("id, symbol, name").eq("user_id",c.id);s&&x.forEach(i=>{const t=s.find(n=>n.symbol===i.symbol&&(n.name.includes(i.name)||n.name.includes(i.symbol)));t&&w(i.id,t.id)})}catch(s){console.error("Error refreshing logs:",s)}},1e4);return()=>clearInterval(r)}},[c,x]);const w=async(a,r)=>{if(!U[a])try{$(t=>({...t,[a]:!0}));const{data:s,error:i}=await p.from("bot_activity_logs").select("*").eq("bot_id",r).order("timestamp",{ascending:!1}).limit(20);if(i)throw i;z(t=>({...t,[a]:s||[]}))}catch(s){console.error("Error fetching bot logs:",s)}finally{$(s=>({...s,[a]:!1}))}},q=a=>{O(r=>({...r,[a]:!r[a]})),!N[a]&&!y[a]&&p.from("trading_bots").select("id, symbol, name").eq("user_id",c==null?void 0:c.id).then(({data:r})=>{if(r){const s=x.find(i=>i.id===a);if(s){const i=r.find(t=>t.symbol===s.symbol&&(t.name.includes(s.name)||t.name.includes(s.symbol)));i&&w(a,i.id)}}})},W=a=>{const r=new Date(a),i=new Date().getTime()-r.getTime(),t=Math.floor(i/6e4);if(t<1)return"Just now";if(t<60)return`${t}m ago`;const n=Math.floor(t/60);return n<24?`${n}h ago`:r.toLocaleDateString()},J=a=>{switch(a==null?void 0:a.toLowerCase()){case"error":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-200";case"warning":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200";case"success":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-200";case"info":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}};return A?e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(T,{title:"Pablo Ready"}),e.jsx("div",{className:"pt-24 pb-20 px-4",children:e.jsx(k,{className:"p-6 text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Loading Pablo Ready bots..."})})}),e.jsx(_,{})]}):C?e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(T,{title:"Pablo Ready"}),e.jsx("div",{className:"pt-24 pb-20 px-4",children:e.jsxs(k,{className:"p-6 border border-red-200 bg-red-50 dark:border-red-900/40 dark:bg-red-900/20",children:[e.jsx("p",{className:"text-red-700 dark:text-red-200",children:C}),e.jsx(b,{className:"mt-4",onClick:B,size:"sm",children:"Retry"})]})}),e.jsx(_,{})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 pb-24",children:[e.jsx(T,{title:"Pablo Ready",subtitle:"Pre-configured trading bots ready to deploy. Choose a bot and start trading instantly.",rightAction:e.jsx(b,{variant:"secondary",size:"sm",onClick:()=>u("/bots"),children:"My Bots"})}),e.jsx("main",{className:"px-4 pt-24 pb-16",children:e.jsx("div",{className:"mx-auto max-w-6xl space-y-6",children:x.length===0?e.jsxs(k,{className:"p-10 text-center",children:[e.jsx("div",{className:"text-gray-400 dark:text-gray-500 mb-4",children:e.jsx("i",{className:"ri-robot-line text-5xl"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No Pablo Ready bots available"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Check back soon for new pre-configured bots."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:x.map(a=>{var r,s,i,t,n;return e.jsx(k,{className:"group overflow-hidden border border-gray-200/70 bg-white/90 shadow-sm transition hover:-translate-y-1 hover:border-blue-300 hover:shadow-lg dark:border-gray-700 dark:bg-gray-900/90",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:a.name}),a.featured&&e.jsxs("span",{className:"inline-flex items-center rounded-full bg-yellow-100 px-2 py-0.5 text-xs font-semibold text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200",children:[e.jsx("i",{className:"ri-star-fill mr-1"}),"Featured"]})]}),a.description&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-300 mt-1",children:a.description})]})}),e.jsxs("div",{className:"space-y-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs mb-1",children:"Exchange"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white capitalize",children:a.exchange})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs mb-1",children:"Symbol"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:a.symbol==="CUSTOM"?"Custom (User Input)":a.symbol})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs mb-1",children:"Type"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white capitalize",children:a.trading_type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs mb-1",children:"Leverage"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[a.leverage,"x"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs mb-1",children:"Risk Level"}),e.jsx("span",{className:`font-medium capitalize ${a.risk_level==="low"?"text-green-600 dark:text-green-400":a.risk_level==="medium"?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"}`,children:a.risk_level})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs mb-1",children:"Timeframe"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:a.timeframe})]})]}),a.strategy_config&&e.jsx("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.strategy_config.enable_tp===!0&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200",children:[e.jsx("i",{className:"ri-target-line mr-1"}),"Multi TP"]}),a.strategy_config.enable_trail_sl===!0&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-200",children:[e.jsx("i",{className:"ri-line-chart-line mr-1"}),"Trailing SL"]}),a.strategy_config.volume_multiplier&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-200",children:[e.jsx("i",{className:"ri-bar-chart-line mr-1"}),"Volume Filter"]})]})})]}),c&&e.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Trading Mode"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>j(a.id,"paperTrading",!1),className:`px-3 py-1 rounded text-xs font-medium transition ${(r=h[a.id])!=null&&r.paperTrading?"bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300":"bg-blue-600 text-white"}`,children:"Real"}),e.jsx("button",{onClick:()=>j(a.id,"paperTrading",!0),className:`px-3 py-1 rounded text-xs font-medium transition ${(s=h[a.id])!=null&&s.paperTrading?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300"}`,children:"Paper"})]})]}),(((i=a.strategy)==null?void 0:i.allows_custom_pair)===!0||a.symbol==="CUSTOM")&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Trading Pair ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",placeholder:"e.g., BTCUSDT, ETHUSDT, SOLUSDT",value:((t=h[a.id])==null?void 0:t.customPair)||"",onChange:l=>j(a.id,"customPair",l.target.value.toUpperCase()),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Enter the trading pair you want to follow (must end with USDT)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Trade Amount ($)"}),e.jsx("input",{type:"number",min:"10",step:"10",value:((n=h[a.id])==null?void 0:n.tradeAmount)||a.trade_amount||100,onChange:l=>j(a.id,"tradeAmount",parseFloat(l.target.value)||100),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"})]}),d[a.id]&&e.jsx("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"PnL"}),e.jsxs("p",{className:`font-semibold ${d[a.id].pnl>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:["$",d[a.id].pnl.toFixed(2)," (",d[a.id].pnlPercentage.toFixed(2),"%)"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Win Rate"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:[d[a.id].winRate.toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Total Trades"}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:d[a.id].totalTrades})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Win/Loss"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400",children:d[a.id].wins}),e.jsx("span",{className:"text-gray-400 dark:text-gray-500 mx-1",children:"/"}),e.jsx("span",{className:"text-red-600 dark:text-red-400",children:d[a.id].losses})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Fees"}),e.jsxs("p",{className:"font-semibold text-red-600 dark:text-red-400",children:["$",(d[a.id].totalTrades*(a.trade_amount||100)*.001).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Drawdown"}),e.jsx("p",{className:"font-semibold text-red-600 dark:text-red-400",children:d[a.id].pnl<0?`$${Math.abs(d[a.id].pnl).toFixed(2)}`:"$0.00"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Win/Loss"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:[d[a.id].wins,"/",d[a.id].losses]})]})]})}),e.jsx(b,{onClick:()=>H(a),className:"w-full",size:"sm",disabled:L===a.id,children:L===a.id?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-loader-4-line animate-spin mr-2"}),"Starting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-play-line mr-2"}),"Start Bot"]})}),c&&e.jsxs("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>q(a.id),className:"w-full flex items-center justify-between text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"ri-file-list-line"}),"Activity Logs",y[a.id]&&y[a.id].length>0&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200 rounded text-xs",children:y[a.id].length})]}),e.jsx("i",{className:`ri-arrow-${N[a.id]?"up":"down"}-s-line`})]}),N[a.id]&&e.jsx("div",{className:"mt-3 max-h-64 overflow-y-auto space-y-2",children:U[a.id]?e.jsxs("div",{className:"text-center py-4 text-gray-500 text-sm",children:[e.jsx("i",{className:"ri-loader-4-line animate-spin text-lg mb-1"}),e.jsx("p",{children:"Loading logs..."})]}):y[a.id]&&y[a.id].length>0?y[a.id].map((l,m)=>e.jsxs("div",{className:"p-2 bg-gray-50 dark:bg-gray-800 rounded text-xs",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs font-medium ${J(l.level)}`,children:l.level||"info"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-xs",children:W(l.timestamp)})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-xs mt-1",children:l.message}),l.category&&e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 text-xs mt-1 block",children:["Category: ",l.category]})]},l.id||m)):e.jsxs("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400 text-sm",children:[e.jsx("i",{className:"ri-file-list-line text-lg mb-1"}),e.jsx("p",{children:"No logs yet. Bot will show activity here once it starts trading."})]})})]})]}),!c&&e.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs(b,{onClick:()=>u("/auth"),className:"w-full",variant:"secondary",size:"sm",children:[e.jsx("i",{className:"ri-login-box-line mr-2"}),"Sign In to Use"]})})]})},a.id)})})})}),e.jsx(_,{})]})}export{te as default};
