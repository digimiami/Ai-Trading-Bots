import{r as l,j as e}from"./index-f85c1399.js";import{C as o}from"./Card-6c7cc8b8.js";import{B as T}from"./Button-b77908a5.js";function I(){const[d,w]=l.useState([]),[p,S]=l.useState([]),[j,$]=l.useState([]),[b,C]=l.useState([]),[F,E]=l.useState(!0),[f,h]=l.useState(!1),[g,M]=l.useState(null),[P,A]=l.useState(new Map),m=async()=>{try{const t=await(await fetch("/api/market-data?action=all")).json();t.marketData&&(w(t.marketData),S(t.topGainers||[]),$(t.rapidChanges||[]))}catch(s){console.error("Error fetching market data:",s)}finally{E(!1)}},N=async()=>{var s;try{const t=((s={}.VITE_SUPABASE_URL)==null?void 0:s.replace("/rest/v1",""))||"",a={}.VITE_SUPABASE_ANON_KEY||"",i=await(await fetch(`${t}/functions/v1/market-data?action=alerts`,{headers:{apikey:a,Authorization:`Bearer ${a}`}})).json();i.alerts&&C(i.alerts)}catch(t){console.error("Error fetching alerts:",t)}};l.useEffect(()=>{if(!d.map(r=>r.symbol).join(","))return;const t="wss://stream.bybit.com/v5/public/spot",a=new WebSocket(t);return a.onopen=()=>{console.log("WebSocket connected"),h(!0);const r={op:"subscribe",args:d.map(i=>`ticker.${i.symbol}`)};a.send(JSON.stringify(r))},a.onmessage=r=>{var i,k;try{const x=JSON.parse(r.data);if((i=x.topic)!=null&&i.startsWith("ticker.")){const D=x.topic.replace("ticker.",""),u=parseFloat(((k=x.data)==null?void 0:k.lastPrice)||"0");u>0&&A(R=>{const v=new Map(R);return v.set(D,u),v})}}catch(x){console.error("Error parsing WebSocket message:",x)}},a.onerror=r=>{console.error("WebSocket error:",r),h(!1)},a.onclose=()=>{console.log("WebSocket disconnected"),h(!1),setTimeout(()=>{d.length>0},5e3)},()=>{a.close()}},[d.length]),l.useEffect(()=>{m(),N();const s=setInterval(()=>{m(),N()},3e4);return()=>clearInterval(s)},[]);const n=(s,t=2)=>s>=1e9?(s/1e9).toFixed(t)+"B":s>=1e6?(s/1e6).toFixed(t)+"M":s>=1e3?(s/1e3).toFixed(t)+"K":s.toFixed(t),c=s=>s>=1e3?s.toFixed(2):s>=1?s.toFixed(4):s.toFixed(8),y=(s,t)=>P.get(s)||t;return F?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-loader-4-line animate-spin text-4xl text-blue-500"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-4",children:"Loading market data..."})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Market Dashboard"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:["Real-time crypto market analysis",f&&e.jsxs("span",{className:"ml-2 inline-flex items-center gap-1 text-green-500",children:[e.jsx("i",{className:"ri-circle-fill text-xs"}),"Live"]})]})]}),e.jsxs(T,{onClick:m,variant:"secondary",size:"sm",children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Refresh"]})]}),b.length>0&&e.jsx("div",{className:"space-y-2",children:b.map((s,t)=>e.jsx(o,{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("i",{className:"ri-alarm-line text-yellow-600 dark:text-yellow-400 text-xl"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-yellow-900 dark:text-yellow-100",children:s.type==="24h_high"?`24h High: ${s.symbol} at $${c(s.price||0)}`:`Large Volume: ${s.symbol} - $${n(s.volume24h||0)}`}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:new Date(s.timestamp).toLocaleTimeString()})]})]})},t))}),p.length>0&&e.jsxs(o,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Top Gainers (24h)"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:p.map(s=>e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:s.symbol.replace("USDT","")}),e.jsxs("span",{className:`text-sm font-medium ${s.change24h>=0?"text-green-600":"text-red-600"}`,children:[s.change24h>=0?"+":"",s.change24h.toFixed(2),"%"]})]}),e.jsxs("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:["$",c(y(s.symbol,s.price))]})]},s.symbol))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Market Overview"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map(s=>{const t=y(s.symbol,s.price),a=t-s.price,r=a>=0;return e.jsxs(o,{className:`p-6 cursor-pointer transition-all hover:shadow-lg ${g===s.symbol?"ring-2 ring-blue-500":""}`,onClick:()=>M(g===s.symbol?null:s.symbol),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:s.symbol.replace("USDT","")}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Market Cap: $",n(s.marketCap)]})]}),e.jsxs("div",{className:`text-right ${r?"text-green-600":"text-red-600"}`,children:[e.jsxs("p",{className:"text-sm font-medium",children:[r?"+":"",(a/s.price*100).toFixed(2),"%"]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["24h: ",s.change24h>=0?"+":"",s.change24h.toFixed(2),"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["$",c(t)]}),f&&e.jsxs("span",{className:"text-xs text-green-500",children:[e.jsx("i",{className:"ri-circle-fill text-xs"})," Live"]})]}),g===s.symbol&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"VWAP"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:["$",c(s.vwap)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"ATR"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:["$",c(s.atr)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"RSI"}),e.jsx("p",{className:`font-semibold ${s.rsi>70?"text-red-600":s.rsi<30?"text-green-600":"text-gray-900 dark:text-white"}`,children:s.rsi.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Volume 24h"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:["$",n(s.volume24h)]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Inflow"}),e.jsxs("p",{className:"font-semibold text-green-600",children:["$",n(s.inflow)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Outflow"}),e.jsxs("p",{className:"font-semibold text-red-600",children:["$",n(s.outflow)]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 pt-2",children:[e.jsxs("p",{children:["24h High: $",c(s.high24h)]}),e.jsxs("p",{children:["24h Low: $",c(s.low24h)]})]})]})]})]},s.symbol)})})]}),j.length>0&&e.jsxs(o,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Rapid Changes (>5% in 24h)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-300",children:"Symbol"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-gray-700 dark:text-gray-300",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-gray-700 dark:text-gray-300",children:"Change 24h"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-gray-700 dark:text-gray-300",children:"Volume"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold text-gray-700 dark:text-gray-300",children:"RSI"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:j.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900 dark:text-white",children:s.symbol}),e.jsxs("td",{className:"px-4 py-3 text-right text-gray-700 dark:text-gray-300",children:["$",c(y(s.symbol,s.price))]}),e.jsxs("td",{className:`px-4 py-3 text-right font-medium ${s.change24h>=0?"text-green-600":"text-red-600"}`,children:[s.change24h>=0?"+":"",s.change24h.toFixed(2),"%"]}),e.jsxs("td",{className:"px-4 py-3 text-right text-gray-700 dark:text-gray-300",children:["$",n(s.volume24h)]}),e.jsx("td",{className:`px-4 py-3 text-right font-medium ${s.rsi>70?"text-red-600":s.rsi<30?"text-green-600":"text-gray-700 dark:text-gray-300"}`,children:s.rsi.toFixed(2)})]},s.symbol))})]})})]})]})})}export{I as default};
