import{a as V,u as Z,r as c,s as p,j as e}from"./index-a5d801a8.js";import{H as T}from"./Header-d0707f46.js";import{N as _}from"./Navigation-1350973f.js";import{C as b}from"./Card-c3de768e.js";import{B as k}from"./Button-90bd3460.js";import{u as G}from"./useBots-520fae13.js";function ae(){const h=V(),{user:d}=Z(),{createBot:D,startBot:$}=G(),[o,A]=c.useState([]),[M,S]=c.useState(!0),[C,P]=c.useState(null),[L,f]=c.useState(null),[u,E]=c.useState({}),[m,F]=c.useState({}),[y,z]=c.useState({}),[N,O]=c.useState({}),[U,B]=c.useState({});c.useEffect(()=>{R()},[]),c.useEffect(()=>{if(o.length>0){const t={};o.forEach(r=>{u[r.id]||(t[r.id]={paperTrading:!1,tradeAmount:r.trade_amount||100,customPair:r.symbol==="CUSTOM"?"":void 0})}),Object.keys(t).length>0&&E(r=>({...r,...t}))}},[o]);const R=async()=>{try{S(!0),P(null);const{data:t,error:r}=await p.from("pablo_ready_bots").select("*").eq("enabled",!0).order("order_index",{ascending:!0}).order("created_at",{ascending:!1});if(r)throw r;A(t||[])}catch(t){console.error("Error fetching Pablo Ready bots:",t),P((t==null?void 0:t.message)||"Failed to load bots")}finally{S(!1)}},H=async t=>{var r,s,i;if(!d){h("/auth");return}try{f(t.id);const a=u[t.id]||{paperTrading:!1,tradeAmount:t.trade_amount||100},n=((r=t.strategy)==null?void 0:r.allows_custom_pair)===!0||t.symbol==="CUSTOM",l=n&&((s=a.customPair)==null?void 0:s.trim().toUpperCase())||t.symbol;if(n&&!((i=a.customPair)!=null&&i.trim())){alert("❌ Please enter a trading pair (e.g., BTCUSDT, ETHUSDT)"),f(null);return}if(n&&a.customPair&&!/^[A-Z0-9]{2,20}USDT$/.test(a.customPair.trim().toUpperCase())){alert("❌ Invalid pair format. Please use format like BTCUSDT, ETHUSDT, SOLUSDT"),f(null);return}const x={name:`${t.name} - ${l}`,exchange:t.exchange,symbol:l,tradingType:t.trading_type,leverage:t.leverage,riskLevel:t.risk_level,tradeAmount:a.tradeAmount,stopLoss:t.stop_loss,takeProfit:t.take_profit,timeframe:t.timeframe,strategy:t.strategy,strategyConfig:t.strategy_config,paperTrading:a.paperTrading,status:"running",pnl:0,pnlPercentage:0,totalTrades:0,winRate:0},g=await D(x);g&&(g.status!=="running"&&await $(g.id),alert(`✅ Bot "${g.name}" created and started successfully!`),h("/bots"))}catch(a){console.error("Error starting bot:",a),alert(`❌ Failed to start bot: ${(a==null?void 0:a.message)||a}`)}finally{f(null)}},j=(t,r,s)=>{E(i=>({...i,[t]:{...i[t],[r]:s}}))};c.useEffect(()=>{if(d&&o.length>0){(async()=>{try{const{data:s}=await p.from("trading_bots").select("id, pnl, pnl_percentage, total_trades, win_rate, symbol, name").eq("user_id",d.id).order("created_at",{ascending:!1});if(s){const i={},a={};o.forEach(n=>{const l=s.find(x=>x.symbol===n.symbol&&(x.name.includes(n.name)||x.name.includes(n.symbol)));if(l){const x=l.win_rate||0,g=l.total_trades||0,v=Math.round(g*(x/100)),Q=g-v;i[n.id]={pnl:l.pnl||0,pnlPercentage:l.pnl_percentage||0,totalTrades:g,winRate:x,wins:v,losses:Q},w(n.id,l.id)}}),F(n=>({...n,...i}))}}catch(s){console.error("Error fetching bot data:",s)}})();const r=setInterval(async()=>{if(d&&o.length>0)try{const{data:s}=await p.from("trading_bots").select("id, symbol, name").eq("user_id",d.id);s&&o.forEach(i=>{const a=s.find(n=>n.symbol===i.symbol&&(n.name.includes(i.name)||n.name.includes(i.symbol)));a&&w(i.id,a.id)})}catch(s){console.error("Error refreshing logs:",s)}},1e4);return()=>clearInterval(r)}},[d,o]);const w=async(t,r)=>{if(!U[t])try{B(a=>({...a,[t]:!0}));const{data:s,error:i}=await p.from("bot_activity_logs").select("*").eq("bot_id",r).order("timestamp",{ascending:!1}).limit(20);if(i)throw i;z(a=>({...a,[t]:s||[]}))}catch(s){console.error("Error fetching bot logs:",s)}finally{B(s=>({...s,[t]:!1}))}},q=t=>{O(r=>({...r,[t]:!r[t]})),!N[t]&&!y[t]&&p.from("trading_bots").select("id, symbol, name").eq("user_id",d==null?void 0:d.id).then(({data:r})=>{if(r){const s=o.find(i=>i.id===t);if(s){const i=r.find(a=>a.symbol===s.symbol&&(a.name.includes(s.name)||a.name.includes(s.symbol)));i&&w(t,i.id)}}})},W=t=>{const r=new Date(t),i=new Date().getTime()-r.getTime(),a=Math.floor(i/6e4);if(a<1)return"Just now";if(a<60)return`${a}m ago`;const n=Math.floor(a/60);return n<24?`${n}h ago`:r.toLocaleDateString()},J=t=>{switch(t==null?void 0:t.toLowerCase()){case"error":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-200";case"warning":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200";case"success":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-200";case"info":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}};return M?e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(T,{title:"Pablo Ready"}),e.jsx("div",{className:"pt-24 pb-20 px-4",children:e.jsx(b,{className:"p-6 text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Loading Pablo Ready bots..."})})}),e.jsx(_,{})]}):C?e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(T,{title:"Pablo Ready"}),e.jsx("div",{className:"pt-24 pb-20 px-4",children:e.jsxs(b,{className:"p-6 border border-red-200 bg-red-50 dark:border-red-900/40 dark:bg-red-900/20",children:[e.jsx("p",{className:"text-red-700 dark:text-red-200",children:C}),e.jsx(k,{className:"mt-4",onClick:R,size:"sm",children:"Retry"})]})}),e.jsx(_,{})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 pb-24",children:[e.jsx(T,{title:"Pablo Ready",subtitle:"Pre-configured trading bots ready to deploy. Choose a bot and start trading instantly.",rightAction:e.jsx(k,{variant:"secondary",size:"sm",onClick:()=>h("/bots"),children:"My Bots"})}),e.jsx("main",{className:"px-4 pt-24 pb-16",children:e.jsx("div",{className:"mx-auto max-w-6xl space-y-6",children:o.length===0?e.jsxs(b,{className:"p-10 text-center",children:[e.jsx("div",{className:"text-gray-400 dark:text-gray-500 mb-4",children:e.jsx("i",{className:"ri-robot-line text-5xl"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No Pablo Ready bots available"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Check back soon for new pre-configured bots."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(t=>{var r,s,i,a,n;return e.jsx(b,{className:"group overflow-hidden border border-gray-200/70 bg-white/90 shadow-sm transition hover:-translate-y-1 hover:border-blue-300 hover:shadow-lg dark:border-gray-700 dark:bg-gray-900/90",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.name}),t.featured&&e.jsxs("span",{className:"inline-flex items-center rounded-full bg-yellow-100 px-2 py-0.5 text-xs font-semibold text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200",children:[e.jsx("i",{className:"ri-star-fill mr-1"}),"Featured"]})]}),t.description&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-300 mt-1",children:t.description})]})}),e.jsxs("div",{className:"space-y-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs mb-1",children:"Exchange"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white capitalize",children:t.exchange})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs mb-1",children:"Symbol"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.symbol==="CUSTOM"?"Custom (User Input)":t.symbol})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs mb-1",children:"Type"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white capitalize",children:t.trading_type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs mb-1",children:"Leverage"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[t.leverage,"x"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs mb-1",children:"Risk Level"}),e.jsx("span",{className:`font-medium capitalize ${t.risk_level==="low"?"text-green-600 dark:text-green-400":t.risk_level==="medium"?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"}`,children:t.risk_level})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 block text-xs mb-1",children:"Timeframe"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.timeframe})]})]}),t.strategy_config&&e.jsx("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.strategy_config.enable_tp===!0&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200",children:[e.jsx("i",{className:"ri-target-line mr-1"}),"Multi TP"]}),t.strategy_config.enable_trail_sl===!0&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-200",children:[e.jsx("i",{className:"ri-line-chart-line mr-1"}),"Trailing SL"]}),t.strategy_config.volume_multiplier&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-200",children:[e.jsx("i",{className:"ri-bar-chart-line mr-1"}),"Volume Filter"]})]})})]}),d&&e.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Trading Mode"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>j(t.id,"paperTrading",!1),className:`px-3 py-1 rounded text-xs font-medium transition ${(r=u[t.id])!=null&&r.paperTrading?"bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300":"bg-blue-600 text-white"}`,children:"Real"}),e.jsx("button",{onClick:()=>j(t.id,"paperTrading",!0),className:`px-3 py-1 rounded text-xs font-medium transition ${(s=u[t.id])!=null&&s.paperTrading?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300"}`,children:"Paper"})]})]}),(((i=t.strategy)==null?void 0:i.allows_custom_pair)===!0||t.symbol==="CUSTOM")&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Trading Pair ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",placeholder:"e.g., BTCUSDT, ETHUSDT, SOLUSDT",value:((a=u[t.id])==null?void 0:a.customPair)||"",onChange:l=>j(t.id,"customPair",l.target.value.toUpperCase()),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Enter the trading pair you want to follow (must end with USDT)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Trade Amount ($)"}),e.jsx("input",{type:"number",min:"10",step:"10",value:((n=u[t.id])==null?void 0:n.tradeAmount)||t.trade_amount||100,onChange:l=>j(t.id,"tradeAmount",parseFloat(l.target.value)||100),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"})]}),m[t.id]&&e.jsx("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"PnL"}),e.jsxs("p",{className:`font-semibold ${m[t.id].pnl>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:["$",m[t.id].pnl.toFixed(2)," (",m[t.id].pnlPercentage.toFixed(2),"%)"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Win Rate"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:[m[t.id].winRate.toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Total Trades"}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:m[t.id].totalTrades})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Win/Loss"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:[m[t.id].wins,"/",m[t.id].losses]})]})]})}),e.jsx(k,{onClick:()=>H(t),className:"w-full",size:"sm",disabled:L===t.id,children:L===t.id?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-loader-4-line animate-spin mr-2"}),"Starting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-play-line mr-2"}),"Start Bot"]})}),d&&e.jsxs("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>q(t.id),className:"w-full flex items-center justify-between text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"ri-file-list-line"}),"Activity Logs",y[t.id]&&y[t.id].length>0&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200 rounded text-xs",children:y[t.id].length})]}),e.jsx("i",{className:`ri-arrow-${N[t.id]?"up":"down"}-s-line`})]}),N[t.id]&&e.jsx("div",{className:"mt-3 max-h-64 overflow-y-auto space-y-2",children:U[t.id]?e.jsxs("div",{className:"text-center py-4 text-gray-500 text-sm",children:[e.jsx("i",{className:"ri-loader-4-line animate-spin text-lg mb-1"}),e.jsx("p",{children:"Loading logs..."})]}):y[t.id]&&y[t.id].length>0?y[t.id].map((l,x)=>e.jsxs("div",{className:"p-2 bg-gray-50 dark:bg-gray-800 rounded text-xs",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs font-medium ${J(l.level)}`,children:l.level||"info"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-xs",children:W(l.timestamp)})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-xs mt-1",children:l.message}),l.category&&e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 text-xs mt-1 block",children:["Category: ",l.category]})]},l.id||x)):e.jsxs("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400 text-sm",children:[e.jsx("i",{className:"ri-file-list-line text-lg mb-1"}),e.jsx("p",{children:"No logs yet. Bot will show activity here once it starts trading."})]})})]})]}),!d&&e.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs(k,{onClick:()=>h("/auth"),className:"w-full",variant:"secondary",size:"sm",children:[e.jsx("i",{className:"ri-login-box-line mr-2"}),"Sign In to Use"]})})]})},t.id)})})})}),e.jsx(_,{})]})}export{ae as default};
