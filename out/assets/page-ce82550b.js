import{r as s,u as T,b as $,j as e,s as d}from"./index-cc7d541d.js";import{B as A}from"./Button-2314ca8e.js";import{C as k}from"./Card-a07149d0.js";function J(){const[n,y]=s.useState(!0),[g,x]=s.useState(""),[h,v]=s.useState(""),[o,j]=s.useState(""),[u,m]=s.useState(!1),[f,r]=s.useState(null),[l,w]=s.useState(null),[F,N]=s.useState(!1),S=T(),{user:C,loading:p,signIn:E,signUp:I}=$();if(s.useEffect(()=>{!p&&C&&S("/")},[C,p,S]),s.useEffect(()=>{const t=new URLSearchParams(window.location.search).get("invite");t&&(j(t),y(!1),P(t))},[]),p)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(k,{title:"Loading...",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-gray-600",children:"Checking authentication..."})})})});const P=async a=>{try{const{data:{session:t}}=await d.auth.getSession(),i=await(await fetch(`${d.supabaseUrl}/functions/v1/invitation-management?action=validate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(t==null?void 0:t.access_token)||""}`},body:JSON.stringify({code:a})})).json();w(i.valid),i.valid&&i.invitation.email&&x(i.invitation.email)}catch{w(!1)}},O=async()=>{m(!0),r(null);try{const t=await(await fetch(`${d.supabaseUrl}/functions/v1/fix-auth-final`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:"digimiami@gmail.com",password:"lagina123"})})).json();t.success?(r(null),alert("Admin account fixed! You can now login with: digimiami@gmail.com / lagina123"),x("digimiami@gmail.com"),v("lagina123"),N(!1)):r(t.error||"Failed to fix admin account")}catch{r("Failed to fix admin account")}finally{m(!1)}},L=async a=>{var t,b;a.preventDefault(),m(!0),r(null);try{let i;if(n)i=await E(g,h);else if(i=await I(g,h),!i.error&&o)try{const{data:{session:c}}=await d.auth.getSession();await fetch(`${d.supabaseUrl}/functions/v1/invitation-management?action=use`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(c==null?void 0:c.access_token)||""}`},body:JSON.stringify({code:o,userId:(b=(t=i.data)==null?void 0:t.user)==null?void 0:b.id})})}catch(c){console.error("Failed to mark invitation as used:",c)}i.error&&r(i.error.message)}catch{r("An unexpected error occurred")}finally{m(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs(k,{className:"w-full max-w-md p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:n?"Welcome Back":"Create Account"}),e.jsx("p",{className:"text-gray-600",children:n?"Sign in to your trading account":"Start your trading journey"}),o&&e.jsx("div",{className:`mt-3 p-2 rounded-lg text-sm ${l===!0?"bg-green-50 text-green-700":l===!1?"bg-red-50 text-red-700":"bg-yellow-50 text-yellow-700"}`,children:l===!0?"✓ Valid invitation code":l===!1?"✗ Invalid or expired invitation":"Validating invitation..."})]}),e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[!n&&o&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"inviteCode",className:"block text-sm font-medium text-gray-700 mb-2",children:"Invitation Code"}),e.jsx("input",{id:"inviteCode",type:"text",value:o,onChange:a=>j(a.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50",placeholder:"Enter invitation code",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsx("input",{id:"email",type:"email",value:g,onChange:a=>x(a.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),e.jsx("input",{id:"password",type:"password",value:h,onChange:a=>v(a.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your password",required:!0})]}),f&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-red-600 text-sm",children:f}),f.includes("Invalid login credentials")&&e.jsx("button",{type:"button",onClick:()=>N(!0),className:"mt-2 text-blue-600 hover:text-blue-700 text-sm underline",children:"Fix Admin Account"})]}),F&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-yellow-800 text-sm mb-3",children:"Click below to fix the admin account authentication:"}),e.jsx(A,{type:"button",onClick:O,disabled:u,className:"w-full bg-yellow-600 hover:bg-yellow-700",children:u?"Fixing...":"Fix Admin Account"})]}),e.jsx(A,{type:"submit",className:"w-full",disabled:u||!n&&o&&l!==!0,children:u?"Processing...":n?"Sign In":"Create Account"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>y(!n),className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:n?"Don't have an account? Sign up":"Already have an account? Sign in"})})]})})}export{J as default};
//# sourceMappingURL=page-ce82550b.js.map
