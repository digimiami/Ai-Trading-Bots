import{r as c,s as i}from"./index-BD4_Ct4w.js";const B=()=>{const[p,n]=c.useState([]),[b,h]=c.useState(!0),[f,w]=c.useState(null),d=async()=>{try{h(!0),w(null);const{data:{session:e}}=await i.auth.getSession();if(!e)throw new Error("No active session");const t=await fetch("https://dkawxgwdqiirgmmjbvhc.supabase.co/functions/v1/bot-management",{method:"GET",headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"}});if(!t.ok){const r=await t.text();throw console.error("Bot fetch error:",t.status,r),new Error(`Failed to fetch bots: ${t.status}`)}const o=await t.json();n(Array.isArray(o.bots)?o.bots:[])}catch(e){console.error("Error fetching bots:",e),w(e instanceof Error?e.message:"Failed to fetch bots"),n([])}finally{h(!1)}},g=async e=>{try{const{data:{session:t}}=await i.auth.getSession();if(!t)throw new Error("No active session");const o=await fetch("https://dkawxgwdqiirgmmjbvhc.supabase.co/functions/v1/bot-management?action=create",{method:"POST",headers:{Authorization:`Bearer ${t.access_token}`,"Content-Type":"application/json"},body:JSON.stringify(e)});if(!o.ok){const s=await o.text();throw console.error("Bot creation error:",o.status,s),new Error(`Failed to create bot: ${o.status}`)}const r=await o.json();if(r.bot)return n(s=>[r.bot,...s]),r.bot;throw new Error("No bot data returned")}catch(t){throw console.error("Error creating bot:",t),t}},l=async e=>{try{const{data:{session:t}}=await i.auth.getSession();if(!t)throw new Error("No active session");const o=await fetch("https://dkawxgwdqiirgmmjbvhc.supabase.co/functions/v1/bot-management?action=start",{method:"POST",headers:{Authorization:`Bearer ${t.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(!o.ok){const s=await o.text();throw console.error("Bot start error:",o.status,s),new Error(`Failed to start bot: ${o.status}`)}const r=await o.json();if(r.bot)return n(s=>s.map(a=>a.id===e?r.bot:a)),r.bot;throw new Error("No bot data returned")}catch(t){throw console.error("Error starting bot:",t),t}},m=async e=>{try{const{data:{session:t}}=await i.auth.getSession();if(!t)throw new Error("No active session");const o=await fetch("https://dkawxgwdqiirgmmjbvhc.supabase.co/functions/v1/bot-management?action=stop",{method:"POST",headers:{Authorization:`Bearer ${t.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(!o.ok){const s=await o.text();throw console.error("Bot stop error:",o.status,s),new Error(`Failed to stop bot: ${o.status}`)}const r=await o.json();if(r.bot)return n(s=>s.map(a=>a.id===e?r.bot:a)),r.bot;throw new Error("No bot data returned")}catch(t){throw console.error("Error stopping bot:",t),t}},y=async(e,t)=>{try{const{data:{session:o}}=await i.auth.getSession();if(!o)throw new Error("No active session");const r=await fetch("https://dkawxgwdqiirgmmjbvhc.supabase.co/functions/v1/bot-management?action=update",{method:"POST",headers:{Authorization:`Bearer ${o.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({id:e,...t})});if(!r.ok){const a=await r.text();throw console.error("Bot update error:",r.status,a),new Error(`Failed to update bot: ${r.status}`)}const s=await r.json();if(s.bot)return n(a=>a.map(u=>u.id===e?s.bot:u)),s.bot;throw new Error("No bot data returned")}catch(o){throw console.error("Error updating bot:",o),o}},E=async e=>{try{const{data:{session:t}}=await i.auth.getSession();if(!t)throw new Error("No active session");const o=await fetch("https://dkawxgwdqiirgmmjbvhc.supabase.co/functions/v1/bot-management",{method:"DELETE",headers:{Authorization:`Bearer ${t.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(!o.ok){const r=await o.text();throw console.error("Bot deletion error:",o.status,r),new Error(`Failed to delete bot: ${o.status}`)}n(r=>r.filter(s=>s.id!==e))}catch(t){throw console.error("Error deleting bot:",t),t}};return c.useEffect(()=>{d()},[]),{bots:p,loading:b,error:f,fetchBots:d,createBot:g,startBot:l,stopBot:m,updateBot:y,deleteBot:E}};export{B as u};
//# sourceMappingURL=useBots-9Myh5_bp.js.map
