{"version":3,"file":"useBotActivity-DCkdrEef.js","sources":["../../src/hooks/useBotActivity.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { supabase } from '../lib/supabase';\n\nexport interface BotActivityLog {\n  id: string;\n  botId: string;\n  timestamp: string;\n  level: 'info' | 'warning' | 'error' | 'success';\n  category: 'market' | 'trade' | 'strategy' | 'system' | 'error';\n  message: string;\n  details?: any;\n  data?: any;\n}\n\nexport interface BotActivity {\n  botId: string;\n  botName: string;\n  status: string;\n  lastActivity: string;\n  logs: BotActivityLog[];\n  isActive: boolean;\n  currentAction?: string;\n  waitingFor?: string;\n  errorCount: number;\n  successCount: number;\n}\n\nexport function useBotActivity(bots?: any[]) {\n  const [activities, setActivities] = useState<BotActivity[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const addLog = async (botId: string, log: Omit<BotActivityLog, 'id' | 'timestamp'>) => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('No active session');\n\n      const newLog: Omit<BotActivityLog, 'id'> = {\n        ...log,\n        botId,\n        timestamp: new Date().toISOString(),\n      };\n\n      // Store in localStorage for now (in production, use database)\n      const existingLogs = JSON.parse(localStorage.getItem(`bot_logs_${botId}`) || '[]');\n      const updatedLogs = [...existingLogs, { ...newLog, id: Date.now().toString() }];\n      localStorage.setItem(`bot_logs_${botId}`, JSON.stringify(updatedLogs));\n\n      // Update activities state\n      setActivities(prev => prev.map(activity => \n        activity.botId === botId \n          ? {\n              ...activity,\n              logs: [...activity.logs, { ...newLog, id: Date.now().toString() }],\n              lastActivity: newLog.timestamp,\n              errorCount: log.level === 'error' ? activity.errorCount + 1 : activity.errorCount,\n              successCount: log.level === 'success' ? activity.successCount + 1 : activity.successCount,\n            }\n          : activity\n      ));\n\n      return newLog;\n    } catch (err) {\n      console.error('Error adding bot log:', err);\n      throw err;\n    }\n  };\n\n  const fetchBotLogs = async (botId: string) => {\n    try {\n      const logs = JSON.parse(localStorage.getItem(`bot_logs_${botId}`) || '[]');\n      return logs.sort((a: BotActivityLog, b: BotActivityLog) => \n        new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime()\n      );\n    } catch (err) {\n      console.error('Error fetching bot logs:', err);\n      return [];\n    }\n  };\n\n  const fetchAllActivities = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      // Use passed bots or return empty if no bots provided\n      if (!bots || bots.length === 0) {\n        setActivities([]);\n        return;\n      }\n\n      // Fetch logs for each bot\n      const activities: BotActivity[] = await Promise.all(\n        bots.map(async (bot: any) => {\n          const logs = await fetchBotLogs(bot.id);\n          const errorCount = logs.filter((log: BotActivityLog) => log.level === 'error').length;\n          const successCount = logs.filter((log: BotActivityLog) => log.level === 'success').length;\n          \n          return {\n            botId: bot.id,\n            botName: bot.name,\n            status: bot.status,\n            lastActivity: logs.length > 0 ? logs[0].timestamp : bot.createdAt,\n            logs: logs.slice(0, 50), // Keep only last 50 logs\n            isActive: bot.status === 'running',\n            currentAction: logs.length > 0 ? logs[0].message : 'Initializing...',\n            waitingFor: bot.status === 'running' ? 'Market conditions' : undefined,\n            errorCount,\n            successCount,\n          };\n        })\n      );\n\n      setActivities(activities);\n    } catch (err) {\n      console.error('Error fetching bot activities:', err);\n      setError(err instanceof Error ? err.message : 'Failed to fetch activities');\n      // Don't set empty activities on error, keep existing ones\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const clearBotLogs = async (botId: string) => {\n    try {\n      localStorage.removeItem(`bot_logs_${botId}`);\n      await fetchAllActivities();\n    } catch (err) {\n      console.error('Error clearing bot logs:', err);\n    }\n  };\n\n  const simulateBotActivity = async (botId: string) => {\n    const activities = [\n      { level: 'info' as const, category: 'system' as const, message: 'Bot initialized successfully' },\n      { level: 'info' as const, category: 'market' as const, message: 'Analyzing market conditions...' },\n      { level: 'info' as const, category: 'strategy' as const, message: 'RSI: 45, ADX: 28 - Market trending' },\n      { level: 'success' as const, category: 'trade' as const, message: 'Long position opened at $45,250' },\n      { level: 'info' as const, category: 'market' as const, message: 'Monitoring position...' },\n      { level: 'warning' as const, category: 'market' as const, message: 'Price approaching stop loss' },\n      { level: 'success' as const, category: 'trade' as const, message: 'Position closed with +2.5% profit' },\n    ];\n\n    for (const activity of activities) {\n      await addLog(botId, activity);\n      await new Promise(resolve => setTimeout(resolve, 1000)); // 1 second delay\n    }\n  };\n\n  useEffect(() => {\n    fetchAllActivities();\n    \n    // Set up polling for real-time updates\n    const interval = setInterval(fetchAllActivities, 30000); // Update every 30 seconds\n    \n    return () => clearInterval(interval);\n  }, [bots]); // Depend on bots parameter\n\n  return {\n    activities,\n    loading,\n    error,\n    addLog,\n    fetchBotLogs,\n    clearBotLogs,\n    simulateBotActivity,\n    refetch: fetchAllActivities,\n  };\n}\n"],"names":["useBotActivity","bots","activities","setActivities","useState","loading","setLoading","error","setError","addLog","botId","log","user","supabase","newLog","updatedLogs","prev","activity","err","fetchBotLogs","a","b","fetchAllActivities","bot","logs","errorCount","successCount","clearBotLogs","simulateBotActivity","resolve","useEffect","interval"],"mappings":"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"}