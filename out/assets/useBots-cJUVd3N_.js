import{r as c,s as i}from"./index-B_DKnNr4.js";const B=()=>{const[p,n]=c.useState([]),[b,h]=c.useState(!0),[f,d]=c.useState(null),w=async()=>{try{h(!0),d(null);const{data:{session:e}}=await i.auth.getSession();if(!e)throw new Error("No active session");const o=await fetch("https://dkawxgwdqiirgmmjbvhc.supabase.co/functions/v1/bot-management",{method:"GET",headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"}});if(!o.ok){const r=await o.text();throw console.error("Bot fetch error:",o.status,r),new Error(`Failed to fetch bots: ${o.status}`)}const t=await o.json();n(Array.isArray(t.bots)?t.bots:[])}catch(e){console.error("Error fetching bots:",e),d(e instanceof Error?e.message:"Failed to fetch bots"),n([])}finally{h(!1)}},l=async e=>{try{const{data:{session:o}}=await i.auth.getSession();if(!o)throw new Error("No active session");console.log("useBots: About to send bot data:",e),console.log("useBots: Exchange value:",e.exchange,"Type:",typeof e.exchange);const t=await fetch("https://dkawxgwdqiirgmmjbvhc.supabase.co/functions/v1/bot-management?action=create",{method:"POST",headers:{Authorization:`Bearer ${o.access_token}`,"Content-Type":"application/json"},body:JSON.stringify(e)});if(console.log("useBots: Response status:",t.status),!t.ok){const s=await t.text();throw console.error("Bot creation error:",t.status,s),new Error(`Failed to create bot: ${t.status}`)}const r=await t.json();if(r.bot)return n(s=>[r.bot,...s]),r.bot;throw new Error("No bot data returned")}catch(o){throw console.error("Error creating bot:",o),o}},g=async e=>{try{const{data:{session:o}}=await i.auth.getSession();if(!o)throw new Error("No active session");const t=await fetch("https://dkawxgwdqiirgmmjbvhc.supabase.co/functions/v1/bot-management?action=start",{method:"POST",headers:{Authorization:`Bearer ${o.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(!t.ok){const s=await t.text();throw console.error("Bot start error:",t.status,s),new Error(`Failed to start bot: ${t.status}`)}const r=await t.json();if(r.bot)return n(s=>s.map(a=>a.id===e?r.bot:a)),r.bot;throw new Error("No bot data returned")}catch(o){throw console.error("Error starting bot:",o),o}},m=async e=>{try{const{data:{session:o}}=await i.auth.getSession();if(!o)throw new Error("No active session");const t=await fetch("https://dkawxgwdqiirgmmjbvhc.supabase.co/functions/v1/bot-management?action=stop",{method:"POST",headers:{Authorization:`Bearer ${o.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(!t.ok){const s=await t.text();throw console.error("Bot stop error:",t.status,s),new Error(`Failed to stop bot: ${t.status}`)}const r=await t.json();if(r.bot)return n(s=>s.map(a=>a.id===e?r.bot:a)),r.bot;throw new Error("No bot data returned")}catch(o){throw console.error("Error stopping bot:",o),o}},y=async(e,o)=>{try{const{data:{session:t}}=await i.auth.getSession();if(!t)throw new Error("No active session");const r=await fetch("https://dkawxgwdqiirgmmjbvhc.supabase.co/functions/v1/bot-management?action=update",{method:"POST",headers:{Authorization:`Bearer ${t.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({id:e,...o})});if(!r.ok){const a=await r.text();throw console.error("Bot update error:",r.status,a),new Error(`Failed to update bot: ${r.status}`)}const s=await r.json();if(s.bot)return n(a=>a.map(u=>u.id===e?s.bot:u)),s.bot;throw new Error("No bot data returned")}catch(t){throw console.error("Error updating bot:",t),t}},E=async e=>{try{const{data:{session:o}}=await i.auth.getSession();if(!o)throw new Error("No active session");const t=await fetch("https://dkawxgwdqiirgmmjbvhc.supabase.co/functions/v1/bot-management",{method:"DELETE",headers:{Authorization:`Bearer ${o.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(!t.ok){const r=await t.text();throw console.error("Bot deletion error:",t.status,r),new Error(`Failed to delete bot: ${t.status}`)}n(r=>r.filter(s=>s.id!==e))}catch(o){throw console.error("Error deleting bot:",o),o}};return c.useEffect(()=>{w()},[]),{bots:p,loading:b,error:f,fetchBots:w,createBot:l,startBot:g,stopBot:m,updateBot:y,deleteBot:E}};export{B as u};
//# sourceMappingURL=useBots-cJUVd3N_.js.map
