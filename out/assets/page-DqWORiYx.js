import{r as d,a as N,A as v,u as _,j as e}from"./index-saG1DHHi.js";import{H as U}from"./Header-M2Qxtr8K.js";import{N as X}from"./Navigation-DIttmz_A.js";import{B as i}from"./Button-Dot_qHsB.js";import{C as O}from"./Card-C1vMKp8k.js";import{u as H}from"./useBots-le-rFvjl.js";import{u as J}from"./useBotActivity-DCkdrEef.js";function M(){const[h,x]=d.useState(!1),[w,p]=d.useState(null),[b,S]=d.useState(null),[B,C]=d.useState(null),n=async()=>{try{const r=await N(`${v.BOT_EXECUTOR}?action=time`);S(r),console.log("Time synced:",r)}catch(r){console.error("Time sync failed:",r)}},u=async(r="BTCUSDT",l="bybit")=>{try{const c=await N(`${v.BOT_EXECUTOR}?action=market-data&symbol=${r}&exchange=${l}`);return C(c),c}catch(c){return console.error("Market data fetch failed:",c),null}},y=async r=>{try{x(!0);const l=await N(v.BOT_EXECUTOR,{method:"POST",body:JSON.stringify({action:"execute_bot",botId:r})});return p(new Date().toISOString()),console.log("Bot executed:",l),l}catch(l){throw console.error("Bot execution failed:",l),l}finally{x(!1)}},g=async()=>{try{x(!0);const r=await N(v.BOT_EXECUTOR,{method:"POST",body:JSON.stringify({action:"execute_all_bots"})});return p(new Date().toISOString()),console.log("All bots executed:",r),r}catch(r){throw console.error("All bots execution failed:",r),r}finally{x(!1)}};return d.useEffect(()=>{n();const r=setInterval(()=>{g().catch(console.error)},3e5),l=setInterval(()=>{n()},3e5);return()=>{clearInterval(r),clearInterval(l)}},[]),{isExecuting:h,lastExecution:w,timeSync:b,marketData:B,syncTime:n,fetchMarketData:u,executeBot:y,executeAllBots:g}}function Z(){const h=_(),{bots:x,loading:w,startBot:p,stopBot:b,updateBot:S,deleteBot:B}=H(),{activities:C,addLog:n}=J(x),{isExecuting:u,lastExecution:y,timeSync:g,executeBot:r,executeAllBots:l}=M(),[c,D]=d.useState("all"),[E,j]=d.useState(!1),[T,L]=d.useState(null),m=x.filter(s=>c==="all"||s.status===c),P=s=>C.find(t=>t.botId===s),f=s=>{switch(s){case"info":return"text-blue-600 bg-blue-50";case"warning":return"text-yellow-600 bg-yellow-50";case"error":return"text-red-600 bg-red-50";case"success":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},$=s=>{switch(s){case"market":return"ri-line-chart-line";case"trade":return"ri-exchange-line";case"strategy":return"ri-brain-line";case"system":return"ri-settings-line";case"error":return"ri-error-warning-line";default:return"ri-information-line"}},A=s=>new Date(s).toLocaleTimeString(),I=s=>{switch(s){case"running":return"bg-green-100 text-green-800";case"paused":return"bg-yellow-100 text-yellow-800";case"stopped":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},R=s=>{switch(s){case"low":return"text-green-600";case"medium":return"text-yellow-600";case"high":return"text-red-600";default:return"text-gray-600"}},k=async(s,t)=>{try{t==="start"?(await p(s),await n(s,{level:"success",category:"system",message:"Bot started successfully",details:{action:"start",timestamp:new Date().toISOString()}})):t==="stop"?(await b(s),await n(s,{level:"info",category:"system",message:"Bot stopped by user",details:{action:"stop",timestamp:new Date().toISOString()}})):t==="pause"&&(await S(s,{status:"paused"}),await n(s,{level:"warning",category:"system",message:"Bot paused by user",details:{action:"pause",timestamp:new Date().toISOString()}}))}catch(o){console.error("Failed to update bot:",o),await n(s,{level:"error",category:"error",message:`Failed to ${t} bot: ${o}`,details:{action:t,error:o instanceof Error?o.message:String(o)}})}},z=async()=>{j(!0);try{const s=m.filter(t=>t.status==="stopped"||t.status==="paused");await Promise.all(s.map(t=>p(t.id)))}catch(s){console.error("Failed to start all bots:",s)}finally{j(!1)}},F=async()=>{if(confirm("Are you sure you want to delete all bots? This action cannot be undone.")){j(!0);try{await Promise.all(m.map(s=>B(s.id)))}catch(s){console.error("Failed to delete all bots:",s)}finally{j(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(U,{title:"Trading Bots",action:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(i,{variant:"warning",size:"sm",onClick:l,disabled:u||m.filter(s=>s.status==="running").length===0,children:[e.jsx("i",{className:"ri-play-circle-line mr-1"}),"Execute All"]}),e.jsxs(i,{variant:"success",size:"sm",onClick:z,disabled:E||m.filter(s=>s.status==="stopped"||s.status==="paused").length===0,children:[e.jsx("i",{className:"ri-play-line mr-1"}),"Start All"]}),e.jsxs(i,{variant:"danger",size:"sm",onClick:F,disabled:E||m.length===0,children:[e.jsx("i",{className:"ri-delete-bin-line mr-1"}),"Delete All"]}),e.jsxs(i,{variant:"primary",size:"sm",onClick:()=>h("/create-bot"),children:[e.jsx("i",{className:"ri-add-line mr-1"}),"New Bot"]})]})}),e.jsx("div",{className:"pt-20 pb-20 px-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-4",children:[e.jsx(O,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${u?"bg-yellow-500 animate-pulse":"bg-green-500"}`}),e.jsx("span",{className:"text-sm text-gray-600",children:u?"Executing...":"Ready"})]}),y&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Last execution: ",new Date(y).toLocaleTimeString()]}),g&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Time sync: ",g.offset>0?"+":"",g.offset,"ms"]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Auto-execution every 5 minutes"})]})}),e.jsx("div",{className:"flex space-x-2 overflow-x-auto",children:["all","running","paused","stopped"].map(s=>e.jsx("button",{onClick:()=>D(s),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap ${c===s?"bg-blue-600 text-white":"bg-white text-gray-600 border border-gray-200"}`,children:s.charAt(0).toUpperCase()+s.slice(1)},s))}),e.jsx("div",{className:"space-y-4",children:w?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading bots..."})]}):m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-robot-line text-4xl text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No bots found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Create your first trading bot to get started"}),e.jsxs(i,{onClick:()=>h("/create-bot"),children:[e.jsx("i",{className:"ri-add-line mr-2"}),"Create Bot"]})]}):m.map(s=>e.jsxs(O,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:`${s.exchange==="bybit"?"ri-currency-line":"ri-exchange-line"} text-blue-600 text-xl`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.symbol," â€¢ ",s.exchange.toUpperCase()]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${I(s.status)}`,children:s.status}),e.jsxs("span",{className:`text-xs font-medium ${R(s.riskLevel)}`,children:[s.riskLevel," risk"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`text-lg font-bold ${s.pnl>=0?"text-green-600":"text-red-600"}`,children:[s.pnl>=0?"+":"","$",s.pnl.toFixed(2)]}),e.jsxs("p",{className:`text-sm ${s.pnlPercentage>=0?"text-green-600":"text-red-600"}`,children:[s.pnlPercentage>=0?"+":"",s.pnlPercentage.toFixed(2),"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Trades"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.totalTrades})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Win Rate"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[s.winRate,"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Leverage"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[s.leverage,"x"]})]})]}),(()=>{const t=P(s.id),o=t?.logs.slice(0,3)||[];return e.jsxs("div",{className:"pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Recent Activity"}),e.jsx("button",{onClick:()=>L(T===s.id?null:s.id),className:"text-xs text-blue-600 hover:text-blue-800",children:T===s.id?"Hide":"Show All"})]}),t&&e.jsxs("div",{className:"flex space-x-4 mb-3 text-xs",children:[e.jsxs("span",{className:"text-green-600",children:["âœ“ ",t.successCount]}),e.jsxs("span",{className:"text-yellow-600",children:["âš  ",t.logs.filter(a=>a.level==="warning").length]}),e.jsxs("span",{className:"text-red-600",children:["âœ— ",t.errorCount]}),e.jsxs("span",{className:"text-gray-500",children:["ðŸ“Š ",t.logs.length," total"]})]}),e.jsx("div",{className:"space-y-2",children:o.length===0?e.jsxs("div",{className:"text-center py-4 text-gray-500 text-sm",children:[e.jsx("i",{className:"ri-file-list-line text-lg mb-1"}),e.jsx("p",{children:"No activity logs yet"})]}):o.map(a=>e.jsxs("div",{className:"flex items-start space-x-2 p-2 bg-gray-50 rounded text-xs",children:[e.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center ${f(a.level)}`,children:e.jsx("i",{className:`${$(a.category)} text-xs`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`px-1 py-0.5 rounded text-xs font-medium ${f(a.level)}`,children:a.level}),e.jsx("span",{className:"text-gray-500",children:A(a.timestamp)})]}),e.jsx("p",{className:"text-gray-700 mt-1 truncate",children:a.message})]})]},a.id))}),T===s.id&&t&&t.logs.length>3&&e.jsx("div",{className:"mt-3 space-y-2 max-h-48 overflow-y-auto",children:t.logs.slice(3).map(a=>e.jsxs("div",{className:"flex items-start space-x-2 p-2 bg-gray-50 rounded text-xs",children:[e.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center ${f(a.level)}`,children:e.jsx("i",{className:`${$(a.category)} text-xs`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`px-1 py-0.5 rounded text-xs font-medium ${f(a.level)}`,children:a.level}),e.jsx("span",{className:"text-gray-500",children:A(a.timestamp)})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:a.message}),a.details&&e.jsxs("details",{className:"mt-1",children:[e.jsx("summary",{className:"cursor-pointer text-gray-500 hover:text-gray-700",children:"Details"}),e.jsx("pre",{className:"mt-1 p-1 bg-white rounded border text-xs overflow-x-auto",children:JSON.stringify(a.details,null,2)})]})]})]},a.id))})]})})(),e.jsxs("div",{className:"flex space-x-2 pt-4 border-t border-gray-100",children:[s.status==="running"?e.jsxs(e.Fragment,{children:[e.jsxs(i,{variant:"warning",size:"sm",className:"flex-1",onClick:()=>r(s.id),disabled:u,children:[e.jsx("i",{className:"ri-play-circle-line mr-1"}),"Execute"]}),e.jsxs(i,{variant:"secondary",size:"sm",onClick:()=>k(s.id,"pause"),children:[e.jsx("i",{className:"ri-pause-line mr-1"}),"Pause"]})]}):e.jsxs(i,{variant:"success",size:"sm",className:"flex-1",onClick:()=>k(s.id,"start"),children:[e.jsx("i",{className:"ri-play-line mr-1"}),"Start"]}),e.jsx(i,{variant:"danger",size:"sm",onClick:()=>k(s.id,"stop"),children:e.jsx("i",{className:"ri-stop-line"})}),e.jsx(i,{variant:"secondary",size:"sm",onClick:()=>h("/bot-activity"),children:e.jsx("i",{className:"ri-file-list-line"})})]})]},s.id))})]})}),e.jsx(X,{})]})}export{Z as default};
//# sourceMappingURL=page-DqWORiYx.js.map
