{"version":3,"file":"useBots-CQ5nlN-H.js","sources":["../../src/hooks/useBots.ts"],"sourcesContent":["\nimport { useState, useEffect } from 'react';\nimport { supabase } from '../lib/supabase';\nimport type { TradingBot } from '../types/trading';\n\nexport const useBots = () => {\n  const [bots, setBots] = useState<TradingBot[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const fetchBots = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      \n      const { data: { session } } = await supabase.auth.getSession();\n      \n      if (!session) {\n        throw new Error('No active session');\n      }\n\n      const response = await fetch(`${import.meta.env.VITE_PUBLIC_SUPABASE_URL}/functions/v1/bot-management`, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${session.access_token}`,\n          'Content-Type': 'application/json',\n        },\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error('Bot fetch error:', response.status, errorText);\n        throw new Error(`Failed to fetch bots: ${response.status}`);\n      }\n\n      const data = await response.json();\n      setBots(Array.isArray(data.bots) ? data.bots : []);\n    } catch (err) {\n      console.error('Error fetching bots:', err);\n      setError(err instanceof Error ? err.message : 'Failed to fetch bots');\n      setBots([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const createBot = async (botData: Omit<TradingBot, 'id' | 'createdAt'>) => {\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      \n      if (!session) {\n        throw new Error('No active session');\n      }\n\n      const response = await fetch(`${import.meta.env.VITE_PUBLIC_SUPABASE_URL}/functions/v1/bot-management`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${session.access_token}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          action: 'create',\n          botData\n        }),\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error('Bot creation error:', response.status, errorText);\n        throw new Error(`Failed to create bot: ${response.status}`);\n      }\n\n      const data = await response.json();\n      if (data.bot) {\n        setBots(prev => [data.bot, ...prev]);\n        return data.bot;\n      }\n      throw new Error('No bot data returned');\n    } catch (err) {\n      console.error('Error creating bot:', err);\n      throw err;\n    }\n  };\n\n  const updateBot = async (botId: string, updates: Partial<TradingBot>) => {\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      \n      if (!session) {\n        throw new Error('No active session');\n      }\n\n      const response = await fetch(`${import.meta.env.VITE_PUBLIC_SUPABASE_URL}/functions/v1/bot-management`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${session.access_token}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          action: 'update',\n          botId,\n          updates\n        }),\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error('Bot update error:', response.status, errorText);\n        throw new Error(`Failed to update bot: ${response.status}`);\n      }\n\n      const data = await response.json();\n      if (data.bot) {\n        setBots(prev => prev.map(bot => bot.id === botId ? data.bot : bot));\n        return data.bot;\n      }\n      throw new Error('No bot data returned');\n    } catch (err) {\n      console.error('Error updating bot:', err);\n      throw err;\n    }\n  };\n\n  const deleteBot = async (botId: string) => {\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      \n      if (!session) {\n        throw new Error('No active session');\n      }\n\n      const response = await fetch(`${import.meta.env.VITE_PUBLIC_SUPABASE_URL}/functions/v1/bot-management`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${session.access_token}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          action: 'delete',\n          botId\n        }),\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error('Bot deletion error:', response.status, errorText);\n        throw new Error(`Failed to delete bot: ${response.status}`);\n      }\n\n      setBots(prev => prev.filter(bot => bot.id !== botId));\n    } catch (err) {\n      console.error('Error deleting bot:', err);\n      throw err;\n    }\n  };\n\n  useEffect(() => {\n    fetchBots();\n  }, []);\n\n  return {\n    bots,\n    loading,\n    error,\n    fetchBots,\n    createBot,\n    updateBot,\n    deleteBot,\n  };\n};"],"names":["useBots","bots","setBots","useState","loading","setLoading","error","setError","fetchBots","session","supabase","response","errorText","data","err","createBot","botData","prev","updateBot","botId","updates","bot","deleteBot","useEffect"],"mappings":"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"}