import{r as t,s as k,u as E,b as A,j as e}from"./index-C7XmJhMf.js";import{H as L}from"./Header-Bk0VuuLx.js";import{N as _}from"./Navigation-C8PvbIHN.js";import{B as x}from"./Button-Chk5_snC.js";import{C as c}from"./Card-B83x4jC2.js";function P(){const[g,o]=t.useState(!1),[v,p]=t.useState(null),i=async(a,n={})=>{try{o(!0),p(null);const{data:l,error:d}=await k.functions.invoke("admin-management-enhanced",{body:{action:a,...n}});if(d)throw d;return l}catch(l){throw p(l.message),l}finally{o(!1)}};return{loading:g,error:v,getUsers:async()=>(await i("getUsers")).users||[],createUser:async(a,n,l="user")=>await i("createUser",{email:a,password:n,role:l}),deleteUser:async a=>await i("deleteUser",{userId:a}),getInvitationCodes:async()=>(await i("getInvitationCodes")).codes||[],generateInvitationCode:async(a,n=7)=>await i("generateInvitationCode",{email:a,expiresInDays:n})}}function F(){const g=E(),{user:o}=A(),{createUser:v,generateInvitationCode:p,getUsers:i,getInvitationCodes:w}=P(),[h,C]=t.useState([]),[y,I]=t.useState([]),[a,n]=t.useState(!0),[l,d]=t.useState(!1),[U,j]=t.useState(!1),[r,f]=t.useState({email:"",password:"",role:"user"}),[m,b]=t.useState({email:"",expiresInDays:7});t.useEffect(()=>{if(o?.role!=="admin"){g("/");return}N()},[o,g]);const N=async()=>{try{n(!0);const[s,u]=await Promise.all([i(),w()]);C(s||[]),I(u||[])}catch(s){console.error("Error loading admin data:",s)}finally{n(!1)}},S=async s=>{s.preventDefault();try{await v(r.email,r.password,r.role),f({email:"",password:"",role:"user"}),d(!1),N()}catch(u){console.error("Error creating user:",u)}},D=async s=>{s.preventDefault();try{await p(m.email,m.expiresInDays),b({email:"",expiresInDays:7}),j(!1),N()}catch(u){console.error("Error creating invitation:",u)}};return o?.role!=="admin"?null:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(L,{title:"Admin Panel",subtitle:"User Management & System Control"}),e.jsxs("div",{className:"pt-20 pb-20 px-4 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(x,{variant:"primary",onClick:()=>d(!0),className:"h-16",children:[e.jsx("i",{className:"ri-user-add-line mr-2"}),"Create User"]}),e.jsxs(x,{variant:"secondary",onClick:()=>j(!0),className:"h-16",children:[e.jsx("i",{className:"ri-mail-send-line mr-2"}),"Send Invitation"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs(c,{className:"text-center p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:h.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total Users"})]}),e.jsxs(c,{className:"text-center p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:y.filter(s=>!s.used).length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Active Invitations"})]}),e.jsxs(c,{className:"text-center p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:h.filter(s=>s.role==="admin").length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Admins"})]})]}),e.jsxs(c,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Users"}),a?e.jsx("div",{className:"text-center py-8",children:e.jsx("i",{className:"ri-loader-4-line animate-spin text-2xl text-gray-400"})}):e.jsx("div",{className:"space-y-3",children:h.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.email}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Role: ",s.role," • Created: ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${s.role==="admin"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:s.role}),e.jsx("div",{className:`w-2 h-2 rounded-full ${s.last_sign_in_at?"bg-green-500":"bg-gray-400"}`})]})]},s.id))})]}),e.jsxs(c,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Invitation Codes"}),e.jsx("div",{className:"space-y-3",children:y.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-mono text-sm",children:s.code}),e.jsxs("div",{className:"text-sm text-gray-500",children:["For: ",s.email," • Expires: ",new Date(s.expires_at).toLocaleDateString()]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${s.used?"bg-gray-100 text-gray-800":"bg-green-100 text-green-800"}`,children:s.used?"Used":"Active"})]},s.id))})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs(c,{className:"w-full max-w-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Create New User"}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:r.email,onChange:s=>f({...r,email:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),e.jsx("input",{type:"password",value:r.password,onChange:s=>f({...r,password:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,minLength:6})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),e.jsxs("select",{value:r.role,onChange:s=>f({...r,role:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(x,{type:"button",variant:"secondary",onClick:()=>d(!1),className:"flex-1",children:"Cancel"}),e.jsx(x,{type:"submit",variant:"primary",className:"flex-1",children:"Create User"})]})]})]})}),U&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs(c,{className:"w-full max-w-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Create Invitation Code"}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:m.email,onChange:s=>b({...m,email:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expires in (days)"}),e.jsxs("select",{value:m.expiresInDays,onChange:s=>b({...m,expiresInDays:parseInt(s.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:1,children:"1 day"}),e.jsx("option",{value:3,children:"3 days"}),e.jsx("option",{value:7,children:"7 days"}),e.jsx("option",{value:14,children:"14 days"}),e.jsx("option",{value:30,children:"30 days"})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(x,{type:"button",variant:"secondary",onClick:()=>j(!1),className:"flex-1",children:"Cancel"}),e.jsx(x,{type:"submit",variant:"primary",className:"flex-1",children:"Create Invitation"})]})]})]})})]}),e.jsx(_,{})]})}export{F as default};
//# sourceMappingURL=page-CUTQ-_Ox.js.map
