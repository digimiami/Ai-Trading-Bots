{"version":3,"file":"page-859f130e.js","sources":["../../src/services/strategyValidator.ts","../../src/services/autoOptimizer.ts","../../src/hooks/useAutoOptimizer.ts","../../src/components/bot/AiOptimizationLogs.tsx","../../src/components/bot/AutoOptimizer.tsx","../../src/pages/edit-bot/page.tsx"],"sourcesContent":["/**\r\n * Strategy Configuration Validator\r\n * Validates and clamps advanced strategy config values to valid ranges\r\n */\r\n\r\nimport type { AdvancedStrategyConfig } from '../types/trading';\r\n\r\ninterface ValidationRange {\r\n  min: number;\r\n  max: number;\r\n}\r\n\r\nconst VALIDATION_RANGES: Record<string, ValidationRange> = {\r\n  adx_min_htf: { min: 15, max: 35 },\r\n  adx_trend_min: { min: 15, max: 50 },\r\n  adx_meanrev_max: { min: 10, max: 25 },\r\n  risk_per_trade_pct: { min: 0.1, max: 5.0 },\r\n  daily_loss_limit_pct: { min: 0.5, max: 10.0 },\r\n  weekly_loss_limit_pct: { min: 1.0, max: 20.0 },\r\n  max_trades_per_day: { min: 1, max: 200 },\r\n  max_concurrent: { min: 1, max: 10 },\r\n  sl_atr_mult: { min: 0.5, max: 5.0 },\r\n  tp1_r: { min: 0.5, max: 10.0 },\r\n  tp2_r: { min: 1.0, max: 20.0 },\r\n  tp1_size: { min: 0.1, max: 1.0 },\r\n  breakeven_at_r: { min: 0.1, max: 2.0 },\r\n  trail_after_tp1_atr: { min: 0.1, max: 5.0 },\r\n  time_stop_hours: { min: 1, max: 168 }, // 1 hour to 1 week\r\n  rsi_period: { min: 5, max: 50 },\r\n  rsi_oversold: { min: 0, max: 50 },\r\n  rsi_overbought: { min: 50, max: 100 },\r\n  ema_fast_period: { min: 5, max: 200 },\r\n  atr_percentile_min: { min: 0, max: 100 },\r\n  bb_width_min: { min: 0, max: 0.1 },\r\n  bb_width_max: { min: 0, max: 0.2 },\r\n  max_spread_bps: { min: 0, max: 100 },\r\n  cooldown_bars: { min: 1, max: 100 },\r\n  atr_period: { min: 1, max: 200 },\r\n  atr_tp_multiplier: { min: 0.5, max: 10 },\r\n};\r\n\r\nconst VALID_ENUMS: Record<string, string[]> = {\r\n  bias_mode: ['long-only', 'short-only', 'both', 'auto'],\r\n  htf_timeframe: ['15m', '30m', '1h', '2h', '4h', '6h', '12h', '1d', '1w'],\r\n  htf_trend_indicator: [\r\n    'EMA50',\r\n    'EMA100',\r\n    'EMA200',\r\n    'SMA50',\r\n    'SMA200',\r\n    'MA_CROSSOVER_50_200',\r\n    'Supertrend',\r\n    'DonchianChannel20',\r\n    'KeltnerChannelMidline',\r\n    'BollingerBasis20SMA',\r\n    'HullMA55',\r\n    'HullMA100',\r\n    'VWAP',\r\n    'GChannelBaseline',\r\n    'MACDZeroLine',\r\n    'RSI50Baseline',\r\n    'HeikinAshiTrend',\r\n    'IchimokuKumoTrend'\r\n  ],\r\n  require_price_vs_trend: ['above', 'below', 'any'],\r\n  regime_mode: ['trend', 'mean-reversion', 'auto'],\r\n};\r\n\r\n/**\r\n * Validate and clamp advanced strategy configuration values\r\n */\r\nexport function validateAndClampStrategyConfig(\r\n  config: Partial<AdvancedStrategyConfig>\r\n): Partial<AdvancedStrategyConfig> {\r\n  const validated: any = { ...config };\r\n\r\n  // Validate and clamp numeric values\r\n  for (const [key, range] of Object.entries(VALIDATION_RANGES)) {\r\n    if (key in validated && typeof validated[key] === 'number') {\r\n      validated[key] = Math.max(range.min, Math.min(range.max, validated[key]));\r\n    }\r\n  }\r\n\r\n  // Validate enum values\r\n  for (const [key, validValues] of Object.entries(VALID_ENUMS)) {\r\n    if (key in validated && !validValues.includes(validated[key])) {\r\n      // Set to first valid value as default\r\n      console.warn(`Invalid ${key}: ${validated[key]}. Setting to default: ${validValues[0]}`);\r\n      validated[key] = validValues[0];\r\n    }\r\n  }\r\n\r\n  // Ensure allowed_hours_utc is valid array of numbers 0-23\r\n  if (validated.allowed_hours_utc && Array.isArray(validated.allowed_hours_utc)) {\r\n    validated.allowed_hours_utc = validated.allowed_hours_utc\r\n      .filter((h: any) => typeof h === 'number' && h >= 0 && h <= 23)\r\n      .slice(0, 24); // Max 24 hours\r\n  }\r\n\r\n  return validated;\r\n}\r\n\r\n/**\r\n * Validate a single numeric value against its range\r\n */\r\nexport function clampValue(key: string, value: number): number {\r\n  const range = VALIDATION_RANGES[key];\r\n  if (!range) return value;\r\n  return Math.max(range.min, Math.min(range.max, value));\r\n}\r\n\r\n","/**\n * Auto-Optimization Service\n * Continuously learns from trading results and automatically optimizes strategies\n */\n\nimport { supabase } from '../lib/supabase';\nimport { openAIService } from './openai';\nimport { validateAndClampStrategyConfig } from './strategyValidator';\nimport type { TradingStrategy, AdvancedStrategyConfig } from '../types/trading';\n\ninterface TradeAnalysis {\n  id: string;\n  symbol: string;\n  side: 'long' | 'short';\n  entryPrice: number;\n  exitPrice?: number;\n  pnl?: number;\n  status: 'open' | 'closed';\n  timestamp: string;\n  indicators?: {\n    rsi?: number;\n    adx?: number;\n    bbWidth?: number;\n    emaSlope?: number;\n    atrPercentage?: number;\n  };\n}\n\ninterface BotPerformance {\n  botId: string;\n  totalTrades: number;\n  closedTrades: number;\n  winRate: number;\n  totalPnL: number;\n  avgWinPnL: number;\n  avgLossPnL: number;\n  maxDrawdown: number;\n  sharpeRatio: number;\n  profitFactor: number;\n  bestPerformingPair: string;\n  worstPerformingPair: string;\n  recentTrades: TradeAnalysis[];\n  timeRange: string;\n  currentStrategy: TradingStrategy;\n  currentAdvancedConfig?: AdvancedStrategyConfig;\n}\n\nexport interface OptimizationResult {\n  success: boolean;\n  botId: string;\n  originalStrategy: TradingStrategy;\n  optimizedStrategy: TradingStrategy;\n  originalAdvancedConfig?: AdvancedStrategyConfig;\n  optimizedAdvancedConfig?: AdvancedStrategyConfig;\n  reasoning: string;\n  expectedImprovement: string;\n  confidence: number;\n  changes: {\n    parameter: string;\n    oldValue: any;\n    newValue: any;\n    reason: string;\n  }[];\n}\n\nclass AutoOptimizer {\n  private optimizationInterval: number = 3600000; // 1 hour default\n  private minTradesForOptimization: number = 10;\n\n  /**\n   * Analyze bot performance and generate optimization recommendations\n   */\n  async analyzeBotPerformance(botId: string): Promise<BotPerformance | null> {\n    try {\n      // Fetch bot details\n      const { data: bot, error: botError } = await supabase\n        .from('trading_bots')\n        .select('*')\n        .eq('id', botId)\n        .single();\n\n      if (botError || !bot) {\n        console.error('Error fetching bot:', botError);\n        return null;\n      }\n\n      // Fetch recent trades (last 30 days)\n      const thirtyDaysAgo = new Date();\n      thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n\n      const { data: trades, error: tradesError } = await supabase\n        .from('trades')\n        .select('*')\n        .eq('bot_id', botId)\n        .gte('created_at', thirtyDaysAgo.toISOString())\n        .order('created_at', { ascending: false });\n\n      if (tradesError) {\n        console.error('Error fetching trades:', tradesError);\n        return null;\n      }\n\n      if (!trades || trades.length < this.minTradesForOptimization) {\n        console.log(`Insufficient trades for optimization. Need ${this.minTradesForOptimization}, have ${trades?.length || 0}`);\n        return null;\n      }\n\n      // Calculate performance metrics\n      const closedTrades = trades.filter(t => t.status === 'closed' && t.pnl !== null);\n      const winningTrades = closedTrades.filter(t => t.pnl! > 0);\n      const losingTrades = closedTrades.filter(t => t.pnl! <= 0);\n\n      const totalPnL = closedTrades.reduce((sum, t) => sum + (t.pnl || 0), 0);\n      const winRate = closedTrades.length > 0 \n        ? (winningTrades.length / closedTrades.length) * 100 \n        : 0;\n\n      const avgWinPnL = winningTrades.length > 0\n        ? winningTrades.reduce((sum, t) => sum + (t.pnl || 0), 0) / winningTrades.length\n        : 0;\n\n      const avgLossPnL = losingTrades.length > 0\n        ? losingTrades.reduce((sum, t) => sum + Math.abs(t.pnl || 0), 0) / losingTrades.length\n        : 0;\n\n      const profitFactor = avgLossPnL !== 0 \n        ? Math.abs(avgWinPnL / avgLossPnL) \n        : 0;\n\n      // Calculate max drawdown\n      let maxDrawdown = 0;\n      let peak = 0;\n      let cumulativePnL = 0;\n      for (const trade of closedTrades.sort((a, b) => \n        new Date(a.created_at || a.timestamp).getTime() - new Date(b.created_at || b.timestamp).getTime()\n      )) {\n        cumulativePnL += trade.pnl || 0;\n        if (cumulativePnL > peak) peak = cumulativePnL;\n        const drawdown = peak - cumulativePnL;\n        if (drawdown > maxDrawdown) maxDrawdown = drawdown;\n      }\n\n      // Group trades by symbol\n      const tradesBySymbol = closedTrades.reduce((acc, trade) => {\n        if (!acc[trade.symbol]) acc[trade.symbol] = [];\n        acc[trade.symbol].push(trade);\n        return acc;\n      }, {} as Record<string, typeof closedTrades>);\n\n      let bestPair = '';\n      let worstPair = '';\n      let bestPnL = -Infinity;\n      let worstPnL = Infinity;\n\n      for (const [symbol, symbolTrades] of Object.entries(tradesBySymbol)) {\n        const symbolPnL = symbolTrades.reduce((sum, t) => sum + (t.pnl || 0), 0);\n        if (symbolPnL > bestPnL) {\n          bestPnL = symbolPnL;\n          bestPair = symbol;\n        }\n        if (symbolPnL < worstPnL) {\n          worstPnL = symbolPnL;\n          worstPair = symbol;\n        }\n      }\n\n      // Calculate Sharpe Ratio (simplified)\n      const returns = closedTrades.map(t => (t.pnl || 0) / (t.entry_price || 1));\n      const avgReturn = returns.reduce((sum, r) => sum + r, 0) / returns.length;\n      const variance = returns.reduce((sum, r) => sum + Math.pow(r - avgReturn, 2), 0) / returns.length;\n      const sharpeRatio = variance !== 0 ? avgReturn / Math.sqrt(variance) : 0;\n\n      // Parse strategy - handle potential double-encoding or huge nested data\n      let strategy: TradingStrategy = {} as TradingStrategy;\n      try {\n        if (typeof bot.strategy === 'string') {\n          strategy = JSON.parse(bot.strategy);\n          // Check if still string (double-encoded)\n          if (typeof strategy === 'string') {\n            strategy = JSON.parse(strategy);\n          }\n        } else if (bot.strategy && typeof bot.strategy === 'object') {\n          strategy = bot.strategy as TradingStrategy;\n        }\n        \n        // Extract only essential fields to prevent huge objects\n        strategy = {\n          rsiThreshold: strategy.rsiThreshold || 70,\n          adxThreshold: strategy.adxThreshold || 25,\n          bbWidthThreshold: strategy.bbWidthThreshold || 0.02,\n          emaSlope: strategy.emaSlope || 0.5,\n          atrPercentage: strategy.atrPercentage || 2.5,\n          vwapDistance: strategy.vwapDistance || 1.2,\n          momentumThreshold: strategy.momentumThreshold || 0.8,\n          useMLPrediction: strategy.useMLPrediction || false,\n          minSamplesForML: strategy.minSamplesForML || 100\n        };\n      } catch (error) {\n        console.error('Error parsing strategy:', error);\n        // Use default strategy\n        strategy = {\n          rsiThreshold: 70,\n          adxThreshold: 25,\n          bbWidthThreshold: 0.02,\n          emaSlope: 0.5,\n          atrPercentage: 2.5,\n          vwapDistance: 1.2,\n          momentumThreshold: 0.8,\n          useMLPrediction: false,\n          minSamplesForML: 100\n        };\n      }\n      \n      // Parse advanced config - extract only essential fields\n      let strategyConfig: AdvancedStrategyConfig | undefined = undefined;\n      try {\n        if (bot.strategy_config) {\n          let config = typeof bot.strategy_config === 'string' \n            ? JSON.parse(bot.strategy_config) \n            : bot.strategy_config;\n          \n          // Extract only essential fields (prevent huge objects)\n          if (config && typeof config === 'object') {\n            strategyConfig = {\n              bias_mode: config.bias_mode,\n              risk_per_trade_pct: config.risk_per_trade_pct,\n              adx_min_htf: config.adx_min_htf,\n              regime_mode: config.regime_mode,\n              sl_atr_mult: config.sl_atr_mult,\n              tp1_r: config.tp1_r,\n              tp2_r: config.tp2_r\n            } as AdvancedStrategyConfig;\n          }\n        }\n      } catch (error) {\n        console.error('Error parsing strategy_config:', error);\n        strategyConfig = undefined;\n      }\n\n      return {\n        botId,\n        totalTrades: trades.length,\n        closedTrades: closedTrades.length,\n        winRate,\n        totalPnL,\n        avgWinPnL,\n        avgLossPnL,\n        maxDrawdown,\n        sharpeRatio,\n        profitFactor,\n        bestPerformingPair: bestPair,\n        worstPerformingPair: worstPair,\n        recentTrades: trades.slice(0, 50).map(t => ({\n          id: t.id,\n          symbol: t.symbol,\n          side: t.side,\n          entryPrice: t.entry_price,\n          exitPrice: t.exit_price,\n          pnl: t.pnl,\n          status: t.status,\n          timestamp: t.created_at || t.timestamp\n        })),\n        timeRange: '30 days',\n        currentStrategy: strategy,\n        currentAdvancedConfig: strategyConfig\n      };\n    } catch (error) {\n      console.error('Error analyzing bot performance:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Optimize strategy using OpenAI\n   */\n  async optimizeStrategy(botId: string): Promise<OptimizationResult | null> {\n    try {\n      const performance = await this.analyzeBotPerformance(botId);\n      \n      if (!performance) {\n        return null;\n      }\n\n      // Limit trades to reduce token usage (last 5 trades max)\n      // This prevents OpenAI rate limit errors (800K tokens/min limit)\n      // Using only most recent trades which are most relevant\n      const limitedTrades = performance.recentTrades.slice(-5);\n\n      // Use OpenAI to optimize the strategy\n      const optimization = await openAIService.optimizeStrategy(\n        {\n          strategy: performance.currentStrategy,\n          advancedConfig: performance.currentAdvancedConfig\n        },\n        limitedTrades.map(t => ({\n          symbol: t.symbol,\n          entryPrice: t.entryPrice,\n          exitPrice: t.exitPrice || t.entryPrice,\n          pnl: t.pnl || 0,\n          // Don't send indicators - they can be huge nested objects\n          // indicators: t.indicators || {},\n          outcome: (t.pnl || 0) > 0 ? 'win' as const : 'loss' as const,\n          timestamp: t.timestamp\n        })),\n        {\n          winRate: performance.winRate,\n          totalPnL: performance.totalPnL,\n          avgWin: performance.avgWinPnL,\n          avgLoss: performance.avgLossPnL,\n          profitFactor: performance.profitFactor,\n          sharpeRatio: performance.sharpeRatio,\n          maxDrawdown: performance.maxDrawdown\n        }\n      );\n\n      // Extract changes\n      const changes: OptimizationResult['changes'] = [];\n      \n      // Compare strategy parameters\n      const originalStrategy = performance.currentStrategy;\n      const optimizedStrategy = optimization.strategy || originalStrategy;\n      \n      Object.keys(optimizedStrategy).forEach(key => {\n        const oldValue = (originalStrategy as any)[key];\n        const newValue = (optimizedStrategy as any)[key];\n        if (oldValue !== newValue) {\n          changes.push({\n            parameter: `strategy.${key}`,\n            oldValue,\n            newValue,\n            reason: optimization.reasoning || 'AI optimization'\n          });\n        }\n      });\n\n      // Compare advanced config if exists\n      if (performance.currentAdvancedConfig && optimization.advancedConfig) {\n        Object.keys(optimization.advancedConfig).forEach(key => {\n          const oldValue = (performance.currentAdvancedConfig as any)[key];\n          const newValue = (optimization.advancedConfig as any)[key];\n          if (oldValue !== newValue) {\n            changes.push({\n              parameter: `advancedConfig.${key}`,\n              oldValue,\n              newValue,\n              reason: optimization.reasoning || 'AI optimization'\n            });\n          }\n        });\n      }\n\n      return {\n        success: true,\n        botId,\n        originalStrategy,\n        optimizedStrategy,\n        originalAdvancedConfig: performance.currentAdvancedConfig,\n        optimizedAdvancedConfig: optimization.advancedConfig || performance.currentAdvancedConfig,\n        reasoning: optimization.reasoning || 'AI-generated optimization',\n        expectedImprovement: optimization.expectedImprovement || 'Unknown',\n        confidence: optimization.confidence || 0.7,\n        changes\n      };\n    } catch (error) {\n      console.error('Error optimizing strategy:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Automatically apply optimization if confidence is high\n   */\n  async autoApplyOptimization(\n    botId: string, \n    minConfidence: number = 0.75\n  ): Promise<boolean> {\n    try {\n      const optimization = await this.optimizeStrategy(botId);\n      \n      if (!optimization || !optimization.success) {\n        console.warn('⚠️ Optimization failed or returned null:', optimization);\n        return false;\n      }\n\n      // Only apply if confidence is high enough\n      if (optimization.confidence < minConfidence) {\n        console.warn(`⚠️ Optimization confidence ${(optimization.confidence * 100).toFixed(1)}% below threshold ${(minConfidence * 100).toFixed(1)}%`);\n        return false;\n      }\n\n      // Store optimization record with comprehensive logging\n      const performanceBefore = await this.getPerformanceSnapshot(botId);\n      \n      // Get AI provider info (if available from openAIService)\n      const aiProvider = (import.meta.env.VITE_DEEPSEEK_API_KEY ? 'DeepSeek' : 'OpenAI') || 'Unknown';\n      const aiModel = import.meta.env.VITE_DEEPSEEK_API_KEY ? 'deepseek-chat' : 'gpt-4o';\n      \n      const optimizationRecord: any = {\n        bot_id: botId,\n        original_strategy: optimization.originalStrategy,\n        suggested_changes: {\n          strategy: optimization.optimizedStrategy,\n          advancedConfig: optimization.optimizedAdvancedConfig\n        },\n        reasoning: optimization.reasoning,\n        expected_improvement: Math.min(999.99, Math.max(-999.99, parseFloat(optimization.expectedImprovement.replace(/[^0-9.-]/g, '')) || 0)),\n        performance_before: {\n          ...performanceBefore,\n          timestamp: new Date().toISOString(),\n          // Store AI metadata in performance_before JSONB as backup\n          ai_provider: aiProvider,\n          ai_model: aiModel,\n          confidence: optimization.confidence\n        },\n        status: 'applied',\n        applied_at: new Date().toISOString()\n      };\n      \n      // Try to add dedicated columns if they exist (after migration)\n      // These will be ignored if columns don't exist, so AI info is still in performance_before JSONB\n      try {\n        optimizationRecord.ai_provider = aiProvider;\n        optimizationRecord.ai_model = aiModel;\n        optimizationRecord.confidence = optimization.confidence;\n      } catch (e) {\n        // Columns don't exist yet, that's okay - data is in performance_before JSONB\n        console.log('Note: AI metadata columns not found, storing in performance_before JSONB');\n      }\n      \n      const { data: optimizationData, error: recordError } = await supabase\n        .from('strategy_optimizations')\n        .insert(optimizationRecord)\n        .select()\n        .single();\n\n      if (recordError) {\n        console.error('Error recording optimization:', recordError);\n      } else {\n        console.log(`✅ Optimization record created: ${optimizationData?.id} using ${aiProvider}`);\n      }\n\n      // Log to activity logs with performance snapshot\n      await this.logOptimization(botId, {\n        ...optimization,\n        // Include performance before in details\n      });\n\n      // Validate and clamp advanced config values before applying\n      let validatedAdvancedConfig = optimization.optimizedAdvancedConfig;\n      if (validatedAdvancedConfig) {\n        validatedAdvancedConfig = validateAndClampStrategyConfig(validatedAdvancedConfig) as AdvancedStrategyConfig;\n        console.log('✅ Validated and clamped advanced strategy config');\n      }\n\n      // Apply the optimization\n      const { error: updateError } = await supabase\n        .from('trading_bots')\n        .update({\n          strategy: optimization.optimizedStrategy,\n          strategy_config: validatedAdvancedConfig || optimization.optimizedAdvancedConfig,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', botId);\n\n      if (updateError) {\n        console.error('Error applying optimization:', updateError);\n        return false;\n      }\n\n      // Log the optimization to bot activity logs\n      await this.logOptimization(botId, optimization);\n\n      console.log(`✅ Successfully optimized bot ${botId}`);\n      return true;\n    } catch (error) {\n      console.error('Error auto-applying optimization:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Get performance snapshot for comparison\n   */\n  private async getPerformanceSnapshot(botId: string) {\n    const { data: bot } = await supabase\n      .from('trading_bots')\n      .select('pnl, pnl_percentage, total_trades, win_rate')\n      .eq('id', botId)\n      .single();\n\n    return bot || {};\n  }\n\n  /**\n   * Log optimization to bot activity logs with comprehensive details\n   */\n  private async logOptimization(botId: string, optimization: OptimizationResult): Promise<void> {\n    try {\n      const changeSummary = optimization.changes.map(change => \n        `${change.parameter}: ${JSON.stringify(change.oldValue)} → ${JSON.stringify(change.newValue)}`\n      ).join(', ');\n\n      // Get AI provider info\n      const aiProvider = (import.meta.env.VITE_DEEPSEEK_API_KEY ? 'DeepSeek' : 'OpenAI') || 'Unknown';\n      const aiModel = import.meta.env.VITE_DEEPSEEK_API_KEY ? 'deepseek-chat' : 'gpt-4o';\n\n      const logMessage = `${aiProvider} Auto-Optimization Applied (Confidence: ${(optimization.confidence * 100).toFixed(1)}%)`;\n      \n      const logDetails = {\n        type: 'ai_ml_optimization_applied',\n        ai_provider: aiProvider,\n        ai_model: aiModel,\n        confidence: optimization.confidence,\n        reasoning: optimization.reasoning,\n        expectedImprovement: optimization.expectedImprovement,\n        changes: optimization.changes,\n        changeCount: optimization.changes.length,\n        changeSummary,\n        optimizedStrategy: optimization.optimizedStrategy,\n        optimizedAdvancedConfig: optimization.optimizedAdvancedConfig,\n        originalStrategy: optimization.originalStrategy,\n        originalAdvancedConfig: optimization.originalAdvancedConfig,\n        applied_at: new Date().toISOString(),\n        trigger: 'auto-pilot_mode'\n      };\n\n      // Log to bot_activity_logs table\n      const { error } = await supabase\n        .from('bot_activity_logs')\n        .insert({\n          bot_id: botId,\n          level: 'success',\n          category: 'strategy',\n          message: logMessage,\n          details: logDetails,\n          timestamp: new Date().toISOString()\n        });\n\n      if (error) {\n        console.error('Error logging optimization:', error);\n      } else {\n        console.log(`✅ Optimization logged to bot_activity_logs for bot ${botId} using ${aiProvider}`);\n      }\n    } catch (error) {\n      console.error('Error logging optimization:', error);\n    }\n  }\n\n  /**\n   * Learn from a completed trade\n   */\n  async learnFromTrade(tradeId: string, botId: string): Promise<void> {\n    try {\n      const { data: trade, error } = await supabase\n        .from('trades')\n        .select('*')\n        .eq('id', tradeId)\n        .single();\n\n      if (error || !trade || trade.status !== 'closed') {\n        return;\n      }\n\n      // Store learning data\n      const { error: learnError } = await supabase\n        .from('ai_learning_data')\n        .insert({\n          bot_id: botId,\n          trade_id: tradeId,\n          symbol: trade.symbol,\n          market_conditions: {\n            side: trade.side,\n            entryPrice: trade.entry_price,\n            exitPrice: trade.exit_price\n          },\n          outcome: (trade.pnl || 0) > 0 ? 'win' : 'loss',\n          pnl: trade.pnl || 0\n        });\n\n      if (learnError) {\n        console.error('Error storing learning data:', learnError);\n      }\n    } catch (error) {\n      console.error('Error learning from trade:', error);\n    }\n  }\n\n  /**\n   * Run optimization for all active bots\n   */\n  async optimizeAllActiveBots(userId?: string): Promise<void> {\n    try {\n      let query = supabase\n        .from('trading_bots')\n        .select('id, user_id, ai_ml_enabled')\n        .eq('status', 'running')\n        .eq('ai_ml_enabled', true);\n\n      if (userId) {\n        query = query.eq('user_id', userId);\n      }\n\n      const { data: bots, error } = await query;\n\n      if (error || !bots || bots.length === 0) {\n        console.log('No active bots with AI/ML enabled for optimization');\n        return;\n      }\n\n      console.log(`Running optimization for ${bots.length} active bots...`);\n\n      for (const bot of bots) {\n        try {\n          await this.autoApplyOptimization(bot.id, 0.7); // Lower threshold for automatic\n          // Small delay to avoid rate limiting\n          await new Promise(resolve => setTimeout(resolve, 1000));\n        } catch (error) {\n          console.error(`Error optimizing bot ${bot.id}:`, error);\n        }\n      }\n    } catch (error) {\n      console.error('Error optimizing all bots:', error);\n    }\n  }\n}\n\nexport const autoOptimizer = new AutoOptimizer();\n\n","/**\r\n * Hook for auto-optimization features\r\n */\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { autoOptimizer, type OptimizationResult } from '../services/autoOptimizer';\r\n\r\nexport function useAutoOptimizer(botId: string | null) {\r\n  const [isOptimizing, setIsOptimizing] = useState(false);\r\n  const [optimizationResult, setOptimizationResult] = useState<OptimizationResult | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n  \r\n  // Persist auto-pilot mode in localStorage\r\n  const storageKey = botId ? `auto-pilot-enabled-${botId}` : null;\r\n  const [autoOptimizeEnabled, setAutoOptimizeEnabledState] = useState(() => {\r\n    if (storageKey && typeof window !== 'undefined') {\r\n      const saved = localStorage.getItem(storageKey);\r\n      return saved === 'true';\r\n    }\r\n    return false;\r\n  });\r\n\r\n  const setAutoOptimizeEnabled = (value: boolean) => {\r\n    setAutoOptimizeEnabledState(value);\r\n    if (storageKey && typeof window !== 'undefined') {\r\n      localStorage.setItem(storageKey, value.toString());\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Trigger optimization for a specific bot\r\n   */\r\n  const optimizeBot = useCallback(async () => {\r\n    if (!botId) return;\r\n\r\n    try {\r\n      setIsOptimizing(true);\r\n      setError(null);\r\n      const result = await autoOptimizer.optimizeStrategy(botId);\r\n      setOptimizationResult(result);\r\n      return result;\r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : 'Optimization failed';\r\n      setError(errorMessage);\r\n      console.error('Optimization error:', err);\r\n      return null;\r\n    } finally {\r\n      setIsOptimizing(false);\r\n    }\r\n  }, [botId]);\r\n\r\n  /**\r\n   * Auto-apply optimization if confidence is high\r\n   */\r\n  const autoApplyOptimization = useCallback(async (minConfidence: number = 0.75) => {\r\n    if (!botId) return false;\r\n\r\n    try {\r\n      setIsOptimizing(true);\r\n      setError(null);\r\n      const applied = await autoOptimizer.autoApplyOptimization(botId, minConfidence);\r\n      if (applied) {\r\n        // Refresh after applying\r\n        await optimizeBot();\r\n      }\r\n      return applied;\r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : 'Auto-apply failed';\r\n      setError(errorMessage);\r\n      return false;\r\n    } finally {\r\n      setIsOptimizing(false);\r\n    }\r\n  }, [botId, optimizeBot]);\r\n\r\n  /**\r\n   * Setup automatic optimization (runs periodically)\r\n   */\r\n  useEffect(() => {\r\n    if (!autoOptimizeEnabled || !botId) return;\r\n\r\n    const interval = setInterval(async () => {\r\n      try {\r\n        await autoOptimizer.autoApplyOptimization(botId, 0.7);\r\n      } catch (err) {\r\n        console.error('Automatic optimization error:', err);\r\n      }\r\n    }, 3600000); // Run every hour\r\n\r\n    return () => clearInterval(interval);\r\n  }, [autoOptimizeEnabled, botId]);\r\n\r\n  return {\r\n    isOptimizing,\r\n    optimizationResult,\r\n    error,\r\n    optimizeBot,\r\n    autoApplyOptimization,\r\n    autoOptimizeEnabled,\r\n    setAutoOptimizeEnabled\r\n  };\r\n}\r\n\r\n","/**\n * AI Optimization Logs Component\n * Displays AI/ML optimization history and changes\n */\n\nimport { useState, useEffect } from 'react';\nimport { supabase } from '../../lib/supabase';\nimport { Card } from '../base/Card';\n\ninterface OptimizationLog {\n  id: string;\n  timestamp: string;\n  message: string;\n  details: {\n    type: string;\n    confidence: number;\n    reasoning: string;\n    expectedImprovement: string;\n    changes: Array<{\n      parameter: string;\n      oldValue: any;\n      newValue: any;\n      reason: string;\n    }>;\n    changeSummary?: string;\n    performanceBefore?: any;\n  };\n}\n\ninterface AiOptimizationLogsProps {\n  botId: string;\n}\n\nexport default function AiOptimizationLogs({ botId }: AiOptimizationLogsProps) {\n  const [logs, setLogs] = useState<OptimizationLog[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [expandedLog, setExpandedLog] = useState<string | null>(null);\n\n  useEffect(() => {\n    fetchOptimizationLogs();\n  }, [botId]);\n\n  const fetchOptimizationLogs = async () => {\n    try {\n      setLoading(true);\n      // Ensure authenticated session before querying (prevents RLS/implicit failures)\n      const { data: { session } } = await supabase.auth.getSession();\n      if (!session) {\n        console.warn('AiOptimizationLogs: No active session, skipping fetch');\n        setLogs([]);\n        return;\n      }\n      \n      const { data, error } = await supabase\n        .from('bot_activity_logs')\n        .select('*')\n        .eq('bot_id', botId)\n        .eq('category', 'strategy')\n        .order('timestamp', { ascending: false })\n        .limit(50);\n\n      if (error) {\n        console.error('Error fetching optimization logs:', error);\n        return;\n      }\n\n      // Filter for AI/ML optimizations (check if details.type exists or message contains AI/ML)\n      const aiLogs = (data || []).filter((log: any) => \n        log.details?.type === 'ai_ml_optimization' || \n        (log.message && log.message.includes('AI/ML'))\n      ) as OptimizationLog[];\n\n      setLogs(aiLogs as OptimizationLog[]);\n    } catch (error) {\n      console.error('Error fetching logs:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const formatTimestamp = (timestamp: string) => {\n    const date = new Date(timestamp);\n    return date.toLocaleString();\n  };\n\n  const getConfidenceColor = (confidence: number) => {\n    if (confidence >= 0.75) return 'text-green-600 dark:text-green-400';\n    if (confidence >= 0.6) return 'text-yellow-600 dark:text-yellow-400';\n    return 'text-red-600 dark:text-red-400';\n  };\n\n  if (loading) {\n    return (\n      <Card title=\"AI/ML Optimization History\" className=\"mt-4\">\n        <div className=\"text-center py-4\">\n          <div className=\"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n          <p className=\"mt-2 text-sm text-gray-600 dark:text-gray-400\">Loading optimization history...</p>\n        </div>\n      </Card>\n    );\n  }\n\n  if (logs.length === 0) {\n    return (\n      <Card title=\"AI/ML Optimization History\" className=\"mt-4\">\n        <div className=\"text-center py-6\">\n          <p className=\"text-gray-500 dark:text-gray-400\">\n            No AI/ML optimizations yet. Optimizations will appear here once applied.\n          </p>\n        </div>\n      </Card>\n    );\n  }\n\n  return (\n    <Card title=\"AI/ML Optimization History\" className=\"mt-4\">\n      <div className=\"space-y-3\">\n        {logs.map((log) => (\n          <div\n            key={log.id}\n            className=\"border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors\"\n          >\n            <div className=\"flex items-start justify-between\">\n              <div className=\"flex-1\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200\">\n                    AI/ML Optimized\n                  </span>\n                  <span className={`text-sm font-semibold ${getConfidenceColor(log.details?.confidence || 0)}`}>\n                    {(((log.details?.confidence ?? 0) * 100).toFixed(1))}% Confidence\n                  </span>\n                  <span className=\"text-xs text-gray-500 dark:text-gray-400\">\n                    {formatTimestamp(log.timestamp)}\n                  </span>\n                </div>\n\n                <p className=\"text-sm text-gray-900 dark:text-gray-100 mb-2\">\n                  {log.message}\n                </p>\n\n                {log.details?.expectedImprovement && (\n                  <p className=\"text-xs text-blue-600 dark:text-blue-400 mb-2\">\n                    Expected: {log.details?.expectedImprovement}\n                  </p>\n                )}\n\n                <div className=\"text-xs text-gray-600 dark:text-gray-400\">\n                  <strong>Changes:</strong> {(log.details?.changes?.length || 0)} parameter(s) modified\n                </div>\n              </div>\n\n              <button\n                onClick={() => setExpandedLog(expandedLog === log.id ? null : log.id)}\n                className=\"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 text-sm font-medium\"\n              >\n                {expandedLog === log.id ? 'Hide' : 'View'} Details\n              </button>\n            </div>\n\n            {expandedLog === log.id && (\n              <div className=\"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 space-y-3\">\n                {log.details?.reasoning && (\n                  <div>\n                    <h4 className=\"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-1\">\n                      AI Reasoning:\n                    </h4>\n                    <p className=\"text-sm text-gray-700 dark:text-gray-300\">\n                      {log.details?.reasoning}\n                    </p>\n                  </div>\n                )}\n\n                {log.details?.changes && log.details.changes.length > 0 && (\n                  <div>\n                    <h4 className=\"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-2\">\n                      Parameter Changes:\n                    </h4>\n                    <div className=\"space-y-2\">\n                      {log.details?.changes.map((change, idx) => (\n                        <div\n                          key={idx}\n                          className=\"bg-gray-50 dark:bg-gray-900 rounded p-2 text-xs\"\n                        >\n                          <div className=\"font-medium text-gray-900 dark:text-gray-100 mb-1\">\n                            {change.parameter}\n                          </div>\n                          <div className=\"flex items-center gap-2 text-gray-600 dark:text-gray-400\">\n                            <span className=\"line-through text-red-600 dark:text-red-400\">\n                              {JSON.stringify(change.oldValue)}\n                            </span>\n                            <span>→</span>\n                            <span className=\"text-green-600 dark:text-green-400 font-medium\">\n                              {JSON.stringify(change.newValue)}\n                            </span>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {log.details?.performanceBefore && (\n                  <div>\n                    <h4 className=\"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-1\">\n                      Performance Before Optimization:\n                    </h4>\n                    <div className=\"text-xs text-gray-600 dark:text-gray-400 space-y-1\">\n                      <div>Win Rate: {log.details?.performanceBefore?.winRate?.toFixed(2) || 'N/A'}%</div>\n                      <div>Total PnL: ${log.details?.performanceBefore?.totalPnL?.toFixed(2) || '0.00'}</div>\n                      <div>Profit Factor: {log.details?.performanceBefore?.profitFactor?.toFixed(2) || 'N/A'}</div>\n                    </div>\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n        ))}\n      </div>\n    </Card>\n  );\n}\n\n","/**\r\n * Auto-Optimizer Component\r\n * Displays optimization status and allows manual triggering\r\n */\r\n\r\nimport { useState } from 'react';\r\nimport { useAutoOptimizer } from '../../hooks/useAutoOptimizer';\r\nimport { Card } from '../base/Card';\r\nimport Button from '../base/Button';\r\nimport AiOptimizationLogs from './AiOptimizationLogs';\r\nimport type { TradingBot } from '../../types/trading';\r\n\r\ninterface AutoOptimizerProps {\r\n  bot: TradingBot;\r\n}\r\n\r\nexport default function AutoOptimizer({ bot }: AutoOptimizerProps) {\r\n  const {\r\n    isOptimizing,\r\n    optimizationResult,\r\n    error,\r\n    optimizeBot,\r\n    autoApplyOptimization,\r\n    autoOptimizeEnabled,\r\n    setAutoOptimizeEnabled\r\n  } = useAutoOptimizer(bot.id);\r\n\r\n  const [showDetails, setShowDetails] = useState(false);\r\n\r\n  const handleOptimize = async () => {\r\n    const result = await optimizeBot();\r\n    if (result) {\r\n      setShowDetails(true);\r\n    }\r\n  };\r\n\r\n  const handleAutoApply = async () => {\r\n    try {\r\n      // Use a lower threshold for manual apply (0.65 instead of 0.75)\r\n      const applied = await autoApplyOptimization(0.65);\r\n      if (applied) {\r\n        alert('✅ Optimization applied successfully! The bot will now use the optimized parameters.');\r\n        // Refresh the optimization result\r\n        await optimizeBot();\r\n      } else {\r\n        // Get more specific error message\r\n        if (optimizationResult) {\r\n          const confidencePercent = (optimizationResult.confidence * 100).toFixed(1);\r\n          if (optimizationResult.confidence < 0.65) {\r\n            alert(`⚠️ Optimization not applied - confidence too low (${confidencePercent}%). Minimum required: 65%. Please review the optimization details before applying.`);\r\n          } else {\r\n            alert('⚠️ Optimization not applied - failed to update bot. Please check console for details.');\r\n          }\r\n        } else {\r\n          alert('⚠️ Optimization not applied - no optimization result available. Please run \"Analyze & Optimize\" first.');\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error applying optimization:', error);\r\n      alert(`❌ Error applying optimization: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Card title=\"AI Auto-Optimization\" className=\"mt-4\">\r\n      <div className=\"space-y-4\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n              {bot.aiMlEnabled \r\n                ? 'AI/ML learning enabled - bot will analyze trades and optimize strategies'\r\n                : 'Enable AI/ML in bot settings to use auto-optimization'}\r\n            </p>\r\n            {optimizationResult && (\r\n              <p className=\"text-sm mt-2\">\r\n                <span className=\"font-semibold\">Confidence:</span>{' '}\r\n                <span className={optimizationResult.confidence > 0.7 ? 'text-green-600' : 'text-yellow-600'}>\r\n                  {(optimizationResult.confidence * 100).toFixed(1)}%\r\n                </span>\r\n              </p>\r\n            )}\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <Button\r\n              onClick={handleOptimize}\r\n              disabled={isOptimizing || !bot.aiMlEnabled}\r\n              loading={isOptimizing}\r\n              variant=\"primary\"\r\n            >\r\n              Analyze & Optimize\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Auto-Pilot Mode Toggle */}\r\n        {bot.aiMlEnabled && (\r\n          <div className=\"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\">\r\n            <div className=\"flex-1\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <i className=\"ri-flight-takeoff-line text-xl text-blue-600\"></i>\r\n                <div>\r\n                  <h4 className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n                    Auto-Pilot Mode\r\n                  </h4>\r\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\r\n                    {autoOptimizeEnabled \r\n                      ? '✅ Optimizing automatically every 1 hour'\r\n                      : 'Bot will automatically optimize every hour when enabled'}\r\n                  </p>\r\n                  {autoOptimizeEnabled && (\r\n                    <p className=\"text-xs text-blue-600 dark:text-blue-400 mt-1\">\r\n                      Uses 70% confidence threshold for auto-apply\r\n                    </p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <label className=\"relative inline-flex items-center cursor-pointer\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={autoOptimizeEnabled}\r\n                onChange={(e) => setAutoOptimizeEnabled(e.target.checked)}\r\n                className=\"sr-only peer\"\r\n                disabled={!bot.aiMlEnabled}\r\n              />\r\n              <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600\"></div>\r\n            </label>\r\n          </div>\r\n        )}\r\n\r\n        {error && (\r\n          <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3\">\r\n            <p className=\"text-sm text-red-800 dark:text-red-200\">{error}</p>\r\n          </div>\r\n        )}\r\n\r\n        {optimizationResult && (\r\n          <div className=\"space-y-3\">\r\n            <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4\">\r\n              <h4 className=\"font-semibold text-blue-900 dark:text-blue-100 mb-2\">\r\n                Optimization Available\r\n              </h4>\r\n              <p className=\"text-sm text-blue-800 dark:text-blue-200 mb-3\">\r\n                {optimizationResult.reasoning}\r\n              </p>\r\n              <p className=\"text-sm text-blue-700 dark:text-blue-300\">\r\n                <strong>Expected Improvement:</strong> {optimizationResult.expectedImprovement}\r\n              </p>\r\n            </div>\r\n\r\n            {showDetails && optimizationResult.changes.length > 0 && (\r\n              <div className=\"bg-gray-50 dark:bg-gray-800 rounded-lg p-4\">\r\n                <h5 className=\"font-semibold mb-2\">Suggested Changes:</h5>\r\n                <ul className=\"space-y-2\">\r\n                  {optimizationResult.changes.map((change, idx) => (\r\n                    <li key={idx} className=\"text-sm\">\r\n                      <span className=\"font-medium\">{change.parameter}:</span>{' '}\r\n                      <span className=\"text-red-600 dark:text-red-400\">{String(change.oldValue)}</span>\r\n                      {' → '}\r\n                      <span className=\"text-green-600 dark:text-green-400\">{String(change.newValue)}</span>\r\n                      {change.reason && (\r\n                        <span className=\"text-gray-600 dark:text-gray-400 block ml-4\">\r\n                          {change.reason}\r\n                        </span>\r\n                      )}\r\n                    </li>\r\n                  ))}\r\n                </ul>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"flex gap-2\">\r\n              <Button\r\n                onClick={() => setShowDetails(!showDetails)}\r\n                variant=\"secondary\"\r\n              >\r\n                {showDetails ? 'Hide Details' : 'Show Details'}\r\n              </Button>\r\n              <Button\r\n                onClick={handleAutoApply}\r\n                variant=\"primary\"\r\n                disabled={optimizationResult.confidence < 0.5}\r\n                title={optimizationResult.confidence < 0.65 \r\n                  ? `Confidence too low (${(optimizationResult.confidence * 100).toFixed(1)}%). Minimum: 65%` \r\n                  : 'Apply optimization'}\r\n              >\r\n                Apply Optimization {(optimizationResult.confidence * 100).toFixed(0)}%\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {!bot.aiMlEnabled && (\r\n          <div className=\"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3\">\r\n            <p className=\"text-sm text-yellow-800 dark:text-yellow-200\">\r\n              ⚠️ Enable AI/ML learning in bot settings to use auto-optimization features.\r\n            </p>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* AI Optimization History */}\r\n      <AiOptimizationLogs botId={bot.id} />\r\n    </Card>\r\n  );\r\n}\r\n\r\n","import { useState, useEffect } from 'react';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport Button from '../../components/base/Button';\nimport Card from '../../components/base/Card';\nimport Header from '../../components/feature/Header';\nimport type { TradingStrategy, TradingBot, AdvancedStrategyConfig } from '../../types/trading';\nimport { useBots } from '../../hooks/useBots';\nimport AutoOptimizer from '../../components/bot/AutoOptimizer';\nimport { STRATEGY_PRESETS, type StrategyPreset } from '../../constants/strategyPresets';\n\nexport default function EditBotPage() {\n  const navigate = useNavigate();\n  const { botId } = useParams<{ botId: string }>();\n  const { bots, updateBot } = useBots();\n  const [formData, setFormData] = useState({\n    name: '',\n    exchange: 'bybit' as 'bybit' | 'okx',\n    tradingType: 'spot' as 'spot' | 'futures',\n    symbol: 'BTCUSDT',\n    timeframe: '1h' as '1m' | '5m' | '15m' | '1h' | '2h' | '3h' | '4h' | '1d' | '1w',\n    leverage: 5,\n    riskLevel: 'medium' as 'low' | 'medium' | 'high',\n    tradeAmount: 100,\n    stopLoss: 2.0,\n    takeProfit: 4.0\n  });\n\n  const [strategy, setStrategy] = useState<TradingStrategy>({\n    rsiThreshold: 70,\n    adxThreshold: 25,\n    bbWidthThreshold: 0.02,\n    emaSlope: 0.5,\n    atrPercentage: 2.5,\n    vwapDistance: 1.2,\n    momentumThreshold: 0.8,\n    useMLPrediction: true,\n    minSamplesForML: 100\n  });\n\n  const [advancedConfig, setAdvancedConfig] = useState<AdvancedStrategyConfig>({\n    // Directional Bias\n    bias_mode: 'auto',\n    htf_timeframe: '4h',\n    htf_trend_indicator: 'EMA200',\n    ema_fast_period: 50,\n    require_price_vs_trend: 'any',\n    adx_min_htf: 23,\n    require_adx_rising: true,\n    \n    // Regime Filter\n    regime_mode: 'auto',\n    adx_trend_min: 25,\n    adx_meanrev_max: 19,\n    \n    // Session/Timing\n    session_filter_enabled: false,\n    allowed_hours_utc: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],\n    cooldown_bars: 8,\n    \n    // Volatility/Liquidity Gates\n    atr_percentile_min: 20,\n    bb_width_min: 0.012,\n    bb_width_max: 0.03,\n    min_24h_volume_usd: 500000000,\n    max_spread_bps: 3,\n    \n    // Risk & Exits\n    risk_per_trade_pct: 0.75,\n    daily_loss_limit_pct: 3.0,\n    weekly_loss_limit_pct: 6.0,\n    max_trades_per_day: 8,\n    max_concurrent: 2,\n    max_consecutive_losses: 5,\n    sl_atr_mult: 1.3,\n    tp1_r: 1.0,\n    tp2_r: 2.0,\n    tp1_size: 0.5,\n    breakeven_at_r: 0.8,\n    trail_after_tp1_atr: 1.0,\n    time_stop_hours: 48,\n    \n    // Technical Indicators\n    rsi_period: 14,\n    rsi_oversold: 30,\n    rsi_overbought: 70,\n    atr_period: 14,\n    atr_tp_multiplier: 3,\n    \n    // ML/AI Settings\n    use_ml_prediction: true,\n    ml_confidence_threshold: 0.6,\n    ml_min_samples: 100\n  });\n\n  const [isUpdating, setIsUpdating] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const popularSymbols = [\n    'BTCUSDT', 'ETHUSDT', 'SOLUSDT', 'ADAUSDT', 'DOTUSDT', 'AVAXUSDT',\n    'BNBUSDT', 'XRPUSDT', 'MATICUSDT', 'LINKUSDT', 'UNIUSDT', 'LTCUSDT'\n  ];\n\n  // Load bot data when component mounts\n  useEffect(() => {\n    if (botId && bots.length > 0) {\n      const bot = bots.find(b => b.id === botId);\n      console.log('Edit bot: Found bot:', bot);\n      if (bot) {\n        setFormData({\n          name: bot.name,\n          exchange: bot.exchange as 'bybit' | 'okx',\n          tradingType: bot.tradingType as 'spot' | 'futures',\n          symbol: bot.symbol,\n          timeframe: bot.timeframe || '1h',\n          leverage: bot.leverage || 5,\n          riskLevel: bot.riskLevel as 'low' | 'medium' | 'high',\n          tradeAmount: bot.tradeAmount || 100,\n          stopLoss: bot.stopLoss || 2.0,\n          takeProfit: bot.takeProfit || 4.0\n        });\n        \n        if (bot.strategy) {\n          setStrategy(bot.strategy as TradingStrategy);\n        }\n        \n        // Load advanced config from strategyConfig\n        if (bot.strategyConfig) {\n          setAdvancedConfig(prev => ({\n            ...prev,\n            ...bot.strategyConfig,\n            atr_period: bot.strategyConfig.atr_period ?? prev.atr_period ?? 14,\n            atr_tp_multiplier: bot.strategyConfig.atr_tp_multiplier ?? prev.atr_tp_multiplier ?? 3,\n            ema_fast_period: bot.strategyConfig.ema_fast_period ?? prev.ema_fast_period,\n            rsi_period: bot.strategyConfig.rsi_period ?? prev.rsi_period ?? 14,\n            rsi_overbought: bot.strategyConfig.rsi_overbought ?? prev.rsi_overbought ?? 70,\n            rsi_oversold: bot.strategyConfig.rsi_oversold ?? prev.rsi_oversold ?? 30,\n            sl_atr_mult: bot.strategyConfig.sl_atr_mult ?? prev.sl_atr_mult\n          }));\n        }\n        \n        console.log('Edit bot: Form data set:', formData);\n      } else {\n        console.log('Edit bot: Bot not found with ID:', botId);\n      }\n    }\n  }, [botId, bots]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!botId) return;\n    \n    setIsUpdating(true);\n    setError(null);\n    \n    try {\n      const botData = {\n        name: formData.name,\n        exchange: formData.exchange,\n        tradingType: formData.tradingType,\n        symbol: formData.symbol,\n        timeframe: formData.timeframe,\n        leverage: formData.leverage,\n        riskLevel: formData.riskLevel,\n        tradeAmount: formData.tradeAmount,\n        stopLoss: formData.stopLoss,\n        takeProfit: formData.takeProfit,\n        strategy: strategy,\n        strategyConfig: advancedConfig\n      };\n      \n      console.log('Edit bot: Updating bot data:', botData);\n      console.log('Edit bot: Bot ID:', botId);\n      \n      await updateBot(botId, botData);\n      \n      console.log('Edit bot: Update successful, navigating...');\n      navigate('/bots', { state: { message: `Bot \"${formData.name}\" updated successfully!` } });\n    } catch (error: any) {\n      console.error('Edit bot: Update failed:', error);\n      setError(error.message || 'Failed to update bot');\n    } finally {\n      setIsUpdating(false);\n    }\n  };\n\n  const handleInputChange = (field: string, value: any) => {\n    setFormData(prev => ({ ...prev, [field]: value }));\n  };\n\n  const handleStrategyChange = (field: keyof TradingStrategy, value: any) => {\n    setStrategy(prev => ({ ...prev, [field]: value }));\n  };\n\n  const applyStrategyPreset = (preset: StrategyPreset) => {\n    setStrategy({ ...preset.strategy });\n    setAdvancedConfig(prev => ({\n      ...prev,\n      ...preset.advanced,\n      allowed_hours_utc: [...preset.advanced.allowed_hours_utc]\n    }));\n    setFormData(prev => ({\n      ...prev,\n      tradeAmount: preset.recommendedTradeAmount ?? prev.tradeAmount,\n      stopLoss: preset.recommendedStopLoss ?? prev.stopLoss,\n      takeProfit: preset.recommendedTakeProfit ?? prev.takeProfit,\n      riskLevel: preset.recommendedRiskLevel ?? prev.riskLevel\n    }));\n    console.log('Applied strategy preset:', preset.key);\n  };\n\n  if (!botId) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Header title=\"Edit Bot\" />\n        <div className=\"pt-16 pb-6 px-4\">\n          <div className=\"max-w-2xl mx-auto\">\n            <Card>\n              <div className=\"text-center py-8\">\n                <p className=\"text-gray-500\">Bot not found</p>\n                <Button variant=\"primary\" onClick={() => navigate('/bots')} className=\"mt-4\">\n                  Back to Bots\n                </Button>\n              </div>\n            </Card>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <Header title=\"Edit Bot\" />\n      \n      <div className=\"pt-16 pb-6 px-4\">\n        <div className=\"max-w-4xl mx-auto\">\n          <div className=\"flex items-center mb-6\">\n            <Button \n              variant=\"secondary\" \n              onClick={() => navigate('/bots')}\n              className=\"mr-4\"\n            >\n              <i className=\"ri-arrow-left-line mr-2\"></i>\n              Back to Bots\n            </Button>\n            <h1 className=\"text-2xl font-bold text-gray-900\">Edit Trading Bot</h1>\n          </div>\n\n          <form onSubmit={handleSubmit}>\n            <Card>\n              <div className=\"space-y-6\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Bot Name\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.name}\n                    onChange={(e) => handleInputChange('name', e.target.value)}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                    placeholder=\"Enter bot name\"\n                    required\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Exchange\n                    </label>\n                    <select\n                      value={formData.exchange}\n                      onChange={(e) => handleInputChange('exchange', e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                    >\n                      <option value=\"bybit\">Bybit</option>\n                      <option value=\"okx\">OKX</option>\n                    </select>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Trading Type\n                    </label>\n                    <select\n                      value={formData.tradingType}\n                      onChange={(e) => handleInputChange('tradingType', e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                    >\n                      <option value=\"spot\">Spot Trading</option>\n                      <option value=\"futures\">Futures Trading</option>\n                    </select>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Trading Pair\n                    </label>\n                    <select\n                      value={formData.symbol}\n                      onChange={(e) => handleInputChange('symbol', e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                    >\n                      {popularSymbols.map(symbol => (\n                        <option key={symbol} value={symbol}>{symbol}</option>\n                      ))}\n                    </select>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Time Frame\n                    </label>\n                    <select\n                      value={formData.timeframe}\n                      onChange={(e) => handleInputChange('timeframe', e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                    >\n                      <option value=\"1m\">1 Minute</option>\n                      <option value=\"5m\">5 Minutes</option>\n                      <option value=\"15m\">15 Minutes</option>\n                      <option value=\"1h\">1 Hour</option>\n                      <option value=\"2h\">2 Hours</option>\n                      <option value=\"3h\">3 Hours</option>\n                      <option value=\"4h\">4 Hours</option>\n                      <option value=\"1d\">1 Day</option>\n                      <option value=\"1w\">1 Week</option>\n                    </select>\n                    <p className=\"text-xs text-gray-500 mt-1\">\n                      Chart interval for technical analysis\n                    </p>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Leverage\n                    </label>\n                    <select\n                      value={formData.leverage}\n                      onChange={(e) => handleInputChange('leverage', parseInt(e.target.value))}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                    >\n                      <option value={1}>1x</option>\n                      <option value={2}>2x</option>\n                      <option value={3}>3x</option>\n                      <option value={5}>5x</option>\n                      <option value={10}>10x</option>\n                      <option value={20}>20x</option>\n                    </select>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Risk Level\n                    </label>\n                    <select\n                      value={formData.riskLevel}\n                      onChange={(e) => handleInputChange('riskLevel', e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                    >\n                      <option value=\"low\">Low Risk</option>\n                      <option value=\"medium\">Medium Risk</option>\n                      <option value=\"high\">High Risk</option>\n                    </select>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Trade Amount (USD)\n                    </label>\n                    <input\n                      type=\"number\"\n                      value={formData.tradeAmount}\n                      onChange={(e) => handleInputChange('tradeAmount', parseFloat(e.target.value))}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                      min=\"10\"\n                      max=\"10000\"\n                      step=\"10\"\n                      required\n                    />\n                    <p className=\"text-xs text-gray-500 mt-1\">\n                      Base trade amount in USD (will be multiplied by leverage and risk level)\n                    </p>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Stop Loss (%)\n                    </label>\n                    <input\n                      type=\"number\"\n                      value={formData.stopLoss}\n                      onChange={(e) => handleInputChange('stopLoss', parseFloat(e.target.value))}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                      min=\"0.5\"\n                      max=\"10\"\n                      step=\"0.5\"\n                      required\n                    />\n                    <p className=\"text-xs text-gray-500 mt-1\">\n                      Maximum loss percentage before closing position\n                    </p>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Take Profit (%)\n                    </label>\n                    <input\n                      type=\"number\"\n                      value={formData.takeProfit}\n                      onChange={(e) => handleInputChange('takeProfit', parseFloat(e.target.value))}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                      min=\"1\"\n                      max=\"20\"\n                      step=\"0.5\"\n                      required\n                    />\n                    <p className=\"text-xs text-gray-500 mt-1\">\n                      Target profit percentage before closing position\n                    </p>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Cooldown (Bars)\n                    </label>\n                    <input\n                      type=\"number\"\n                      value={advancedConfig.cooldown_bars}\n                      onChange={(e) => setAdvancedConfig(prev => ({ ...prev, cooldown_bars: parseInt(e.target.value) || 8 }))}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                      min=\"1\"\n                      max=\"100\"\n                      step=\"1\"\n                    />\n                    <p className=\"text-xs text-gray-500 mt-1\">\n                      Number of bars to wait between trades (prevents overtrading)\n                    </p>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Allowed Trading Hours (EST)\n                    </label>\n                    <div className=\"border border-gray-300 rounded-lg p-3 bg-gray-50 max-h-48 overflow-y-auto\">\n                      <div className=\"flex items-center mb-2\">\n                        <input\n                          type=\"checkbox\"\n                          checked={advancedConfig.allowed_hours_utc.length === 24}\n                          onChange={(e) => {\n                            if (e.target.checked) {\n                              setAdvancedConfig(prev => ({ \n                                ...prev, \n                                allowed_hours_utc: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],\n                                session_filter_enabled: false\n                              }));\n                            } else {\n                              setAdvancedConfig(prev => ({ \n                                ...prev, \n                                allowed_hours_utc: [],\n                                session_filter_enabled: true\n                              }));\n                            }\n                          }}\n                          className=\"mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                        />\n                        <span className=\"text-sm font-medium text-gray-700\">Select All (24/7)</span>\n                      </div>\n                      <div className=\"grid grid-cols-4 gap-2\">\n                        {Array.from({ length: 24 }, (_, i) => {\n                          // Convert UTC hour to EST for display (EST = UTC - 5)\n                          const estHour = (i - 5 + 24) % 24;\n                          const isSelected = advancedConfig.allowed_hours_utc.includes(i);\n                          return (\n                            <label key={i} className=\"flex items-center\">\n                              <input\n                                type=\"checkbox\"\n                                checked={isSelected}\n                                onChange={(e) => {\n                                  if (e.target.checked) {\n                                    setAdvancedConfig(prev => ({\n                                      ...prev,\n                                      allowed_hours_utc: [...prev.allowed_hours_utc, i].sort((a, b) => a - b),\n                                      session_filter_enabled: true\n                                    }));\n                                  } else {\n                                    setAdvancedConfig(prev => ({\n                                      ...prev,\n                                      allowed_hours_utc: prev.allowed_hours_utc.filter(h => h !== i),\n                                      session_filter_enabled: prev.allowed_hours_utc.filter(h => h !== i).length > 0\n                                    }));\n                                  }\n                                }}\n                                className=\"mr-1 h-3 w-3 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                              />\n                              <span className=\"text-xs text-gray-700\">\n                                {estHour.toString().padStart(2, '0')}:00 EST\n                              </span>\n                            </label>\n                          );\n                        })}\n                      </div>\n                    </div>\n                    <p className=\"text-xs text-gray-500 mt-1\">\n                      Select hours when bot is allowed to trade (stored in UTC, displayed in EST)\n                    </p>\n                  </div>\n\n                {/* Indicator Settings */}\n                <div className=\"border border-indigo-200 rounded-lg p-4 bg-indigo-50\">\n                  <h3 className=\"text-md font-semibold text-indigo-900 mb-3 flex items-center gap-2\">\n                    <i className=\"ri-sliders-line\"></i>\n                    Indicator Settings\n                  </h3>\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        EMA Length\n                      </label>\n                      <input\n                        type=\"number\"\n                        value={advancedConfig.ema_fast_period ?? 50}\n                        onChange={(e) =>\n                          setAdvancedConfig(prev => ({\n                            ...prev,\n                            ema_fast_period: parseInt(e.target.value) || 50\n                          }))\n                        }\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                        min={1}\n                        max={500}\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        ATR Length\n                      </label>\n                      <input\n                        type=\"number\"\n                        value={advancedConfig.atr_period ?? 14}\n                        onChange={(e) =>\n                          setAdvancedConfig(prev => ({\n                            ...prev,\n                            atr_period: parseInt(e.target.value) || 14\n                          }))\n                        }\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                        min={1}\n                        max={200}\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        ATR TP Multiplier\n                      </label>\n                      <input\n                        type=\"number\"\n                        value={advancedConfig.atr_tp_multiplier ?? 3}\n                        onChange={(e) =>\n                          setAdvancedConfig(prev => ({\n                            ...prev,\n                            atr_tp_multiplier: parseFloat(e.target.value) || 3\n                          }))\n                        }\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                        min={0.5}\n                        max={10}\n                        step={0.1}\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        ATR SL Multiplier\n                      </label>\n                      <input\n                        type=\"number\"\n                        value={advancedConfig.sl_atr_mult}\n                        onChange={(e) =>\n                          setAdvancedConfig(prev => ({\n                            ...prev,\n                            sl_atr_mult: parseFloat(e.target.value) || prev.sl_atr_mult\n                          }))\n                        }\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                        min={0.5}\n                        max={5}\n                        step={0.1}\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        RSI Length\n                      </label>\n                      <input\n                        type=\"number\"\n                        value={advancedConfig.rsi_period ?? 14}\n                        onChange={(e) =>\n                          setAdvancedConfig(prev => ({\n                            ...prev,\n                            rsi_period: parseInt(e.target.value) || 14\n                          }))\n                        }\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                        min={5}\n                        max={50}\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        RSI Overbought\n                      </label>\n                      <input\n                        type=\"number\"\n                        value={advancedConfig.rsi_overbought ?? 70}\n                        onChange={(e) =>\n                          setAdvancedConfig(prev => ({\n                            ...prev,\n                            rsi_overbought: parseInt(e.target.value) || 70\n                          }))\n                        }\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                        min={50}\n                        max={100}\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        RSI Oversold\n                      </label>\n                      <input\n                        type=\"number\"\n                        value={advancedConfig.rsi_oversold ?? 30}\n                        onChange={(e) =>\n                          setAdvancedConfig(prev => ({\n                            ...prev,\n                            rsi_oversold: parseInt(e.target.value) || 30\n                          }))\n                        }\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n                        min={0}\n                        max={50}\n                      />\n                    </div>\n                  </div>\n                </div>\n                </div>\n\n                {/* Strategy Settings */}\n                <div className=\"border-t pt-6\">\n                  <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Strategy Settings</h3>\n                  <div className=\"mb-6\">\n                    <div className=\"bg-purple-50 border border-purple-200 rounded-lg p-4\">\n                      <div className=\"flex items-center justify-between mb-3\">\n                        <h4 className=\"font-semibold text-purple-900 flex items-center gap-2 text-sm md:text-base\">\n                          <i className=\"ri-brain-line\"></i>\n                          AI Strategy Presets\n                        </h4>\n                        <span className=\"hidden md:block text-xs text-purple-700\">\n                          Rapidly align this bot with proven AI templates\n                        </span>\n                      </div>\n                      <div className=\"flex flex-wrap gap-2\">\n                        {STRATEGY_PRESETS.map((preset) => (\n                          <button\n                            key={preset.key}\n                            type=\"button\"\n                            onClick={() => applyStrategyPreset(preset)}\n                            className=\"px-3 py-2 rounded-lg border border-purple-300 bg-white text-purple-700 hover:bg-purple-100 text-sm font-medium flex items-center gap-2 transition-colors\"\n                          >\n                            <i className=\"ri-flashlight-line\"></i>\n                            {preset.label}\n                          </button>\n                        ))}\n                      </div>\n                      <p className=\"text-xs text-purple-700 mt-3\">\n                        Applying a preset updates strategy parameters, risk controls, and recommended trade sizing.\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        RSI Threshold\n                      </label>\n                      <input\n                        type=\"number\"\n                        value={strategy.rsiThreshold}\n                        onChange={(e) => handleStrategyChange('rsiThreshold', parseInt(e.target.value))}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                        min=\"50\"\n                        max=\"90\"\n                        step=\"5\"\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        ADX Threshold\n                      </label>\n                      <input\n                        type=\"number\"\n                        value={strategy.adxThreshold}\n                        onChange={(e) => handleStrategyChange('adxThreshold', parseInt(e.target.value))}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                        min=\"15\"\n                        max=\"50\"\n                        step=\"5\"\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        Bollinger Band Width Threshold\n                      </label>\n                      <input\n                        type=\"number\"\n                        value={strategy.bbWidthThreshold}\n                        onChange={(e) => handleStrategyChange('bbWidthThreshold', parseFloat(e.target.value))}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                        min=\"0.01\"\n                        max=\"0.1\"\n                        step=\"0.01\"\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        EMA Slope\n                      </label>\n                      <input\n                        type=\"number\"\n                        value={strategy.emaSlope}\n                        onChange={(e) => handleStrategyChange('emaSlope', parseFloat(e.target.value))}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                        min=\"0.1\"\n                        max=\"2.0\"\n                        step=\"0.1\"\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        ATR Percentage\n                      </label>\n                      <input\n                        type=\"number\"\n                        value={strategy.atrPercentage}\n                        onChange={(e) => handleStrategyChange('atrPercentage', parseFloat(e.target.value))}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                        min=\"1.0\"\n                        max=\"5.0\"\n                        step=\"0.5\"\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        VWAP Distance\n                      </label>\n                      <input\n                        type=\"number\"\n                        value={strategy.vwapDistance}\n                        onChange={(e) => handleStrategyChange('vwapDistance', parseFloat(e.target.value))}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                        min=\"0.5\"\n                        max=\"3.0\"\n                        step=\"0.1\"\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        Momentum Threshold\n                      </label>\n                      <input\n                        type=\"number\"\n                        value={strategy.momentumThreshold}\n                        onChange={(e) => handleStrategyChange('momentumThreshold', parseFloat(e.target.value))}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                        min=\"0.5\"\n                        max=\"2.0\"\n                        step=\"0.1\"\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        Min Samples for ML\n                      </label>\n                      <input\n                        type=\"number\"\n                        value={strategy.minSamplesForML}\n                        onChange={(e) => handleStrategyChange('minSamplesForML', parseInt(e.target.value))}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                        min=\"50\"\n                        max=\"1000\"\n                        step=\"50\"\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"mt-4\">\n                    <label className=\"flex items-center\">\n                      <input\n                        type=\"checkbox\"\n                        checked={strategy.useMLPrediction}\n                        onChange={(e) => handleStrategyChange('useMLPrediction', e.target.checked)}\n                        className=\"mr-2\"\n                      />\n                      <span className=\"text-sm font-medium text-gray-700\">\n                        Use Machine Learning Prediction\n                      </span>\n                    </label>\n                  </div>\n                </div>\n\n                {error && (\n                  <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n                    <p className=\"text-red-600\">{error}</p>\n                  </div>\n                )}\n\n                <div className=\"flex space-x-4 pt-6 border-t\">\n                  <Button\n                    type=\"submit\"\n                    variant=\"primary\"\n                    className=\"flex-1\"\n                    disabled={isUpdating}\n                  >\n                    {isUpdating ? (\n                      <>\n                        <i className=\"ri-loader-4-line animate-spin mr-2\"></i>\n                        Updating Bot...\n                      </>\n                    ) : (\n                      <>\n                        <i className=\"ri-save-line mr-2\"></i>\n                        Update Bot\n                      </>\n                    )}\n                  </Button>\n                  <Button\n                    type=\"button\"\n                    variant=\"secondary\"\n                    onClick={() => navigate('/bots')}\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </div>\n            </Card>\n          </form>\n\n          {/* AI Auto-Optimization Component */}\n          {botId && (\n            <div className=\"mt-6\">\n              {(() => {\n                const currentBot = bots.find(b => b.id === botId);\n                if (currentBot) {\n                  return <AutoOptimizer bot={currentBot as TradingBot} />;\n                }\n                // Show loading state while bots are being fetched\n                return (\n                  <Card title=\"AI Auto-Optimization\" className=\"mt-4\">\n                    <div className=\"text-center py-4\">\n                      <div className=\"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mb-2\"></div>\n                      <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                        Loading bot information...\n                      </p>\n                    </div>\n                  </Card>\n                );\n              })()}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["VALIDATION_RANGES","VALID_ENUMS","validateAndClampStrategyConfig","config","validated","key","range","validValues","h","AutoOptimizer$1","__publicField","botId","bot","botError","supabase","thirtyDaysAgo","trades","tradesError","closedTrades","t","winningTrades","losingTrades","totalPnL","sum","winRate","avgWinPnL","avgLossPnL","profitFactor","maxDrawdown","peak","cumulativePnL","trade","a","b","drawdown","tradesBySymbol","acc","bestPair","worstPair","bestPnL","worstPnL","symbol","symbolTrades","symbolPnL","returns","avgReturn","r","variance","sharpeRatio","strategy","error","strategyConfig","performance","limitedTrades","optimization","openAIService","changes","originalStrategy","optimizedStrategy","oldValue","newValue","minConfidence","performanceBefore","aiProvider","aiModel","optimizationRecord","optimizationData","recordError","validatedAdvancedConfig","updateError","changeSummary","change","logMessage","logDetails","tradeId","learnError","userId","query","bots","resolve","autoOptimizer","AutoOptimizer","useAutoOptimizer","isOptimizing","setIsOptimizing","useState","optimizationResult","setOptimizationResult","setError","storageKey","autoOptimizeEnabled","setAutoOptimizeEnabledState","setAutoOptimizeEnabled","value","optimizeBot","useCallback","result","err","errorMessage","autoApplyOptimization","applied","useEffect","interval","AiOptimizationLogs","logs","setLogs","loading","setLoading","expandedLog","setExpandedLog","fetchOptimizationLogs","session","data","aiLogs","log","_a","formatTimestamp","timestamp","getConfidenceColor","confidence","jsx","Card","jsxs","_b","_c","_d","_f","_e","_g","_h","_i","_j","idx","_k","_n","_m","_l","_q","_p","_o","_t","_s","_r","showDetails","setShowDetails","handleOptimize","handleAutoApply","confidencePercent","Button","e","EditBotPage","navigate","useNavigate","useParams","updateBot","useBots","formData","setFormData","setStrategy","advancedConfig","setAdvancedConfig","isUpdating","setIsUpdating","popularSymbols","prev","handleSubmit","botData","handleInputChange","field","handleStrategyChange","applyStrategyPreset","preset","Header","_","i","estHour","isSelected","STRATEGY_PRESETS","Fragment","currentBot"],"mappings":"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"}