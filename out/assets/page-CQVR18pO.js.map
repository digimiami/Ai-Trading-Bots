{"version":3,"file":"page-CQVR18pO.js","sources":["../../src/pages/auth/page.tsx"],"sourcesContent":["\nimport { useState, useEffect } from 'react'\nimport { useAuth } from '../../hooks/useAuth'\nimport { Button } from '../../components/base/Button'\nimport { Card } from '../../components/base/Card'\nimport { supabase } from '../../lib/supabase'\n\nexport default function AuthPage() {\n  const [isLogin, setIsLogin] = useState(true)\n  const [email, setEmail] = useState('')\n  const [password, setPassword] = useState('')\n  const [inviteCode, setInviteCode] = useState('')\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [inviteValid, setInviteValid] = useState<boolean | null>(null)\n  const [showFixAuth, setShowFixAuth] = useState(false)\n  \n  const { signIn, signUp } = useAuth()\n\n  // Check for invitation code in URL\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search)\n    const invite = urlParams.get('invite')\n    if (invite) {\n      setInviteCode(invite)\n      setIsLogin(false)\n      validateInviteCode(invite)\n    }\n  }, [])\n\n  const validateInviteCode = async (code: string) => {\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`${supabase.supabaseUrl}/functions/v1/invitation-management?action=validate`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token || ''}`\n        },\n        body: JSON.stringify({ code })\n      })\n      \n      const result = await response.json()\n      setInviteValid(result.valid)\n      \n      if (result.valid && result.invitation.email) {\n        setEmail(result.invitation.email)\n      }\n    } catch (err) {\n      setInviteValid(false)\n    }\n  }\n\n  const handleFixAuth = async () => {\n    setLoading(true)\n    setError(null)\n\n    try {\n      const response = await fetch(`${supabase.supabaseUrl}/functions/v1/fix-auth-final`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          email: 'digimiami@gmail.com',\n          password: 'lagina123'\n        })\n      })\n\n      const result = await response.json()\n      \n      if (result.success) {\n        setError(null)\n        alert('Admin account fixed! You can now login with: digimiami@gmail.com / lagina123')\n        setEmail('digimiami@gmail.com')\n        setPassword('lagina123')\n        setShowFixAuth(false)\n      } else {\n        setError(result.error || 'Failed to fix admin account')\n      }\n    } catch (err) {\n      setError('Failed to fix admin account')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setLoading(true)\n    setError(null)\n\n    try {\n      let result\n      \n      if (isLogin) {\n        result = await signIn(email, password)\n      } else {\n        result = await signUp(email, password)\n        \n        // If signup successful and there's an invite code, mark it as used\n        if (!result.error && inviteCode) {\n          try {\n            const { data: { session } } = await supabase.auth.getSession()\n            await fetch(`${supabase.supabaseUrl}/functions/v1/invitation-management?action=use`, {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${session?.access_token || ''}`\n              },\n              body: JSON.stringify({ \n                code: inviteCode,\n                userId: result.data?.user?.id \n              })\n            })\n          } catch (inviteError) {\n            console.error('Failed to mark invitation as used:', inviteError)\n          }\n        }\n      }\n\n      if (result.error) {\n        setError(result.error.message)\n      }\n    } catch (err) {\n      setError('An unexpected error occurred')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4\">\n      <Card className=\"w-full max-w-md p-8\">\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">\n            {isLogin ? 'Welcome Back' : 'Create Account'}\n          </h1>\n          <p className=\"text-gray-600\">\n            {isLogin ? 'Sign in to your trading account' : 'Start your trading journey'}\n          </p>\n          {inviteCode && (\n            <div className={`mt-3 p-2 rounded-lg text-sm ${\n              inviteValid === true ? 'bg-green-50 text-green-700' : \n              inviteValid === false ? 'bg-red-50 text-red-700' : \n              'bg-yellow-50 text-yellow-700'\n            }`}>\n              {inviteValid === true ? '✓ Valid invitation code' : \n               inviteValid === false ? '✗ Invalid or expired invitation' : \n               'Validating invitation...'}\n            </div>\n          )}\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          {!isLogin && inviteCode && (\n            <div>\n              <label htmlFor=\"inviteCode\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Invitation Code\n              </label>\n              <input\n                id=\"inviteCode\"\n                type=\"text\"\n                value={inviteCode}\n                onChange={(e) => setInviteCode(e.target.value)}\n                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50\"\n                placeholder=\"Enter invitation code\"\n                readOnly\n              />\n            </div>\n          )}\n\n          <div>\n            <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Email Address\n            </label>\n            <input\n              id=\"email\"\n              type=\"email\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n              placeholder=\"Enter your email\"\n              required\n            />\n          </div>\n\n          <div>\n            <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Password\n            </label>\n            <input\n              id=\"password\"\n              type=\"password\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n              placeholder=\"Enter your password\"\n              required\n            />\n          </div>\n\n          {error && (\n            <div className=\"bg-red-50 border border-red-200 rounded-lg p-3\">\n              <p className=\"text-red-600 text-sm\">{error}</p>\n              {error.includes('Invalid login credentials') && (\n                <button\n                  type=\"button\"\n                  onClick={() => setShowFixAuth(true)}\n                  className=\"mt-2 text-blue-600 hover:text-blue-700 text-sm underline\"\n                >\n                  Fix Admin Account\n                </button>\n              )}\n            </div>\n          )}\n\n          {showFixAuth && (\n            <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\n              <p className=\"text-yellow-800 text-sm mb-3\">\n                Click below to fix the admin account authentication:\n              </p>\n              <Button\n                type=\"button\"\n                onClick={handleFixAuth}\n                disabled={loading}\n                className=\"w-full bg-yellow-600 hover:bg-yellow-700\"\n              >\n                {loading ? 'Fixing...' : 'Fix Admin Account'}\n              </Button>\n            </div>\n          )}\n\n          <Button\n            type=\"submit\"\n            className=\"w-full\"\n            disabled={loading || (!isLogin && inviteCode && inviteValid !== true)}\n          >\n            {loading ? 'Processing...' : (isLogin ? 'Sign In' : 'Create Account')}\n          </Button>\n        </form>\n\n        <div className=\"mt-6 text-center\">\n          <button\n            onClick={() => setIsLogin(!isLogin)}\n            className=\"text-blue-600 hover:text-blue-700 text-sm font-medium\"\n          >\n            {isLogin ? \"Don't have an account? Sign up\" : 'Already have an account? Sign in'}\n          </button>\n        </div>\n      </Card>\n    </div>\n  )\n}\n"],"names":["AuthPage","isLogin","setIsLogin","useState","email","setEmail","password","setPassword","inviteCode","setInviteCode","loading","setLoading","error","setError","inviteValid","setInviteValid","showFixAuth","setShowFixAuth","signIn","signUp","useAuth","useEffect","invite","validateInviteCode","code","session","supabase","result","handleFixAuth","handleSubmit","e","inviteError","jsxs","Card","jsx","Button"],"mappings":"6IAOA,SAAwBA,GAAW,CACjC,KAAM,CAACC,EAASC,CAAU,EAAIC,EAAAA,SAAS,EAAI,EACrC,CAACC,EAAOC,CAAQ,EAAIF,EAAAA,SAAS,EAAE,EAC/B,CAACG,EAAUC,CAAW,EAAIJ,EAAAA,SAAS,EAAE,EACrC,CAACK,EAAYC,CAAa,EAAIN,EAAAA,SAAS,EAAE,EACzC,CAACO,EAASC,CAAU,EAAIR,EAAAA,SAAS,EAAK,EACtC,CAACS,EAAOC,CAAQ,EAAIV,EAAAA,SAAwB,IAAI,EAChD,CAACW,EAAaC,CAAc,EAAIZ,EAAAA,SAAyB,IAAI,EAC7D,CAACa,EAAaC,CAAc,EAAId,EAAAA,SAAS,EAAK,EAE9C,CAAE,OAAAe,EAAQ,OAAAC,CAAA,EAAWC,EAAA,EAG3BC,EAAAA,UAAU,IAAM,CAEd,MAAMC,EADY,IAAI,gBAAgB,OAAO,SAAS,MAAM,EACnC,IAAI,QAAQ,EACjCA,IACFb,EAAca,CAAM,EACpBpB,EAAW,EAAK,EAChBqB,EAAmBD,CAAM,EAE7B,EAAG,CAAA,CAAE,EAEL,MAAMC,EAAqB,MAAOC,GAAiB,CACjD,GAAI,CACF,KAAM,CAAE,KAAM,CAAE,QAAAC,CAAA,GAAc,MAAMC,EAAS,KAAK,WAAA,EAU5CC,EAAS,MATE,MAAM,MAAM,GAAGD,EAAS,WAAW,sDAAuD,CACzG,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUD,GAAS,cAAgB,EAAE,EAAA,EAExD,KAAM,KAAK,UAAU,CAAE,KAAAD,EAAM,CAAA,CAC9B,GAE6B,KAAA,EAC9BT,EAAeY,EAAO,KAAK,EAEvBA,EAAO,OAASA,EAAO,WAAW,OACpCtB,EAASsB,EAAO,WAAW,KAAK,CAEpC,MAAc,CACZZ,EAAe,EAAK,CACtB,CACF,EAEMa,EAAgB,SAAY,CAChCjB,EAAW,EAAI,EACfE,EAAS,IAAI,EAEb,GAAI,CAYF,MAAMc,EAAS,MAXE,MAAM,MAAM,GAAGD,EAAS,WAAW,+BAAgC,CAClF,OAAQ,OACR,QAAS,CACP,eAAgB,kBAAA,EAElB,KAAM,KAAK,UAAU,CACnB,MAAO,sBACP,SAAU,WAAA,CACX,CAAA,CACF,GAE6B,KAAA,EAE1BC,EAAO,SACTd,EAAS,IAAI,EACb,MAAM,8EAA8E,EACpFR,EAAS,qBAAqB,EAC9BE,EAAY,WAAW,EACvBU,EAAe,EAAK,GAEpBJ,EAASc,EAAO,OAAS,6BAA6B,CAE1D,MAAc,CACZd,EAAS,6BAA6B,CACxC,QAAA,CACEF,EAAW,EAAK,CAClB,CACF,EAEMkB,EAAe,MAAOC,GAAuB,CACjDA,EAAE,eAAA,EACFnB,EAAW,EAAI,EACfE,EAAS,IAAI,EAEb,GAAI,CACF,IAAIc,EAEJ,GAAI1B,EACF0B,EAAS,MAAMT,EAAOd,EAAOE,CAAQ,UAErCqB,EAAS,MAAMR,EAAOf,EAAOE,CAAQ,EAGjC,CAACqB,EAAO,OAASnB,EACnB,GAAI,CACF,KAAM,CAAE,KAAM,CAAE,QAAAiB,CAAA,GAAc,MAAMC,EAAS,KAAK,WAAA,EAClD,MAAM,MAAM,GAAGA,EAAS,WAAW,iDAAkD,CACnF,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUD,GAAS,cAAgB,EAAE,EAAA,EAExD,KAAM,KAAK,UAAU,CACnB,KAAMjB,EACN,OAAQmB,EAAO,MAAM,MAAM,EAAA,CAC5B,CAAA,CACF,CACH,OAASI,EAAa,CACpB,QAAQ,MAAM,qCAAsCA,CAAW,CACjE,CAIAJ,EAAO,OACTd,EAASc,EAAO,MAAM,OAAO,CAEjC,MAAc,CACZd,EAAS,8BAA8B,CACzC,QAAA,CACEF,EAAW,EAAK,CAClB,CACF,EAEA,aACG,MAAA,CAAI,UAAU,iGACb,SAAAqB,EAAAA,KAACC,EAAA,CAAK,UAAU,sBACd,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,mBACb,SAAA,CAAAE,MAAC,KAAA,CAAG,UAAU,wCACX,SAAAjC,EAAU,eAAiB,iBAC9B,QACC,IAAA,CAAE,UAAU,gBACV,SAAAA,EAAU,kCAAoC,6BACjD,EACCO,GACC0B,EAAAA,IAAC,MAAA,CAAI,UAAW,+BACdpB,IAAgB,GAAO,6BACvBA,IAAgB,GAAQ,yBACxB,8BACF,GACG,SAAAA,IAAgB,GAAO,0BACvBA,IAAgB,GAAQ,kCACxB,0BAAA,CACH,CAAA,EAEJ,EAEAkB,EAAAA,KAAC,OAAA,CAAK,SAAUH,EAAc,UAAU,YACrC,SAAA,CAAA,CAAC5B,GAAWO,GACXwB,EAAAA,KAAC,MAAA,CACC,SAAA,CAAAE,MAAC,QAAA,CAAM,QAAQ,aAAa,UAAU,+CAA+C,SAAA,kBAErF,EACAA,EAAAA,IAAC,QAAA,CACC,GAAG,aACH,KAAK,OACL,MAAO1B,EACP,SAAWsB,GAAMrB,EAAcqB,EAAE,OAAO,KAAK,EAC7C,UAAU,0HACV,YAAY,wBACZ,SAAQ,EAAA,CAAA,CACV,EACF,SAGD,MAAA,CACC,SAAA,CAAAI,MAAC,QAAA,CAAM,QAAQ,QAAQ,UAAU,+CAA+C,SAAA,gBAEhF,EACAA,EAAAA,IAAC,QAAA,CACC,GAAG,QACH,KAAK,QACL,MAAO9B,EACP,SAAW0B,GAAMzB,EAASyB,EAAE,OAAO,KAAK,EACxC,UAAU,+GACV,YAAY,mBACZ,SAAQ,EAAA,CAAA,CACV,EACF,SAEC,MAAA,CACC,SAAA,CAAAI,MAAC,QAAA,CAAM,QAAQ,WAAW,UAAU,+CAA+C,SAAA,WAEnF,EACAA,EAAAA,IAAC,QAAA,CACC,GAAG,WACH,KAAK,WACL,MAAO5B,EACP,SAAWwB,GAAMvB,EAAYuB,EAAE,OAAO,KAAK,EAC3C,UAAU,+GACV,YAAY,sBACZ,SAAQ,EAAA,CAAA,CACV,EACF,EAEClB,GACCoB,EAAAA,KAAC,MAAA,CAAI,UAAU,iDACb,SAAA,CAAAE,EAAAA,IAAC,IAAA,CAAE,UAAU,uBAAwB,SAAAtB,EAAM,EAC1CA,EAAM,SAAS,2BAA2B,GACzCsB,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,QAAS,IAAMjB,EAAe,EAAI,EAClC,UAAU,2DACX,SAAA,mBAAA,CAAA,CAED,EAEJ,EAGDD,GACCgB,EAAAA,KAAC,MAAA,CAAI,UAAU,uDACb,SAAA,CAAAE,EAAAA,IAAC,IAAA,CAAE,UAAU,+BAA+B,SAAA,uDAE5C,EACAA,EAAAA,IAACC,EAAA,CACC,KAAK,SACL,QAASP,EACT,SAAUlB,EACV,UAAU,2CAET,WAAU,YAAc,mBAAA,CAAA,CAC3B,EACF,EAGFwB,EAAAA,IAACC,EAAA,CACC,KAAK,SACL,UAAU,SACV,SAAUzB,GAAY,CAACT,GAAWO,GAAcM,IAAgB,GAE/D,SAAAJ,EAAU,gBAAmBT,EAAU,UAAY,gBAAA,CAAA,CACtD,EACF,EAEAiC,EAAAA,IAAC,MAAA,CAAI,UAAU,mBACb,SAAAA,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMhC,EAAW,CAACD,CAAO,EAClC,UAAU,wDAET,WAAU,iCAAmC,kCAAA,CAAA,CAChD,CACF,CAAA,CAAA,CACF,CAAA,CACF,CAEJ"}