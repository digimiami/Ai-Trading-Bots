{"version":3,"file":"page-1850ac00.js","sources":["../../src/pages/webhook-test/page.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport Header from '../../components/feature/Header';\r\nimport Card from '../../components/base/Card';\r\nimport Button from '../../components/base/Button';\r\nimport { supabase } from '../../lib/supabase';\r\nimport { useBots } from '../../hooks/useBots';\r\n\r\nconst generateWebhookSecret = () => {\r\n  try {\r\n    const array = new Uint8Array(18);\r\n    if (window?.crypto?.getRandomValues) {\r\n      window.crypto.getRandomValues(array);\r\n      return Array.from(array, (byte) => byte.toString(16).padStart(2, '0')).join('');\r\n    }\r\n  } catch (error) {\r\n    console.warn('Falling back to Math.random for webhook secret generation:', error);\r\n  }\r\n  return Math.random().toString(36).slice(2, 12) + Math.random().toString(36).slice(2, 12);\r\n};\r\n\r\ninterface WebhookCall {\r\n  id: string;\r\n  bot_id: string | null;\r\n  user_id: string;\r\n  raw_payload: any;\r\n  parsed_payload: any;\r\n  secret_provided: string | null;\r\n  secret_valid: boolean;\r\n  bot_found: boolean;\r\n  side: string | null;\r\n  mode: string | null;\r\n  status: 'received' | 'processed' | 'failed' | 'rejected';\r\n  error_message: string | null;\r\n  response_status: number | null;\r\n  response_body: any;\r\n  signal_id: string | null;\r\n  trigger_executed: boolean;\r\n  trigger_response: any;\r\n  created_at: string;\r\n  processed_at: string | null;\r\n}\r\n\r\nexport default function WebhookTestPage() {\r\n  const navigate = useNavigate();\r\n  const { bots, updateBot } = useBots();\r\n  const [selectedBot, setSelectedBot] = useState<string>('');\r\n  const [webhookUrl, setWebhookUrl] = useState<string>('');\r\n  const [webhookSecret, setWebhookSecret] = useState<string>('');\r\n  const [testPayload, setTestPayload] = useState<string>('');\r\n  const [testResult, setTestResult] = useState<any>(null);\r\n  const [isTesting, setIsTesting] = useState(false);\r\n  const [webhookCalls, setWebhookCalls] = useState<WebhookCall[]>([]);\r\n  const [loadingCalls, setLoadingCalls] = useState(false);\r\n  const [showSecret, setShowSecret] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (bots.length > 0 && !selectedBot) {\r\n      setSelectedBot(bots[0].id);\r\n    }\r\n  }, [bots, selectedBot]);\r\n\r\n  useEffect(() => {\r\n    if (selectedBot) {\r\n      const bot = bots.find(b => b.id === selectedBot);\r\n      if (bot) {\r\n        // Use the same method as supabase.ts to get the URL\r\n        const supabaseUrl = import.meta.env.VITE_PUBLIC_SUPABASE_URL || import.meta.env.VITE_SUPABASE_URL || '';\r\n        if (!supabaseUrl) {\r\n          console.error('‚ö†Ô∏è Supabase URL not configured');\r\n          setWebhookUrl('/functions/v1/tradingview-webhook');\r\n        } else {\r\n          setWebhookUrl(`${supabaseUrl}/functions/v1/tradingview-webhook`);\r\n        }\r\n        \r\n        // Always update secret from bot data (in case it was updated)\r\n        const botSecret = bot.webhook_secret || bot.webhookSecret || '';\r\n        setWebhookSecret(botSecret);\r\n        \r\n        // Generate test payload (using TradingView strategy variables format)\r\n        const payload = {\r\n          secret: botSecret,\r\n          botId: bot.id,\r\n          action: 'buy', // {{strategy.order.action}} - Can be: 'buy', 'sell', 'long', 'short'\r\n          marketPosition: 'long', // {{strategy.market_position}}\r\n          prevMarketPosition: 'flat', // {{strategy.prev_market_position}}\r\n          marketPositionSize: '1.0', // {{strategy.market_position_size}}\r\n          prevMarketPositionSize: '0.0', // {{strategy.prev_market_position_size}}\r\n          instrument: 'BTCUSDT', // {{ticker}}\r\n          timestamp: new Date().toISOString(), // {{timenow}}\r\n          maxLag: '300',\r\n          investmentType: 'base',\r\n          amount: '1.0', // {{strategy.order.contracts}}\r\n          mode: 'paper',\r\n          reason: 'Test webhook from testing interface'\r\n        };\r\n        setTestPayload(JSON.stringify(payload, null, 2));\r\n      }\r\n    }\r\n  }, [selectedBot, bots]);\r\n\r\n  useEffect(() => {\r\n    fetchWebhookCalls();\r\n  }, [selectedBot]);\r\n\r\n  const fetchWebhookCalls = async () => {\r\n    if (!selectedBot) return;\r\n    \r\n    setLoadingCalls(true);\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('webhook_calls')\r\n        .select('*')\r\n        .eq('bot_id', selectedBot)\r\n        .order('created_at', { ascending: false })\r\n        .limit(50);\r\n\r\n      if (error) {\r\n        console.error('‚ùå Error fetching webhook calls:', error);\r\n        // Check if table exists\r\n        if (error.code === '42P01' || error.message?.includes('does not exist')) {\r\n          console.error('‚ö†Ô∏è webhook_calls table does not exist. Please run the migration: 20250113_create_webhook_calls_table.sql');\r\n        }\r\n        setWebhookCalls([]);\r\n        return;\r\n      }\r\n      console.log(`‚úÖ Fetched ${data?.length || 0} webhook calls`);\r\n      setWebhookCalls(data || []);\r\n    } catch (error) {\r\n      console.error('‚ùå Error fetching webhook calls:', error);\r\n      setWebhookCalls([]);\r\n    } finally {\r\n      setLoadingCalls(false);\r\n    }\r\n  };\r\n\r\n  const handleTestWebhook = async () => {\r\n    if (!selectedBot || !testPayload) {\r\n      alert('Please select a bot and provide a test payload');\r\n      return;\r\n    }\r\n\r\n    setIsTesting(true);\r\n    setTestResult(null);\r\n\r\n    try {\r\n      const payload = JSON.parse(testPayload);\r\n      \r\n      // Ensure we have a full URL\r\n      let fullWebhookUrl = webhookUrl;\r\n      if (!webhookUrl.startsWith('http')) {\r\n        const supabaseUrl = import.meta.env.VITE_PUBLIC_SUPABASE_URL || import.meta.env.VITE_SUPABASE_URL || '';\r\n        if (supabaseUrl) {\r\n          fullWebhookUrl = `${supabaseUrl}${webhookUrl.startsWith('/') ? '' : '/'}${webhookUrl}`;\r\n        } else {\r\n          throw new Error('Supabase URL not configured. Please check your environment variables.');\r\n        }\r\n      }\r\n      \r\n      console.log('üöÄ Sending webhook to:', fullWebhookUrl);\r\n      console.log('üì¶ Payload:', payload);\r\n      \r\n      const response = await fetch(fullWebhookUrl, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify(payload)\r\n      });\r\n\r\n      const responseText = await response.text();\r\n      let responseData;\r\n      try {\r\n        responseData = JSON.parse(responseText);\r\n      } catch {\r\n        responseData = { raw: responseText.substring(0, 500) }; // Limit raw text length\r\n      }\r\n\r\n      setTestResult({\r\n        status: response.status,\r\n        statusText: response.statusText,\r\n        ok: response.ok,\r\n        data: responseData,\r\n        timestamp: new Date().toISOString()\r\n      });\r\n\r\n      // Refresh webhook calls after a short delay to allow DB write\r\n      setTimeout(() => {\r\n        fetchWebhookCalls();\r\n      }, 2000);\r\n    } catch (error) {\r\n      console.error('‚ùå Webhook test error:', error);\r\n      setTestResult({\r\n        error: error instanceof Error ? error.message : String(error),\r\n        timestamp: new Date().toISOString()\r\n      });\r\n    } finally {\r\n      setIsTesting(false);\r\n    }\r\n  };\r\n\r\n  const formatDateTime = (dateString: string) => {\r\n    return new Date(dateString).toLocaleString();\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case 'processed': return 'text-green-600 bg-green-50';\r\n      case 'failed': return 'text-red-600 bg-red-50';\r\n      case 'rejected': return 'text-orange-600 bg-orange-50';\r\n      default: return 'text-gray-600 bg-gray-50';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Header title=\"Webhook Testing\" />\r\n      \r\n      <div className=\"pt-16 pb-6 px-4\">\r\n        <div className=\"max-w-6xl mx-auto space-y-6\">\r\n          {/* Test Interface */}\r\n          <Card className=\"p-6\">\r\n            <h2 className=\"text-xl font-semibold mb-4\">Test Webhook</h2>\r\n            \r\n            <div className=\"space-y-4\">\r\n              {/* Bot Selection */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  Select Bot\r\n                </label>\r\n                <select\r\n                  value={selectedBot}\r\n                  onChange={(e) => setSelectedBot(e.target.value)}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                >\r\n                  <option value=\"\">Select a bot...</option>\r\n                  {bots.map(bot => (\r\n                    <option key={bot.id} value={bot.id}>\r\n                      {bot.name} ({bot.symbol})\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n\r\n              {/* Webhook URL */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  Webhook URL\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={webhookUrl}\r\n                  readOnly\r\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50\"\r\n                />\r\n              </div>\r\n\r\n              {/* Webhook Secret */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  Webhook Secret\r\n                </label>\r\n                {!webhookSecret ? (\r\n                  <div className=\"p-3 bg-orange-50 border border-orange-200 rounded-lg\">\r\n                    <p className=\"text-sm text-orange-800 mb-2\">\r\n                      ‚ö†Ô∏è No webhook secret configured for this bot\r\n                    </p>\r\n                    <Button\r\n                      onClick={async () => {\r\n                        if (!selectedBot) return;\r\n                        const newSecret = generateWebhookSecret();\r\n                        try {\r\n                          console.log('üîÑ Generating webhook secret for bot:', selectedBot);\r\n                          await updateBot(selectedBot, { webhookSecret: newSecret });\r\n                          \r\n                          // Update local state immediately (don't wait for bots list refresh)\r\n                          setWebhookSecret(newSecret);\r\n                          console.log('‚úÖ Webhook secret state updated:', newSecret);\r\n                          \r\n                          // Update the payload with the new secret immediately (using comprehensive TradingView format)\r\n                          const bot = bots.find(b => b.id === selectedBot);\r\n                          if (bot) {\r\n                            const payload = {\r\n                              secret: newSecret,\r\n                              botId: bot.id,\r\n                              action: 'buy', // {{strategy.order.action}} - Can be: 'buy', 'sell', 'long', 'short'\r\n                              marketPosition: 'long', // {{strategy.market_position}}\r\n                              prevMarketPosition: 'flat', // {{strategy.prev_market_position}}\r\n                              marketPositionSize: '1.0', // {{strategy.market_position_size}}\r\n                              prevMarketPositionSize: '0.0', // {{strategy.prev_market_position_size}}\r\n                              instrument: 'BTCUSDT', // {{ticker}}\r\n                              timestamp: new Date().toISOString(), // {{timenow}}\r\n                              maxLag: '300',\r\n                              investmentType: 'base',\r\n                              amount: '1.0', // {{strategy.order.contracts}}\r\n                              mode: 'paper',\r\n                              reason: 'Test webhook from testing interface'\r\n                            };\r\n                            setTestPayload(JSON.stringify(payload, null, 2));\r\n                            console.log('‚úÖ Test payload updated with new secret');\r\n                          }\r\n                          \r\n                          // Small delay to ensure state updates are processed\r\n                          setTimeout(() => {\r\n                            console.log('‚úÖ Webhook secret generated! Button should now be enabled.');\r\n                          }, 100);\r\n                          \r\n                          alert('‚úÖ Webhook secret generated! You can now test the webhook.');\r\n                        } catch (error) {\r\n                          console.error('‚ùå Error generating webhook secret:', error);\r\n                          alert('‚ùå Failed to generate webhook secret. Please try again.');\r\n                        }\r\n                      }}\r\n                      variant=\"primary\"\r\n                      size=\"sm\"\r\n                    >\r\n                      <i className=\"ri-refresh-line mr-2\"></i>\r\n                      Generate Webhook Secret\r\n                    </Button>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"flex gap-2\">\r\n                    <input\r\n                      type={showSecret ? 'text' : 'password'}\r\n                      value={webhookSecret}\r\n                      readOnly\r\n                      className=\"flex-1 px-3 py-2 border border-gray-300 rounded-lg bg-gray-50\"\r\n                    />\r\n                    <Button\r\n                      variant=\"secondary\"\r\n                      onClick={() => setShowSecret(!showSecret)}\r\n                    >\r\n                      <i className={showSecret ? 'ri-eye-off-line' : 'ri-eye-line'}></i>\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Test Payload */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  Test Payload (JSON)\r\n                </label>\r\n                <textarea\r\n                  value={testPayload}\r\n                  onChange={(e) => setTestPayload(e.target.value)}\r\n                  rows={8}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm\"\r\n                  placeholder='{\"secret\": \"...\", \"botId\": \"...\", \"action\": \"{{strategy.order.action}}\", \"mode\": \"paper\"}'\r\n                />\r\n              </div>\r\n\r\n              {/* Test Button */}\r\n              <Button\r\n                onClick={handleTestWebhook}\r\n                loading={isTesting}\r\n                disabled={!webhookSecret || webhookSecret.trim() === '' || !selectedBot}\r\n                className=\"w-full\"\r\n              >\r\n                <i className=\"ri-send-plane-line mr-2\"></i>\r\n                Send Test Webhook\r\n              </Button>\r\n              {(!webhookSecret || webhookSecret.trim() === '') && (\r\n                <p className=\"text-xs text-orange-600 mt-1\">\r\n                  ‚ö†Ô∏è Please generate a webhook secret first\r\n                </p>\r\n              )}\r\n              {webhookSecret && webhookSecret.trim() !== '' && selectedBot && (\r\n                <p className=\"text-xs text-green-600 mt-1\">\r\n                  ‚úÖ Ready to test! Secret is configured.\r\n                </p>\r\n              )}\r\n\r\n              {/* Test Result */}\r\n              {testResult && (\r\n                <div className={`p-4 rounded-lg border-2 ${\r\n                  testResult.ok ? 'border-green-300 bg-green-50' : 'border-red-300 bg-red-50'\r\n                }`}>\r\n                  <div className=\"flex items-center justify-between mb-2\">\r\n                    <h3 className=\"font-semibold\">\r\n                      {testResult.ok ? '‚úÖ Success' : '‚ùå Error'}\r\n                    </h3>\r\n                    <span className=\"text-xs text-gray-500\">\r\n                      {formatDateTime(testResult.timestamp)}\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"text-sm\">\r\n                    <p className=\"mb-2\">\r\n                      <strong>Status:</strong> {testResult.status} {testResult.statusText}\r\n                    </p>\r\n                    <pre className=\"bg-white p-3 rounded border text-xs overflow-x-auto\">\r\n                      {JSON.stringify(testResult.data || testResult.error, null, 2)}\r\n                    </pre>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </Card>\r\n\r\n          {/* Webhook Calls History */}\r\n          <Card className=\"p-6\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <h2 className=\"text-xl font-semibold\">Recent Webhook Calls</h2>\r\n              <Button\r\n                variant=\"secondary\"\r\n                size=\"sm\"\r\n                onClick={fetchWebhookCalls}\r\n                loading={loadingCalls}\r\n              >\r\n                <i className=\"ri-refresh-line mr-2\"></i>\r\n                Refresh\r\n              </Button>\r\n            </div>\r\n\r\n            {loadingCalls ? (\r\n              <div className=\"text-center py-8\">\r\n                <i className=\"ri-loader-4-line animate-spin text-2xl text-gray-400\"></i>\r\n                <p className=\"mt-2 text-gray-500\">Loading webhook calls...</p>\r\n              </div>\r\n            ) : webhookCalls.length === 0 ? (\r\n              <div className=\"text-center py-8 text-gray-500\">\r\n                <i className=\"ri-file-list-line text-3xl mb-2\"></i>\r\n                <p>No webhook calls recorded yet</p>\r\n                <p className=\"text-sm mt-1\">Send a test webhook to see it here</p>\r\n                <div className=\"mt-4 p-3 bg-orange-50 border border-orange-200 rounded-lg text-left max-w-md mx-auto\">\r\n                  <p className=\"text-xs font-semibold text-orange-800 mb-2\">‚ö†Ô∏è Troubleshooting:</p>\r\n                  <ul className=\"text-xs text-orange-700 space-y-1 list-disc list-inside\">\r\n                    <li>Ensure the webhook_calls table migration has been run</li>\r\n                    <li>Check that the webhook function is deployed</li>\r\n                    <li>Open browser console (F12) to see detailed logs</li>\r\n                    <li>Verify the webhook URL is correct (should start with https://)</li>\r\n                  </ul>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"overflow-x-auto\">\r\n                <table className=\"min-w-full text-sm\">\r\n                  <thead className=\"bg-gray-100\">\r\n                    <tr>\r\n                      <th className=\"px-4 py-2 text-left\">Time</th>\r\n                      <th className=\"px-4 py-2 text-left\">Status</th>\r\n                      <th className=\"px-4 py-2 text-left\">Side</th>\r\n                      <th className=\"px-4 py-2 text-left\">Mode</th>\r\n                      <th className=\"px-4 py-2 text-left\">Response</th>\r\n                      <th className=\"px-4 py-2 text-left\">Error</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {webhookCalls.map(call => (\r\n                      <tr key={call.id} className=\"border-t border-gray-200 hover:bg-gray-50\">\r\n                        <td className=\"px-4 py-2 whitespace-nowrap\">\r\n                          {formatDateTime(call.created_at)}\r\n                        </td>\r\n                        <td className=\"px-4 py-2\">\r\n                          <span className={`px-2 py-1 rounded text-xs font-medium ${getStatusColor(call.status)}`}>\r\n                            {call.status}\r\n                          </span>\r\n                        </td>\r\n                        <td className=\"px-4 py-2 uppercase font-semibold\">\r\n                          {call.side || '‚Äî'}\r\n                        </td>\r\n                        <td className=\"px-4 py-2 capitalize\">\r\n                          {call.mode || '‚Äî'}\r\n                        </td>\r\n                        <td className=\"px-4 py-2\">\r\n                          {call.response_status ? (\r\n                            <span className={`font-semibold ${\r\n                              call.response_status >= 200 && call.response_status < 300\r\n                                ? 'text-green-600'\r\n                                : 'text-red-600'\r\n                            }`}>\r\n                              {call.response_status}\r\n                            </span>\r\n                          ) : '‚Äî'}\r\n                        </td>\r\n                        <td className=\"px-4 py-2\">\r\n                          {call.error_message ? (\r\n                            <span className=\"text-red-600 text-xs\" title={call.error_message}>\r\n                              {call.error_message.substring(0, 50)}...\r\n                            </span>\r\n                          ) : '‚Äî'}\r\n                        </td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            )}\r\n          </Card>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":["generateWebhookSecret","array","_a","byte","error","WebhookTestPage","useNavigate","bots","updateBot","useBots","selectedBot","setSelectedBot","useState","webhookUrl","setWebhookUrl","webhookSecret","setWebhookSecret","testPayload","setTestPayload","testResult","setTestResult","isTesting","setIsTesting","webhookCalls","setWebhookCalls","loadingCalls","setLoadingCalls","showSecret","setShowSecret","useEffect","bot","b","supabaseUrl","botSecret","payload","fetchWebhookCalls","data","supabase","handleTestWebhook","fullWebhookUrl","response","responseText","responseData","formatDateTime","dateString","getStatusColor","status","jsxs","jsx","Header","Card","e","Button","newSecret","call"],"mappings":"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"}