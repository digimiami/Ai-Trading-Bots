import{u as W,c as q,r as j,j as e}from"./index-24c1dc89.js";import{H as G}from"./Header-31956778.js";import{N as K}from"./Navigation-af1f35ab.js";import{B as r}from"./Button-edfd724d.js";import{C as k}from"./Card-140be329.js";import{u as M}from"./useBots-78869242.js";import{u as Q}from"./useBotActivity-c252b9a0.js";function te(){const c=W(),{bots:f,loading:A,startBot:N,stopBot:v,updateBot:u,deleteBot:w}=M(),{activities:$,addLog:d}=Q(f),{isExecuting:o,lastExecution:b,timeSync:g,executeBot:S,executeAllBots:z}=q(),[h,L]=j.useState("all"),[x,n]=j.useState(!1),[p,E]=j.useState(null),i=f.filter(s=>h==="all"||s.status===h),F=s=>$.find(t=>t.botId===s),m=s=>{switch(s){case"info":return"text-blue-600 bg-blue-50";case"warning":return"text-yellow-600 bg-yellow-50";case"error":return"text-red-600 bg-red-50";case"success":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},B=s=>{switch(s){case"market":return"ri-line-chart-line";case"trade":return"ri-exchange-line";case"strategy":return"ri-brain-line";case"system":return"ri-settings-line";case"error":return"ri-error-warning-line";default:return"ri-information-line"}},C=s=>new Date(s).toLocaleTimeString(),P=s=>{switch(s){case"running":return"bg-green-100 text-green-800";case"paused":return"bg-yellow-100 text-yellow-800";case"stopped":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},T=s=>{switch(s){case"low":return"text-green-600";case"medium":return"text-yellow-600";case"high":return"text-red-600";default:return"text-gray-600"}},y=async(s,t)=>{try{t==="start"?(await N(s),await d(s,{level:"success",category:"system",message:"Bot started successfully",details:{action:"start",timestamp:new Date().toISOString()}})):t==="stop"?(await v(s),await d(s,{level:"info",category:"system",message:"Bot stopped by user",details:{action:"stop",timestamp:new Date().toISOString()}})):t==="pause"&&(await u(s,{status:"paused"}),await d(s,{level:"warning",category:"system",message:"Bot paused by user",details:{action:"pause",timestamp:new Date().toISOString()}}))}catch(l){console.error("Failed to update bot:",l),await d(s,{level:"error",category:"error",message:`Failed to ${t} bot: ${l}`,details:{action:t,error:l instanceof Error?l.message:String(l)}})}},D=async()=>{n(!0);try{const s=i.filter(t=>t.status==="stopped"||t.status==="paused");await Promise.all(s.map(t=>N(t.id)))}catch(s){console.error("Failed to start all bots:",s)}finally{n(!1)}},R=async()=>{n(!0);try{const s=i.filter(t=>t.status==="running"||t.status==="paused");await Promise.all(s.map(t=>v(t.id)))}catch(s){console.error("Failed to stop all bots:",s)}finally{n(!1)}},_=async()=>{if(confirm("Are you sure you want to reset all bot statistics? This will set PnL, trades count, and win rate to zero.")){n(!0);try{await Promise.all(i.map(s=>u(s.id,{total_trades:0,win_rate:0,pnl:0,pnl_percentage:0,last_trade_at:null}))),console.log("All bot statistics reset successfully")}catch(s){console.error("Failed to reset all bots:",s)}finally{n(!1)}}},O=async()=>{if(confirm("Are you sure you want to delete all bots? This action cannot be undone.")){n(!0);try{await Promise.all(i.map(s=>w(s.id))),console.log("All bots deleted successfully")}catch(s){console.error("Failed to delete all bots:",s)}finally{n(!1)}}},H=async(s,t)=>{if(confirm(`Are you sure you want to reset "${t}" statistics? This will set PnL, trades count, and win rate to zero.`))try{await u(s,{total_trades:0,win_rate:0,pnl:0,pnl_percentage:0,last_trade_at:null}),console.log(`Bot "${t}" statistics reset successfully`)}catch(l){console.error(`Failed to reset bot "${t}":`,l)}},U=async(s,t)=>{if(confirm(`Are you sure you want to delete "${t}"? This action cannot be undone.`))try{await w(s),console.log(`Bot "${t}" deleted successfully`)}catch(l){console.error(`Failed to delete bot "${t}":`,l)}},J=s=>{c(`/edit-bot/${s}`)};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(G,{title:"Trading Bots",action:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(r,{variant:"warning",size:"sm",onClick:z,disabled:o||i.filter(s=>s.status==="running").length===0,children:[e.jsx("i",{className:"ri-play-circle-line mr-1"}),"Execute All"]}),e.jsxs(r,{variant:"success",size:"sm",onClick:D,disabled:x||i.filter(s=>s.status==="stopped"||s.status==="paused").length===0,children:[e.jsx("i",{className:"ri-play-line mr-1"}),"Start All"]}),e.jsxs(r,{variant:"secondary",size:"sm",onClick:R,disabled:x||i.filter(s=>s.status==="running"||s.status==="paused").length===0,children:[e.jsx("i",{className:"ri-stop-line mr-1"}),"Stop All"]}),e.jsxs(r,{variant:"secondary",size:"sm",onClick:_,disabled:x||i.length===0,children:[e.jsx("i",{className:"ri-refresh-line mr-1"}),"Reset All"]}),e.jsxs(r,{variant:"danger",size:"sm",onClick:O,disabled:x||i.length===0,children:[e.jsx("i",{className:"ri-delete-bin-line mr-1"}),"Delete All"]}),e.jsxs(r,{variant:"primary",size:"sm",onClick:()=>c("/create-bot"),children:[e.jsx("i",{className:"ri-add-line mr-1"}),"New Bot"]})]})}),e.jsx("div",{className:"pt-20 pb-20 px-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-4",children:[e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${o?"bg-yellow-500 animate-pulse":"bg-green-500"}`}),e.jsx("span",{className:"text-sm text-gray-600",children:o?"Executing...":"Ready"})]}),b&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Last execution: ",new Date(b).toLocaleTimeString()]}),g&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Time sync: ",g.offset>0?"+":"",g.offset,"ms"]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Auto-execution every 5 minutes"})]})}),e.jsx("div",{className:"flex space-x-2 overflow-x-auto",children:["all","running","paused","stopped"].map(s=>e.jsx("button",{onClick:()=>L(s),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap ${h===s?"bg-blue-600 text-white":"bg-white text-gray-600 border border-gray-200"}`,children:s.charAt(0).toUpperCase()+s.slice(1)},s))}),e.jsx("div",{className:"space-y-4",children:A?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading bots..."})]}):i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-robot-line text-4xl text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No bots found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Create your first trading bot to get started"}),e.jsxs(r,{onClick:()=>c("/create-bot"),children:[e.jsx("i",{className:"ri-add-line mr-2"}),"Create Bot"]})]}):i.map(s=>e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:`${s.exchange==="bybit"?"ri-currency-line":"ri-exchange-line"} text-blue-600 text-xl`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.symbol," â€¢ ",s.exchange.toUpperCase()]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${P(s.status)}`,children:s.status}),e.jsxs("span",{className:`text-xs font-medium ${T(s.riskLevel)}`,children:[s.riskLevel," risk"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`text-lg font-bold ${s.pnl>=0?"text-green-600":"text-red-600"}`,children:[s.pnl>=0?"+":"","$",s.pnl.toFixed(2)]}),e.jsxs("p",{className:`text-sm ${s.pnlPercentage>=0?"text-green-600":"text-red-600"}`,children:[s.pnlPercentage>=0?"+":"",s.pnlPercentage.toFixed(2),"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Trades"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.totalTrades})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Win Rate"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[s.winRate,"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Leverage"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[s.leverage,"x"]})]})]}),(()=>{const t=F(s.id),l=(t==null?void 0:t.logs.slice(0,3))||[];return e.jsxs("div",{className:"pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Recent Activity"}),e.jsx("button",{onClick:()=>E(p===s.id?null:s.id),className:"text-xs text-blue-600 hover:text-blue-800",children:p===s.id?"Hide":"Show All"})]}),t&&e.jsxs("div",{className:"flex space-x-4 mb-3 text-xs",children:[e.jsxs("span",{className:"text-green-600",children:["âœ“ ",t.successCount]}),e.jsxs("span",{className:"text-yellow-600",children:["âš  ",t.logs.filter(a=>a.level==="warning").length]}),e.jsxs("span",{className:"text-red-600",children:["âœ— ",t.errorCount]}),e.jsxs("span",{className:"text-gray-500",children:["ðŸ“Š ",t.logs.length," total"]})]}),e.jsx("div",{className:"space-y-2",children:l.length===0?e.jsxs("div",{className:"text-center py-4 text-gray-500 text-sm",children:[e.jsx("i",{className:"ri-file-list-line text-lg mb-1"}),e.jsx("p",{children:"No activity logs yet"})]}):l.map(a=>e.jsxs("div",{className:"flex items-start space-x-2 p-2 bg-gray-50 rounded text-xs",children:[e.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center ${m(a.level)}`,children:e.jsx("i",{className:`${B(a.category)} text-xs`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`px-1 py-0.5 rounded text-xs font-medium ${m(a.level)}`,children:a.level}),e.jsx("span",{className:"text-gray-500",children:C(a.timestamp)})]}),e.jsx("p",{className:"text-gray-700 mt-1 truncate",children:a.message})]})]},a.id))}),p===s.id&&t&&t.logs.length>3&&e.jsx("div",{className:"mt-3 space-y-2 max-h-48 overflow-y-auto",children:t.logs.slice(3).map(a=>e.jsxs("div",{className:"flex items-start space-x-2 p-2 bg-gray-50 rounded text-xs",children:[e.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center ${m(a.level)}`,children:e.jsx("i",{className:`${B(a.category)} text-xs`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`px-1 py-0.5 rounded text-xs font-medium ${m(a.level)}`,children:a.level}),e.jsx("span",{className:"text-gray-500",children:C(a.timestamp)})]}),e.jsx("p",{className:"text-gray-700 mt-1",children:a.message}),a.details&&e.jsxs("details",{className:"mt-1",children:[e.jsx("summary",{className:"cursor-pointer text-gray-500 hover:text-gray-700",children:"Details"}),e.jsx("pre",{className:"mt-1 p-1 bg-white rounded border text-xs overflow-x-auto",children:JSON.stringify(a.details,null,2)})]})]})]},a.id))})]})})(),e.jsxs("div",{className:"pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex space-x-2 mb-2",children:[s.status==="running"?e.jsxs(e.Fragment,{children:[e.jsxs(r,{variant:"warning",size:"sm",className:"flex-1",onClick:()=>S(s.id),disabled:o,children:[e.jsx("i",{className:"ri-play-circle-line mr-1"}),"Execute"]}),e.jsxs(r,{variant:"secondary",size:"sm",onClick:()=>y(s.id,"pause"),children:[e.jsx("i",{className:"ri-pause-line mr-1"}),"Pause"]})]}):e.jsxs(r,{variant:"success",size:"sm",className:"flex-1",onClick:()=>y(s.id,"start"),children:[e.jsx("i",{className:"ri-play-line mr-1"}),"Start"]}),e.jsx(r,{variant:"danger",size:"sm",onClick:()=>y(s.id,"stop"),children:e.jsx("i",{className:"ri-stop-line"})}),e.jsx(r,{variant:"secondary",size:"sm",onClick:()=>c("/bot-activity"),children:e.jsx("i",{className:"ri-file-list-line"})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(r,{variant:"primary",size:"sm",className:"flex-1",onClick:()=>J(s.id),children:[e.jsx("i",{className:"ri-edit-line mr-1"}),"Edit"]}),e.jsxs(r,{variant:"warning",size:"sm",className:"flex-1",onClick:()=>H(s.id,s.name),children:[e.jsx("i",{className:"ri-refresh-line mr-1"}),"Reset"]}),e.jsxs(r,{variant:"danger",size:"sm",className:"flex-1",onClick:()=>U(s.id,s.name),children:[e.jsx("i",{className:"ri-delete-bin-line mr-1"}),"Delete"]})]})]})]},s.id))})]})}),e.jsx(K,{})]})}export{te as default};
//# sourceMappingURL=page-2d121fb3.js.map
